/*! test 2017-04-13 */

function loadTargetData(a){$.ajax({url:apiurl+"r=api/energy/target/list",type:"post",dataType:"json",data:{data:JSON.stringify({type:a})},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(b){if($(".loading").hide(),b.success)switch(console.log("查看返回的数据:"+JSON.stringify(b,null,2)),a){case"day":$("#day_t .all_consumption").val(b.data[0].value),$("#day_t .one_consumption").val(b.data[1].value),$("#day_t .two_consumption").val(b.data[2].value),$("#day_t .three_consumption").val(b.data[3].value),$("#day_t .four_consumption").val(b.data[4].value),$("#day_t .all_consumption").data("id",b.data[0].id),$("#day_t .one_consumption").data("id",b.data[1].id),$("#day_t .two_consumption").data("id",b.data[2].id),$("#day_t .three_consumption").data("id",b.data[3].id),$("#day_t .four_consumption").data("id",b.data[4].id),$("#day_t .all_consumption").data("groupid",b.data[0].energy_group_id),$("#day_t .one_consumption").data("groupid",b.data[1].energy_group_id),$("#day_t .two_consumption").data("groupid",b.data[2].energy_group_id),$("#day_t .three_consumption").data("groupid",b.data[3].energy_group_id),$("#day_t .four_consumption").data("groupid",b.data[4].energy_group_id);break;case"month":$("#mont_t .all_consumption").val(b.data[0].value),$("#mont_t .one_consumption").val(b.data[1].value),$("#mont_t .two_consumption").val(b.data[2].value),$("#mont_t .three_consumption").val(b.data[3].value),$("#mont_t .four_consumption").val(b.data[4].value),$("#mont_t .all_consumption").data("id",b.data[0].id),$("#mont_t .one_consumption").data("id",b.data[1].id),$("#mont_t .two_consumption").data("id",b.data[2].id),$("#mont_t .three_consumption").data("id",b.data[3].id),$("#mont_t .four_consumption").data("id",b.data[4].id),$("#mont_t .all_consumption").data("groupid",b.data[0].energy_group_id),$("#mont_t .one_consumption").data("groupid",b.data[1].energy_group_id),$("#mont_t .two_consumption").data("groupid",b.data[2].energy_group_id),$("#mont_t .three_consumption").data("groupid",b.data[3].energy_group_id),$("#mont_t .four_consumption").data("groupid",b.data[4].energy_group_id)}else layer.msg(b.error_message),returnLogIn(b.error_message)},error:function(a){$(".loading").hide(),layer.msg(a.error_message),console.log("失败原因:"+JSON.stringify(a.error_message))}})}$("#foot").load("public.html"),$(function(){publicHeadfun(),loadTargetData("day")}),$("#tab ul li a").on("click",function(){loadTargetData($(this).data("type"))}),$("#day_t .btn_sure_consumption").on("click",function(){var a=apiurl+"r=api/energy/target/update",b=[],c=[],d=!0;if($("#day_t").find("input").each(function(a,b){if(Number($(b).val())<0||Number($(b).val())>9999999)return d=!1,!1}),d){$("#day_t").find("input").each(function(a,b){var d={id:$(b).data("id"),groupid:$(b).data("groupid"),val:$(b).val()};c.push(d)});for(var e=0;e<5;e++){var f={id:c[e].id,energy_group_id:c[e].groupid,type:"day",value:c[e].val};b.push(f)}var g={data:JSON.stringify(b)};$.ajax({url:a,type:"post",dataType:"json",data:g,beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){$(".loading").hide(),a.success?layer.msg("日目标值设定成功"):layer.msg("失败原因:"+a.error_message)},error:function(a){$(".loading").hide(),layer.msg("失败原因:"+a.error_message)}})}else layer.msg("请检查输入数据是否准确")}),$("#mont_t .btn_sure_consumption").on("click",function(){var a=apiurl+"r=api/energy/target/update",b=[],c=[],d=!0;if($("#mont_t").find("input").each(function(a,b){if(Number($(b).val())<0||Number($(b).val())>9999999)return d=!1,!1}),d){$("#mont_t").find("input").each(function(a,b){var d={id:$(b).data("id"),groupid:$(b).data("groupid"),val:$(b).val()};c.push(d)});for(var e=0;e<5;e++){var f={id:c[e].id,energy_group_id:c[e].groupid,type:"month",value:c[e].val};b.push(f)}var g={data:JSON.stringify(b)};$.ajax({url:a,type:"post",dataType:"json",data:g,beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){$(".loading").hide(),a.success?layer.msg("月目标值设定成功"):layer.msg("失败原因:"+a.error_message)},error:function(a){$(".loading").hide(),layer.msg("失败原因:"+a.error_message)}})}else layer.msg("请检查输入数据是否准确")});