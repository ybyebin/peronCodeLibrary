/*! test 2017-04-13 */

function warnLoadData(a){var b={page:a,page_item_count:14};console.log(JSON.stringify(b,null,2)),$.ajax({url:apiurl+"r=api/alarm/list/init",type:"post",dataType:"json",data:{data:JSON.stringify({page:a,page_item_count:14})},beforeSend:function(){$(".loading").show()},success:function(b){$(".loading").hide(),b.success?(console.log("报警数据:"+JSON.stringify(b,null,2)),warnAddtable(b.data.data),0===b.data.pageCount?(layer.msg("无数据"),$(".tcdPageCode-warn").html(""),Initialization&&$("#ri_a").click()):$(".tcdPageCode-warn").createPage({pageCount:b.data.pageCount,current:a,backFn:function(a){console.log("这是第"+a+"页"),warnLoadData(a)}}),Initialization=!1):(layer.msg(b.error_message),returnLogIn(b.error_message),console.log("错误原因"+JSON.stringify(b,null,2)))},error:function(a){$(".loading").hide(),layer.msg(a.error_message),console.log("错误原因"+JSON.stringify(a,null,2))}})}function warnAddtable(a){null==a&&(a=[]);for(var b in a)switch(a[b].level){case 1:a[b].level="低";break;case 2:a[b].level="中";break;case 3:a[b].level="高"}console.log("查看数据:"+JSON.stringify(a,null,2)),$("#tbodys tr td").html(""),$("#tbodys tr").each(function(b,c){if(b<a.length){var d="<td>"+a[b].level+"</td><td>"+a[b].alarmTime+'</td><td title="'+a[b].message+'">'+a[b].message+"</td><td >"+a[b].tagName+"</td><td >"+a[b].alarmValue+"</td><td >"+a[b].curValue+'</td><td><button data-id = "'+a[b].id+'" class="btn-sure">确认</button></td>';$(c).html(d),console.log("index:"+b)}})}function warnLogLoadData(a){var b={page:1,page_item_count:12,start_time:$("#startTime").val(),end_time:$("#endTime").val()};console.log("查询报警日志:"+JSON.stringify(b,null,2)),$.ajax({url:apiurl+"r=api/alarm/list/history",type:"post",dataType:"json",data:{data:JSON.stringify({page:a,page_item_count:12,start_time:$("#startTime").val(),end_time:$("#endTime").val()})},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(b){if($(".loading").hide(),b.success){console.log("报警日志数据====:"+JSON.stringify(b,null,2));b.data.pageCount;warnLogAddtable(b.data.data),0===b.data.pageCount?(layer.msg("无数据"),$(".tcdPageCode-log").html("")):$(".tcdPageCode-log").createPage({pageCount:b.data.pageCount,current:a,backFn:function(a){console.log(a),warnLogLoadData(a)}})}else layer.msg(b.error_message),returnLogIn(b.error_message),console.log("报警日志错误原因"+JSON.stringify(b,null,2))},error:function(a){$(".loading").hide(),layer.msg(a.error_message),console.log("报警日志错误原因"+JSON.stringify(a,null,2))}})}function warnLogAddtable(a){null==a&&(a=[]);for(var b in a){switch(a[b].level){case 1:a[b].level="低";break;case 2:a[b].level="中";break;case 3:a[b].level="高"}switch(a[b].action){case 0:a[b].action="已发生";break;case 1:a[b].action="已确认";break;case 2:a[b].action="已恢复"}}console.log("查看数据:"+JSON.stringify(a,null,2)),$("#logtbody tr td").html(""),$("#logtbody tr").each(function(b,c){if(b<a.length){var d="<td>"+a[b].level+"</td><td>"+a[b].alarmTime+'</td><td title="'+a[b].message+'">'+a[b].message+"</td><td >"+a[b].tagName+"</td><td >"+a[b].alarmValue+"</td><td >"+a[b].curValue+"</td><td>"+a[b].action+"</td><td>"+a[b].actionTime+"</td>";$(c).html(d),console.log("index:"+b)}})}function exportWarnLog(){var a=$("#startTime").val(),b=$("#endTime").val();console.log("时间区间:"+a+"--"+b),""!==a&&""!==b?a>b?layer.msg("开始时间大于结束时间"):compareYear(new Date(a),10)<=b?layer.msg("超过统计时间限制"):$.ajax({url:apiurl+"r=api/alarm/list/exe",type:"post",dataType:"json",data:{data:JSON.stringify({start_time:a,end_time:b})},success:function(a){a.success?window.location.href=a.data:(layer.msg(a.error_message),returnLogIn(a.error_message))},error:function(a){layer.msg(a.error_message),console.log("报警日志错误原因"+JSON.stringify(a,null,2))}}):layer.msg("时间区间不能为空")}$("#foot").load("public.html");var Initialization=!0;$(function(){publicHeadfun(),days(),$("#slectFen ul li a").click(function(){var a=!0;$("span.txt").text($(this).text());var b=$(this).attr("rel");1==b||2==b?($("#startTime").val($(this).attr("value")),$("#endTime").val($(this).attr("value"))):3==b||4==b||5==b?($("#startTime").val($(this).attr("value")),$("#endTime").val(compareDate(1,0))):6==b||7==b||8==b?($("#startTime").val($(this).attr("value")),6==b?counts=1:7==b?counts=2:8==b&&(counts=3),$("#endTime").val(getCurrentMonthLastForSelect($(this).attr("value")))):9==b&&(a=!1,$("#startTime").val(""),$("#endTime").val("")),a&&warnLogLoadData(1)}),warnLoadData(1)}),$("#startTime").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:!1,pickerPosition:"bottom-right",minView:2}).on("changeDate",function(a){$("#slectFen button .txt").html("自定义").attr("rel",9),$("#endTime")[0].focus()}),$("#endTime").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:!1,pickerPosition:"bottom-right",minView:2}).on("changeDate",function(a){$("#slectFen button .txt").html("自定义").attr("rel",9),timebeginisTrue=!0,checkEndTime("startTime","endTime",1)||($("#endTime").val(""),layer.msg("结束时间需晚于开始时间"),timebeginisTrue=!1),compareYear(new Date($("#startTime").val()),10)<=a.date.toLocaleDateString()&&(layer.msg("超过统计时间限制"),$("#endTime").val(""),timebeginisTrue=!1),timebeginisTrue&&warnLogLoadData(1)}),$("#tbodys").on("click","button",function(){var a=$(this);$.ajax({url:apiurl+"r=api/alarm/list/confirm",type:"post",dataType:"json",data:{data:JSON.stringify({id:$(this).data("id")})},beforeSend:function(){$(".loading").show()},complete:function(){},success:function(b){if($(".loading").hide(),b.success)switch(console.log("数据:"+JSON.stringify(b,null,2)),b.success){case!1:break;case!0:a.parent().html("已确认")}else layer.msg(b.error_message),returnLogIn(b.error_message),console.log("失败原因:"+JSON.stringify(b))},error:function(a){$(".loading").hide(),layer.msg(a.error_message),console.log("数据得得得:"+JSON.stringify(a))}})}),$("#ri_a").on("click",function(){1===Number($(this).data("click"))&&($("#slectFen ul li:nth-child(4) a").click(),$(this).data("click","0"))});