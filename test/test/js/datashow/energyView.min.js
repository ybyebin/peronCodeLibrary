/*! test 2017-04-13 */

function SelectActive(a,b){1==b?($(".navbar-nav li").removeClass("active"),$(a).addClass("active")):2==b?($("#leftNames aside li").removeClass("active"),$(a).addClass("active"),check_tree(1,$(a).attr("ids"))):($("#bao_leftNames aside li").removeClass("active"),$(a).addClass("active"),check_tree(2,$(a).attr("ids")))}function days(){var a=new Date,b=Number(a.getMonth()+1);$(".selectType li").each(function(c){0==c?$(this).find("a").attr("value",FormatDate(a,"yyyy-MM-dd")):1==c?$(this).find("a").attr("value",compareDate(1,1)):2==c?$(this).find("a").attr("value",compareDate(1,2)):3==c?$(this).find("a").attr("value",compareDate(1,6)):4==c?$(this).find("a").attr("value",compareDate(1,29)):5==c?1===b?$(this).find("a").attr("value",a.getFullYear()-1+"-"+compareDate(2,1)+"-01").html(compareDate(2,1)+"月"):$(this).find("a").attr("value",a.getFullYear()+"-"+compareDate(2,1)+"-01").html(compareDate(2,1)+"月"):6==c?1===b||2===b?$(this).find("a").attr("value",a.getFullYear()-1+"-"+compareDate(2,2)+"-01").html(compareDate(2,2)+"月"):$(this).find("a").attr("value",a.getFullYear()+"-"+compareDate(2,2)+"-01").html(compareDate(2,2)+"月"):7==c&&(1===b||2===b||3===b?$(this).find("a").attr("value",a.getFullYear()-1+"-"+compareDate(2,3)+"-01").html(compareDate(2,3)+"月"):$(this).find("a").attr("value",a.getFullYear()+"-"+compareDate(2,3)+"-01").html(compareDate(2,3)+"月"))})}function showValue(a){$(".addTime").css("visibility","visible");var b=$("#selectTime").val(),c=$("#endTime").val();""!=b&&""!=c&&$("#selectType .txt").html("自定义").attr("rel",9)}function showObj(a){1==a?$("#tongji").is(":hidden")?$("#tongji").slideDown():$("#tongji").slideUp():$("#tongjis").is(":hidden")?$("#tongjis").slideDown():$("#tongjis").slideUp()}function All(){if($("#tab_border").is(":hidden"))layer.msg("报表为空");else{var a=document.getElementById("tab_border");$("#tab_border header").show(),a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen&&a.msRequestFullscreen(),a.style.height="100%",a.style.width="100%"}}function exitFullscreen(){var a=document;a.exitFullscreen?a.exitFullscreen():a.mozCancelFullScreen?a.mozCancelFullScreen():a.webkitCancelFullScreen&&a.webkitCancelFullScreen(),$("#tab_border header").hide()}function del(a){layer.confirm('<h4 style="color:#fff">您确认要删除该项目？</h4><p><small style="color:#fff">删除后不可恢复</small></p>',{btn:["取消","删除"],area:["1000px"],shade:0,title:!1,move:!1,shift:2,skin:"layui-primary",closeBtn:0},function(a){layer.close(a)},function(b){1==a?(Del(a),layer.close(b)):2==a&&(Del(a),layer.close(b))})}function otherSave(a,b,c){$("#"+b).val(""),1==a?$("#fen_select button .txt").html():$("#bao_select button .txt").html(),layer.open({title:[""+c,"font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["1000px","240px"],content:$("#otherSave"),shift:2,move:!1,btn:["确定","取消"],yes:function(b,c){var d;RegeMatch($("#fieldName"))?1==a?fileName_s("fieldName",1)&&(d="api/energy/graph/create",$.ajax({type:"post",url:enetgy_url+d+"",dataType:"json",data:{data:JSON.stringify(getdata())},success:function(a){a.success?($("#leftNames aside").remove("aside"),leftList(1),$("#leftNames aside li").removeClass("active"),$('#leftNames aside li[ids="'+a.data.id+'"]').css("border-right","2px solid red"),layer.close(b),layer.msg("保存成功")):(layer.alert(a.error_message,{title:["错误信息"],skin:"lay-alert",move:!1}),returnLogIn(a.error_message))}})):2==a&&fileName_s("fieldName",2)&&(d="api/energy/report/create",$.ajax({type:"post",url:enetgy_url+d+"",dataType:"json",data:{data:JSON.stringify(reportData())},success:function(a){a.success?($("#bao_leftNames aside").remove("aside"),leftList(2),$("#bao_leftNames aside li").removeClass("active"),$('#bao_leftNames aside li[ids="'+a.data.id+'"]').css("border-right","2px solid red"),layer.close(b),layer.msg("保存成功")):(layer.alert(a.error_message,{title:["错误信息"],skin:"lay-alert",move:!1}),returnLogIn(a.error_message))}})):layer.msg("指定的组名称格式错误")},btn2:function(a,b){}})}function compares(){if(""!=$("#selectTime").val()&&""!=$("#endTime").val()){if(!checkEndTime("selectTime","endTime",1))return layer.msg("结束时间需晚于开始时间"),void $("#endTime").val("");var a=judgeCompare();$(".addTime div").show();layer.open({title:["对比历史数据","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-compare",area:["935px","auto"],content:$("#"+a),shift:2,btn:["确定","取消"],yes:function(b,c){switch(a){case"compare":var d=!1;$("#compare div.historyInputCom").each(function(a,b){var c=$(b).find("input");if(c&&(""==$(c[0]).val()||""==$(c[1]).val()))return d=!0,!1}),d?layer.msg("对比历史时间段不能为空"):(loadHighcharData("screening","screening","screening",a),layer.close(b));break;case"compare1":loadHighcharData("screening","screening","screening",a),layer.close(b)}},btn2:function(a,b){layer.close(a)}})}else layer.msg("时间不能为空")}function judgeCompare(){var a;return 9==$("#selectType .txt").attr("rel")?(a="compare",$("#zi_start").html($("#selectTime").val()),$("#zi_end").html($("#endTime").val())):(a="compare1",$("#time_txt").html($("#slectFen .txt").html()),$("#time_start").html($("#selectTime").val()),$("#time_end").html($("#endTime").val())),a}function dickey(a){for(var b in a)return b}function loadHighcharData(screening,id,tag_taggroup,com){var statistic_type=$(".getshi a.active").attr("id"),charname=$(".getpic a.active").attr("id"),chardatetype=statistic_type,graph_type="1";"pie"==charname&&(graph_type="2");var tagId=null,tagType=null,history=[];switch(screening){case"screening":$.each($("#tree input[class*='skin-square-green']:checked"),function(a,b){tagId=$(this).attr("ids"),tagType=3==$(this).attr("id").split("-").length?2:1});break;case"select":tagId=id,tagType=tag_taggroup}if(null!=tagId){switch(com){case"compare":var firstTime={start_time:$("#selectTime").val(),end_time:$("#endTime").val()};history.push(firstTime),$("#compare div.historyInputCom").each(function(a,b){var c=$(b).find("input");if(c&&""!=$(c[0]).val()&&""!=$(c[1]).val()){var d={start_time:$(c[0]).val(),end_time:$(c[1]).val()};history.push(d)}});break;case"compare1":var firstTime={start_time:$("#selectTime").val(),end_time:$("#endTime").val()};history.push(firstTime),$("#compare1 div.historyInputCom1").each(function(a,b){var c=$(b).find("span.historyCom1Span");if(c){var d={start_time:$(c[0]).text(),end_time:$(c[1]).text()};history.push(d)}})}var datas={graph_type:graph_type,statistic_type:statistic_type,history:history,tagType:tagType,id:tagId};console.log("获取图标数据查看上传的数据:"+JSON.stringify(datas,null,2));var _r="api/energy/graph/history",colors=["#A4CD52","#E7706F","#9B77B3","#4CB3E3","#9B77B3","#477B36","#EABE43","#135083","#8B6527","#B3CE59","#E8767B","#9980AF","#5CB1E1","#A977AB","#427A46","#D7AA5E","#3B507B","#3B507B","#996725","#C0D060","#EA7D86","#9789AA","#67AEDE","#B576A2","#3C7856","#C2956F","#594F73","#A66922","#CDD065","#EC8392","#9491A3","#71ABDB","#C07698","#347667","#AF817C","#714F6A","#B46B1F","#D9D06D","#ED8A9F","#91989A","#7AA7D7","#CA758E","#2D7477","#9C6D84","#864E61","#C06C1C","#E4CF73","#EE91AB","#8D9E90","#83A4D4","#D57484","#237286","#895989","#9A4C59","#CC6E19","#EECE79","#F098B7","#89A584","#8BA0D1","#DE717A","#1D7095","#75468E","#AC494F","#D86F14","#F7CC7F","#FFA2CB","#85AB77","#919BCD","#E7706F","#E7706F","#1A6DA3","#62328F","#62328F","#BC4746","#E47113"];$.ajax({type:"post",url:enetgy_url+"api/energy/graph/history",dataType:"json",data:{data:JSON.stringify(datas)},beforeSend:function(){$(".loading").show()},success:function(result){if($(".loading").hide(),isHistoryData=!0,"pie"==charname)if(result.success){var seriesdata="[";if(result.success){var j=0;for(var keypie in result.data)seriesdata+='{name:"'+keypie+'",y:'+result.data[keypie]+',color:"'+colors[j]+'"},',j++;seriesdata=seriesdata.substring(0,seriesdata.length-1),seriesdata+="]"}}else seriesdata="[无能耗数据]";else if(result.success){var mainKey=dickey(result.data),returndata="[",areadata="[",i=0;for(var key in result.data){returndata+="{name:'"+key+"',marker:{enabled:true,radius:3},color:'"+colors[i]+"',data:[",areadata+="{name:'"+key+"',color:'"+colors[i]+"',data:[";var datename="";if(isEmptyObject(result.data[key]))returndata+="]",areadata+="]";else for(var keys in result.data[key]){switch(chardatetype){case"hour":datename=keys.substring(0,4)+"/"+keys.substring(4,6)+"/"+keys.substring(6,8)+" "+keys.substring(8,10)+":00:00";break;case"day":datename=keys.substring(0,4)+"/"+keys.substring(4,6)+"/"+keys.substring(6,8)+" 00:00:00";break;case"month":datename=keys.substring(0,4)+"/"+keys.substring(4,6)+"/01 00:00:00";break;case"year":datename=keys.substring(0,4)+"/01/01 00:00:00"}var datestr=new Date(datename);datestr=datestr.getTime()+288e5,returndata+="["+datestr+","+result.data[key][keys]+"],",areadata+="["+datestr+","+result.data[key][keys]+"],"}returndata=returndata.substring(0,returndata.length-1)+"]},",areadata=areadata.substring(0,areadata.length-1)+"]},",i++}returndata=returndata.substring(0,returndata.length-1)+"]",areadata=areadata.substring(0,areadata.length-1)+"]";var mainKey=dickey(result.data),textReturndata=eval("("+returndata+")"),textAreadata=eval("("+areadata+")");for(var dic in textReturndata)if(textReturndata[dic].name==mainKey)for(var dics in textReturndata)for(var dicss in textReturndata[dics].data)textReturndata[dic].data[dicss]&&(textReturndata[dics].data[dicss][0]=textReturndata[dic].data[dicss][0]);for(var dic in textAreadata)if(textAreadata[dic].name==mainKey)for(var dics in textAreadata)for(var dicss in textAreadata[dics].data)textAreadata[dic].data[dicss]&&(textAreadata[dics].data[dicss][0]=textAreadata[dic].data[dicss][0])}else returndata="[无能耗数据]",areadata="[无能耗数据]";console.log("returndata:"+JSON.stringify(returndata,null,2)),"column"==charname||"spline"==charname?$("#lineCharts").highcharts("StockChart",{chart:{backgroundColor:"#1C203F",alignTicks:!0,type:""+charname},tooltip:{xDateFormat:"%Y-%m-%d %H:%M:%S",shared:!0},rangeSelector:{allButtonsEnabled:!0,enabled:!1,buttonTheme:{width:60},selected:2},navigator:{enabled:!0,xAxis:{labels:{style:{color:"#fff"}},dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H点",day:"%Y年%m月%d日",week:"%e. %b",month:"%Y年%m月",year:"%Y年"}}},title:{text:""},legend:{symbolHeight:12,symbolWidth:18,symbolRadius:0,itemStyle:{color:"#ffffff"},layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0,enabled:!0},exporting:{enabled:!1},credits:{enabled:!1},xAxis:{labels:{style:{color:"#ffffff"}},lineColor:"#555769",type:"datetime",dateTimeLabelFormats:{second:"%Y-%m-%d<br/>%H:%M:%S",minute:"%Y-%m-%d<br/>%H:%M",hour:"%Y-%m-%d %H:00",day:"%Y-%m-%d",week:"%Y-%m-%d",month:"%Y-%m",year:"%Y-"}},yAxis:{labels:{style:{color:"#ffffff"}},gridLineColor:"#555769",opposite:!1,title:{style:{color:"#ffffff"},text:"耗电量(kWh)"}},series:"[无能耗数据]"==returndata?null:textReturndata}):"pie"==charname?$("#lineCharts").highcharts({chart:{backgroundColor:"#1C203F",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:""},tooltip:{pointFormat:"{series.name} : <b>{point.percentage:.1f}% ({point.y})</b>"},credits:{enabled:!1},exporting:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"#fff",fontWeight:"bold",textOutline:"none"}}}},series:[{type:"pie",name:"占比",data:"[无能耗数据]"==seriesdata?null:eval("("+seriesdata+")")}]}):"area"==charname&&$("#lineCharts").highcharts("StockChart",{chart:{backgroundColor:"#1C203F",type:"column"},tooltip:{xDateFormat:"%Y-%m-%d %H:%M:%S",shared:!0},rangeSelector:{allButtonsEnabled:!0,enabled:!1,buttonTheme:{width:60},selected:2},navigator:{enabled:!0,xAxis:{labels:{style:{color:"#fff"}},dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H点",day:"%Y年%m月%d日",week:"%e. %b",month:"%Y年%m月",year:"%Y年"}}},title:{text:""},legend:{symbolHeight:12,symbolWidth:18,symbolRadius:0,itemStyle:{color:"#ffffff"},layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0,enabled:!0},exporting:{enabled:!1},credits:{enabled:!1},xAxis:{labels:{style:{color:"#ffffff"}},lineColor:"#555769",type:"datetime",dateTimeLabelFormats:{second:"%Y-%m-%d<br/>%H:%M:%S",minute:"%Y-%m-%d<br/>%H:%M",hour:"%Y-%m-%d %H:00",day:"%Y-%m-%d",week:"%Y-%m-%d",month:"%Y-%m",year:"%Y-"}},yAxis:{labels:{style:{color:"#ffffff"}},gridLineColor:"#555769",opposite:!1,title:{style:{color:"#ffffff"},text:"耗电量(kWh)"}},plotOptions:{column:{stacking:"normal"}},series:"[无能耗数据]"==areadata?null:textAreadata})},complete:function(){$(".loading").hide()},error:function(a){$(".loading").hide(),layer.msg(a.error_message)}})}}function bindListener(a){$("div[id^=timeDiv] .img").unbind().click(function(){i-=2,$(this).parent().remove(),$("#"+a).parent().height($("#"+a).parent().height()-45)})}function selectDrown(a,b){$(".downselect .dropList"+a+" li a").one("click",function(){var c=$(this).text(),d=$(this).attr("rel");initAddreletiveAdd(b,a,d),$(".downselect #days"+a+" .txt").html(c).attr("rel",d),$(".downselect .dropList"+a+" li a").unbind("click")})}function initTime(){$("#selectTime").val(compareDate(1,6)),$("#endTime").val(compareDate(1,0)),$("#bao_day").val(getToday()),$("#bao_month").val(getMonth()),$("#bao_year").val(getYear())}function initAddreletiveAdd(a,b,c){var d=1,e=0;c&&(d=Number(c)),a=Number(a),1==a||2==a?1==a?($("#tians_"+b).html(compareDate(1,d)),$("#tiane_"+b).html(compareDate(1,d))):($("#tians_"+b).html(compareDate(1,d+1)),$("#tiane_"+b).html(compareDate(1,d+1))):3==a||4==a||5==a?(3==a?e=3:4==a?e=7:5==a&&(e=30),$("#tians_"+b).html(compareDate(1,e*d+e-1)),$("#tiane_"+b).html(compareDate(1,e*d))):6!=a&&7!=a&&8!=a||(e=1,6==a?(console.log("c*n:"+(e*d+1)),$("#tians_"+b).html(getCurrentMonthFirst(e*d+1)),$("#tiane_"+b).html(getCurrentMonthLastForSelect(compareDate(3,e*d+1)))):7==a?($("#tians_"+b).html(getCurrentMonthFirst(e*d+2)),$("#tiane_"+b).html(getCurrentMonthLastForSelect(compareDate(3,e*d+2)))):8==a&&($("#tians_"+b).html(getCurrentMonthFirst(e*d+3)),$("#tiane_"+b).html(getCurrentMonthLastForSelect(compareDate(3,e*d+3)))))}function initAdd(a,b,c){var d=1,e=0;c&&(d=Number(c)),a=Number(a),1==a||2==a?1==a?($("#tians_"+b).html(compareDate(1,d)),$("#tiane_"+b).html(compareDate(1,d))):($("#tians_"+b).html(compareDate(1,d+1)),$("#tiane_"+b).html(compareDate(1,d+1))):3==a||4==a||5==a?(3==a?e=3:4==a?e=7:5==a&&(e=30),$("#tians_"+b).html(compareDate(1,e*d+e)),$("#tiane_"+b).html(compareDate(1,e*d+1))):6!=a&&7!=a&&8!=a||(e=1,$("#tians_"+b).html(getCurrentMonthFirst(e*d+1)),$("#tiane_"+b).html(getCurrentMonthLast(compareDate(2,e*d+1))))}function checkTimeforZidingyiHistory(a,b){var c=checkEndTime($("#zi_start").html(),$("#zi_end").html(),2),d=$("#start"+b).val();$("#end"+b).val();$("#start"+b).datepicker().on("changeDate",function(a){d=$("#start"+b).val(),$("#end"+b).val(FormatDate(CutDays(parseDate(d),c,1),"yyyy-MM-dd"));checkEndTime("start"+b,"end"+b,1)})}function checkTime(a,b){var c=checkEndTime($("#zi_start").html(),$("#zi_end").html(),2),d=$("#start"+b).val(),e=$("#end"+b).val();""!=e&&1==a?$("#start"+b).datepicker().on("changeDate",function(a){d=$("#start"+b).val(),$("#end"+b).val(FormatDate(CutDays(parseDate(d),c,1),"yyyy-MM-dd")),checkEndTime("start"+b,"end"+b,1)||(layer.msg("结束时间需晚于开始时间"),$("#end"+b).val("")),checkEndTime(d,$("#end"+b).val(),2)!=c&&(layer.msg("步长不一致"),$("#end"+b).val(""))}):$("#end"+b).datepicker().on("changeDate",function(a){e=$("#end"+b).val(),$("#start"+b).val(FormatDate(CutDays(parseDate(e),c),"yyyy-MM-dd"));var f=new Date($("#start"+b).val().replace("-","/").replace("-","/"));d=$("#start"+b).val(),checkEndTime("start"+b,"end"+b,1)||(layer.msg("结束时间需晚于开始时间"),$("#end"+b).val("")),compareYear(f,10)<=a.date.toLocaleDateString()&&($("#end"+b).val(""),layer.msg("超过统计时间限制")),checkEndTime(d,e,2)!=c&&(layer.msg("步长不一致"),$("#end"+b).val(""))})}function formatDate(a){var b=a.substring(0,4)+"-";return b+=a.substring(4,6)+"-",b+=a.substring(6,8)}function checkTree(a,b){var c=new Array,d="",e=$("#"+a+" input[class*='skin-square-green']:checked").length;return b||($(".getpic a").removeClass("active").addClass("hide"),0==e?($(".getpic a").removeClass("hide"),$("#history").removeClass("btnborder_disabled").removeAttr("disabled")):1==e?($(".getpic a").removeClass("hide"),$("#history").removeClass("btnborder_disabled").removeAttr("disabled")):($("#history").addClass("btnborder_disabled").attr("disabled","disabled"),e<=16&&$(".getpic a").removeClass("hide"),e>16&&$(".getpic a").removeClass("hide"))),e>64&&$("#"+a+" .icheckbox_square-green']").on("ifUnchecked",function(b){$("#"+a+" input[class*='skin-square-green']").iCheck("uncheck")}),$.each($("#"+a+" input[class*='skin-square-green']:checked"),function(a,b){d+=$(this).attr("id")+","}),c[0]=e,c[1]=d,c}function clearSelection(a){$("#"+a+" label").each(function(){$(this).find(".highlight").each(function(){$(this).replaceWith($(this).html())})})}function highlight(a,b){$("#"+b+" .f1 div[class*='in']").removeClass("in"),clearSelection(b);var c=$("#"+a).val(),d=new RegExp(c,"g"),e=$("#"+b+" label").text();if(!d.test(e))return void layer.msg("没有找到符合你条件的数据！");$("#"+b+" label").each(function(){var a=$(this).html(),b=a.replace(d,'<span class="highlight">'+c+"</span>");if(-1!=b.indexOf("highlight"))if($(this).parents("h4").hasClass("panel-title")){var e=$(this).parents("h4 a").attr("href");$(""+e).addClass("in").css("height","")}else{var f=$(this).parents(".panel-collapse").attr("id");$("#"+f).addClass("in").css("height","")}$(this).html(b)})}function leftList(a){var b="";1==a?b="api/energy/graph/list":2==a&&(b="api/energy/report/list"),$.ajax({type:"GET",url:enetgy_urls,dataType:"json",data:{r:b},success:function(b){if(console.log("数据："+JSON.stringify(b,null,2)),b.success){var c=1==a?"自定义图表":"自定义报表",d=1==a?2:3,e='<aside class="aside"><h4>'+c+"</h4><hr/><ul>";$.each(b.data,function(a,b){e+='<li onclick="SelectActive(this,'+d+')" ids="'+b.id+'" ><span><a style="font-size:14px;">'+b.name+"</a></span></li>"}),e+="</ul></aside>"}else{var c=1==a?"自定义图表":"自定义报表",d=1==a?2:3,e='<aside class="aside"><h4>'+c+"</h4><hr/><ul>";e+=b.error_message,e+="</ul></aside>",returnLogIn(b.error_message)}var f=1==a?"leftNames":"bao_leftNames";$("#"+f+" .mCSB_container").append(e),$("#"+f).mCustomScrollbar({scrollButtons:{enable:!1}})}})}function clearCheck(a){1==a?($("#tree input").iCheck("uncheck"),clearSelection("tree"),$("#history").removeClass("btnborder_disabled").removeAttr("disabled")):($("#trees input").iCheck("uncheck"),clearSelection("trees"))}function getTree(a,b){$("#"+a).val()?highlight(a,b):layer.msg("请输入统计对象名称")}function rightTree(a){$.ajax({type:"GET",url:enetgy_urls,dataType:"json",data:{r:"api/project/info"},success:function(b){$(".loading").css("display","block"),b.success?$.ajax({type:"GET",url:enetgy_urls,dataType:"json",data:{r:"api/entity/tree/tree"},complete:function(){$(".loading").hide()},success:function(c){$(".loading").hide(),console.log("请求到的分组数据:"+JSON.stringify(c,null,2));var d="";c.success&&(d+='<div class="panel panel-default"><div class="panel-heading"><h4 class="panel-title"><a href="#'+a+"-"+b.data.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle" aria-expanded="true  pointGroups-name">'+b.data.name+"</a></h4></div>",d+='<div class="panel-collapse collapse in" id="'+a+"-"+b.data.id+'" aria-expanded="false" ><div class="panel-body">',$.each(c.data,function(b,c){var e,f,g;if(f=!c.hide_tag,g=!!c.next_level,e=!1===g&&!1===f?"":"add",d+='<div class="panel panel-default"><div class="panel-heading fang" style="padding-left:0;padding-right:0px;" ><h4 class="panel-title">',d+=""===e?'<a  href="#'+a+"-"+c.id+'" data-parent="#accordion"  class="one-step accordion-toggle  '+e+' pointGroups-a" aria-expanded="true">':'<a  href="#'+a+"-"+c.id+'" data-parent="#accordion" data-toggle="collapse" class="one-step accordion-toggle  '+e+' pointGroups-a" aria-expanded="false">',d+='<input tabindex="5" type="checkbox" id="'+a+"-"+c.id+"-"+b+'"  class="skin-square-green fu" ids="'+c.id+'" ><label  class="form-label pointGroups-label">'+c.name+"</label></a></h4></div></div>",d+='<div class="panel-collapse collapse in" id="'+a+"-"+c.id+'" aria-expanded="true">',c.next_level&&(console.log("进入第二层"),$.each(c.next_level,function(b,c){var e,f,g;if(f=!c.hide_tag,g=!!c.next_level,e=!1===g&&!1===f?"":"add",d+='<div class="panel panel-default" ><div class="panel-heading fang" style="margin-left: 23px;padding-top:5px;padding-right:0;"><h4 class="panel-title ">',d+=""===e?'<a  href="#'+a+"-"+c.id+'" data-parent="#accordion"  class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">':'<a  href="#'+a+"-"+c.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">',d+='<input tabindex="5" type="checkbox" id="'+a+"-"+c.id+"-"+b+'"  class="skin-square-green fu" ids="'+c.id+'" ><label  class="form-label pointGroups-label">'+c.name+"</label></a></h4></div></div>",d+='<div class="panel-collapse collapse " id="'+a+"-"+c.id+'" aria-expanded="false" style="height: 0px;">',c.next_level&&(console.log("进入第三层"),$.each(c.next_level,function(b,c){var e,f,g;if(f=!c.hide_tag,g=!!c.next_level,e=!1===g&&!1===f?"":"add",d+='<div class="panel panel-default" style="padding-left:30px;"><div class="panel-heading fang" style="padding-left:45px;padding-top:5px;padding-right:0;"><h4 class="panel-title ">',d+=""===e?'<a  href="#'+a+"-"+c.id+'" data-parent="#accordion"  class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">':'<a  href="#'+a+"-"+c.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">',d+='<input tabindex="5" type="checkbox" id="'+a+"-"+c.id+"-"+b+'"  class="skin-square-green fu" ids="'+c.id+'" ><label  class="form-label pointGroups-label">'+c.name+"</label></a></h4></div></div>",d+='<div class="panel-collapse collapse " id="'+a+"-"+c.id+'" aria-expanded="false" style="height: 0px;padding-left:45px;">',c.hide_tag);else if(c.tag_id_tree){console.log("第三层子元素展示");var h=c.tag_id_tree;$.each(h,function(e,f){d+='<div class="panel-body tree-msg" style="padding-left:40px;padding-top:5px;padding-bottom:5px;"><a href="#'+a+"-"+f.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed pointGroups-a-son" aria-expanded="false"><input tabindex="5" oprate="'+f.oprate+'" type="checkbox" id="'+a+"-"+c.id+"-"+b+"-"+e+'" class="skin-square-green" ids="'+f.tag_id+'" ><label class="form-label pointGroups-label-son">'+f.name+"</label></a></div>"})}d+="</div>"})),c.hide_tag);else if(c.tag_id_tree){console.log("第二层子元素展示");var h=c.tag_id_tree;$.each(h,function(e,f){d+='<div class="panel-body tree-msg" style="padding-left:53px;;padding-top:5px;padding-bottom:5px;"><a href="#'+a+"-"+f.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed pointGroups-a-son" aria-expanded="false"><input tabindex="5" oprate="'+f.oprate+'" type="checkbox" id="'+a+"-"+c.id+"-"+b+"-"+e+'" class="skin-square-green" ids="'+f.tag_id+'" ><label class="form-label pointGroups-label-son">'+f.name+"</label></a></div>"})}d+="</div>"})),c.hide_tag);else if(c.tag_id_tree){console.log("第一层子元素展示");var h=c.tag_id_tree;$.each(h,function(e,f){d+='<div class="panel-body tree-msg" style=";margin-left: 25px;padding-top:5px;padding-bottom:5px;"><a href="#'+a+"-"+f.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed pointGroups-a-son" aria-expanded="false"><input tabindex="5" oprate="'+f.oprate+'" type="checkbox" id="'+a+"-"+c.id+"-"+b+"-"+e+'" class="skin-square-green" ids="'+f.tag_id+'" ><label class="form-label pointGroups-label-son">'+f.name+"</label></a></div>"})}d+="</div>"}),d+="</div></div></div>",$("#"+a+" .mCSB_container").append(d),$("#"+a).mCustomScrollbar("scrollTo"),ULTRA_SETTINGS.iCheck(),$.isFunction($.fn.iCheck)&&$("#"+a+" input.skin-square-green").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"}))}}):(html=result.error_message,returnLogIn(result.error_message))},error:function(a){$(".loading").hide()}})}function SelectData(a){if(1==a){$("#compare .addTime").html(""),$("#compare1 .addTime").html(""),$(".getpic a").removeClass("active");var b=checkTree("tree"),c=b[0],d=b[1];if(0==c){$("#lineCharts").html("");$("#lineCharts").append('<span id="sTitle" class="sTitle">统计对象为空</span>')}c>0&&c<=16?($(".getpic a:eq(0)").addClass("active"),isHistoryData=!1,bindCharts(c,d)):0!=c&&layer.msg("请选择不超过16条统计对象进行对比"),$(".tongji").hide()}else BaoTableList()}function SelectDataHistory(a,b,c,d){if(1==a){$(".getpic a").removeClass("active");var e=checkTree("tree"),f=e[0];e[1];f>0&&f<=16&&($(".getpic a:eq(0)").addClass("active"),loadHighcharData("select",b,c,d)),$(".tongji").hide()}else BaoTableList()}function Del(a){var b,c=1==a?$("#leftNames li.active").attr("ids"):$("#bao_leftNames li.active").attr("ids");b=1==a?"api/energy/graph/delete":"api/energy/report/delete",$.ajax({type:"post",url:enetgy_url+b+"",dataType:"json",data:{data:JSON.stringify({id:c})},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(b){if($(".loading").hide(),b.success){if(1==a){$("#leftNames aside").remove("aside"),leftList(1),$("#leftNames aside li").removeClass("active"),$("#lineCharts").highcharts().destroy(),$("#lineCharts").html("");$("#lineCharts").append('<span id="sTitle" class="sTitle">请选择统计对象生成图表</span>');var c=1==a?"tree":"trees";$("#"+c+" input[class*='skin-square-green']").iCheck("uncheck")}else{$("#bao_leftNames aside").remove("aside"),leftList(2),$("#bao_leftNames aside li").removeClass("active"),$("#noloud span.kong").text("请选择统计对象生成报表"),$("#noloud").show(),$("#tab_border").hide();var c=1==a?"tree":"trees";$("#"+c+" input[class*='skin-square-green']").iCheck("uncheck")}layer.msg("删除成功")}else layer.msg("请选择要删除的图表"),returnLogIn(b.error_message)},error:function(a){$(".loading").hide(),layer.msg("删除失败:"+a.error_message)}})}function Objfu(a,b,c){this.id=a,this.selected=b,this.tags=c}function Objzi(a,b){this.id=a,this.oprate=b}function Dictionary(){this.data=new Array,this.put=function(a,b){this.data[a]=b}}function getdata(a){var b,c,d=null,e=null,f=null,g="[]",h="[]",i=[];if(9!=$("#slectFen button .txt").attr("rel")){b=1;switch(Number($("#slectFen button .txt").attr("rel"))){case 1:d="day",c=0;break;case 2:d="day",c=-1;break;case 3:d="day",c=-3;break;case 4:d="day",c=-7;break;case 5:d="day",c=-30;break;case 6:d="month",c=-1;break;case 7:d="month",c=-2;break;case 8:d="month",c=-3}if(checkTree("tree",1)[0]<=1){g="[";for(var j=$("#compare1 .addTime div").length,k=1;k<j+1;k++)g+='{"day":-'+$("#compare1 .addTime #days"+k+" .txt").attr("rel")+"}",k!=j&&(g+=",");g+="]"}}else if(b=2,e=$("#selectTime").val(),f=$("#endTime").val(),checkTree("tree",1)[0]<=1){var j=$("#compare .addTime div").length;h="[";for(var k=1;k<=j;k++){var l=$("#start"+k).val(),m=$("#end"+k).val();""!=l&&""!=m&&(l=l.replace(new RegExp(/(-)/g),""),m=m.replace(new RegExp(/(-)/g),""),h+='{"start":'+l+',"end":'+m+"}",k!=j&&(h+=","))}h+="]"}if($.each($("#tree input[class*='skin-square-green']:checked"),function(a,b){if($(this).hasClass("fu")){var c=$(this).attr("id").split("-");$(this).parent().next().html();i.push(new Objfu($(this).attr("ids"),1,null))}else{var d=$(this).attr("id").split("-"),e=d[1],f=0;if(i.length>0){var g=$(this).attr("ids"),h=($(this).parent().next().html(),$(this).attr("oprate")),j=[];$.each(i,function(a,b){if(b.id==e)return f=1,null==i[a].tags?(j.push(new Objzi(g,h)),i[a].tags=j):i[a].tags.push(new Objzi(g,h)),!1})}if(0==f){var j=[],c=$(this).attr("id").split("-");$("#tree input[class~='fu'][id*='"+c[0]+"-"+c[1]+"']").parent().next().html();j.push(new Objzi($(this).attr("ids"),$(this).attr("oprate"))),i.push(new Objfu(c[1],0,j))}}}),a){var n=$("#leftNames aside li.active").attr("ids"),o=$("#leftNames aside li.active a").html();datas={id:n,name:o,type:b,length_unit:d,lengths:c,start_time:e,end_time:f,relative_history:g,absolute_history:h,tag_id_tree:JSON.stringify(i)}}else{var o=$("#fieldName").val();datas={name:o,type:b,length_unit:d,lengths:c,start_time:e,end_time:f,relative_history:g,absolute_history:h,tag_id_tree:JSON.stringify(i)}}return console.log("查看数据:"+JSON.stringify(datas)),datas}function save(a){var b;if(1==a)$("#leftNames aside li").hasClass("active")?(b="api/energy/graph/update",$.ajax({type:"post",url:enetgy_url+b+"",dataType:"json",data:{data:JSON.stringify(getdata(1))},success:function(a){a.success?layer.msg("更新成功"):(layer.alert(a.error_message,{title:["错误信息"],skin:"lay-alert",move:!1}),returnLogIn(a.error_message))}})):otherSave(1,"fieldName","保存");else if($("#bao_leftNames aside li").hasClass("active")){console.log("新建能耗报表上传的数据:"+JSON.stringify(reportData(1),null,2));var c=!1;b="api/energy/report/update",c||($.ajax({type:"post",url:enetgy_url+b+"",dataType:"json",data:{data:JSON.stringify(reportData(1))},success:function(a){a.success?layer.msg("更新成功"):(layer.alert(a.error_message,{title:["错误信息"],skin:"lay-alert",move:!1}),returnLogIn(a.error_message))}}),c=!0)}else otherSave(2,"fieldName","保存")}function reportData(a){var b,c,d,e,f,g=[];switch(Number($("#selectBao button .txt").attr("rel"))){case 1:b="day",e=$("#bao_day").val();break;case 2:b="month",e=$("#bao_month").val();break;case 3:b="year",e=$("#bao_year").val()}return $.each($("#trees input[class*='skin-square-green']:checked"),function(a,b){if($(this).hasClass("fu")){var c=$(this).attr("id").split("-");$(this).parent().next().html();g.push(new Objfu($(this).attr("ids"),1,null))}else{var d=$(this).attr("id").split("-"),e=d[1],f=0;if(g.length>0){var h=$(this).attr("ids"),i=($(this).parent().next().html(),$(this).attr("oprate")),j=[];$.each(g,function(a,b){if(b.id==e)return f=1,null==g[a].tags?(j.push(new Objzi(h,i)),g[a].tags=j):g[a].tags.push(new Objzi(h,i)),!1})}if(0==f){var j=[],c=$(this).attr("id").split("-");$("#tree input[class~='fu'][id*='"+c[0]+"-"+c[1]+"']").parent().next().html();j.push(new Objzi($(this).attr("ids"),$(this).attr("oprate"))),g.push(new Objfu(c[1],0,j))}}}),a?(c=$("#bao_leftNames aside li.active").attr("ids"),d=$("#bao_leftNames aside li.active a").html(),f={id:c,name:d,type:b,date:e,tag_id_tree:JSON.stringify(g)}):(d=$("#fieldName").val(),f={name:d,type:b,date:e,tag_id_tree:JSON.stringify(g)}),f}function check_tree(a,b){$(".loading").show(),$(".addTime").html("");var c,d;1==a?(d="api/energy/graph/get",c={id:b,r:d}):(d="api/energy/report/get",c={id:b,r:d}),$.ajax({type:"post",url:enetgy_url+d+"",dataType:"json",data:{data:JSON.stringify(c)},success:function(b){$(".loading").hide(),console.log("查看:"+JSON.stringify(b,null,2));var c=1==a?"tree":"trees";if(b.success)if($("#"+c+" input[class*='skin-square-green']").iCheck("uncheck"),null!=b.data.tag_id_tree&&$.each(b.data.tag_id_tree,function(a,b){1==b.selected&&$("a[href='#"+c+"-"+b.id+"']").find(".skin-square-green").iCheck("check"),b.tags&&($("#"+c+"-"+b.id).addClass("in").css("height",""),$.each(b.tags,function(a,d){$("#"+c+"-"+b.id).find("input[ids='"+d.id+"']").iCheck("check")}))}),1==a){if(1==b.data.type){var d=b.data.lengths;switch($(".getshi a").removeClass("active").addClass("hide"),b.data.length_unit){case"day":0==d?($("#slectFen button .txt").html("今天").attr("rel","1"),$("#selectTime").val(FormatDate(new Date,"yyyy-MM-dd")),$("#endTime").val(FormatDate(new Date,"yyyy-MM-dd")),$(".getshi a:eq(0)").removeClass("hide").addClass("active")):-1==d?($("#slectFen button .txt").html("昨天").attr("rel","2"),$("#selectTime").val(compareDate(1,1)),$("#endTime").val(compareDate(1,1)),
$(".getshi a:eq(0)").removeClass("hide").addClass("active")):-3==d?($("#slectFen button .txt").html("最近3天").attr("rel","3"),$("#selectTime").val(compareDate(1,2)),$("#endTime").val(compareDate(1,0)),$(".getshi a:eq(0)").removeClass("hide").addClass("active"),$(".getshi a:eq(1)").removeClass("hide")):-7==d?($("#slectFen button .txt").html("最近7天").attr("rel","4"),$("#selectTime").val(compareDate(1,6)),$("#endTime").val(compareDate(1,0)),$(".getshi a:eq(0)").removeClass("hide").addClass("active"),$(".getshi a:eq(1)").removeClass("hide")):-30==d&&($("#slectFen button .txt").html("最近30天").attr("rel","5"),$("#selectTime").val(compareDate(1,29)),$("#endTime").val(compareDate(1,0)),$(".getshi a:eq(1)").removeClass("hide").addClass("active"));break;case"month":if(-1==d){$("#slectFen button .txt").html(compareDate(2,1)+"月").attr("rel","6");var e=new Date,f=Number(e.getMonth()+1);1===f?$("#selectTime").val(e.getFullYear()-1+"-"+compareDate(2,1)+"-01"):$("#selectTime").val(e.getFullYear()+"-"+compareDate(2,1)+"-01");compareDate(2,1);$("#endTime").val(getCurrentMonthLastForSelect($("#selectTime").val())),$(".getshi a:eq(1)").removeClass("hide").addClass("active"),$(".getshi a:eq(2)").removeClass("hide")}else if(-2==d){var e=new Date,f=Number(e.getMonth()+1);1===f||2===f?$("#selectTime").val(e.getFullYear()-1+"-"+compareDate(2,2)+"-01"):$("#selectTime").val(e.getFullYear()+"-"+compareDate(2,2)+"-01"),$("#slectFen button .txt").html(compareDate(2,2)+"月").attr("rel","7");compareDate(2,2);$("#endTime").val(getCurrentMonthLastForSelect($("#selectTime").val())),$(".getshi a:eq(1)").removeClass("hide").addClass("active"),$(".getshi a:eq(2)").removeClass("hide")}else if(-3==d){var e=new Date,f=Number(e.getMonth()+1);1===f||2===f||3===f?$("#selectTime").val(e.getFullYear()-1+"-"+compareDate(2,3)+"-01"):$("#selectTime").val(e.getFullYear()+"-"+compareDate(2,3)+"-01"),$("#slectFen button .txt").html(compareDate(2,3)+"月").attr("rel","8");compareDate(2,3);$("#endTime").val(getCurrentMonthLastForSelect($("#selectTime").val())),$(".getshi a:eq(1)").removeClass("hide").addClass("active"),$(".getshi a:eq(2)").removeClass("hide")}}}else{$("#selectTime").val(b.data.start_time),$("#endTime").val(b.data.end_time),$("#slectFen button .txt").html("自定义").attr("rel","9");var g=$("#selectTime").val(),h=$("#endTime").val();if(""!=g&&""!=h){$(".getshi a").removeClass("active").addClass("hide");var i=checkEndTime(g,h,2);1==i||0==i?$(".getshi a:eq(0)").removeClass("hide").addClass("active"):i>1&&i<=7?($(".getshi a:eq(0)").removeClass("hide").addClass("active"),$(".getshi a:eq(1)").removeClass("hide")):i>7&&i<=30?$(".getshi a:eq(1)").removeClass("hide").addClass("active"):i>30&&i<=180?($(".getshi a:eq(1)").removeClass("hide").addClass("active"),$(".getshi a:eq(2)").removeClass("hide")):i>180&&i<=365?$(".getshi a:eq(2)").removeClass("hide").addClass("active"):($(".getshi a:eq(2)").removeClass("hide").addClass("active"),$(".getshi a:eq(3)").removeClass("hide"))}}if(0!=b.data.absolute_history.length&&0==b.data.relative_history.length&&getHistory(b.data.absolute_history,1,b.data.length_unit),0!=b.data.relative_history.length&&0==b.data.absolute_history.length&&getHistory(b.data.relative_history,2,b.data.length_unit),0!=b.data.absolute_history.length||0!=b.data.relative_history.length)if(isHistoryData=!0,0==b.data.tag_id_tree.length){$("#lineCharts").html("");var j='<span id="sTitle" class="sTitle">统计对象为空</span>';$("#lineCharts").append(j)}else 0!=b.data.absolute_history.length?0==b.data.tag_id_tree[0].selected?SelectDataHistory(1,b.data.tag_id_tree[0].tags[0].id,1,"compare"):SelectDataHistory(1,b.data.tag_id_tree[0].id,2,"compare"):0==b.data.tag_id_tree[0].selected?SelectDataHistory(1,b.data.tag_id_tree[0].tags[0].id,1,"compare1"):SelectDataHistory(1,b.data.tag_id_tree[0].id,2,"compare1");else if(isHistoryData=!1,0==b.data.tag_id_tree.length){$("#lineCharts").html("");var j='<span id="sTitle" class="sTitle">统计对象为空</span>';$("#lineCharts").append(j)}else SelectData(1)}else{var k=b.data.type,l=b.data.date;switch($("#selectInput input").hide(),k){case"day":$("#selectTypes .txt").attr("rel"),$("#selectTypes .txt").html("日报").attr("rel","1"),$("#bao_day").val(l).show();break;case"month":$("#selectTypes .txt").attr("rel"),$("#selectTypes .txt").html("月报").attr("rel","2"),$("#bao_month").val(l).show();break;case"year":$("#selectTypes .txt").attr("rel"),$("#selectTypes .txt").html("年报").attr("rel","3"),$("#bao_year").val(l).show()}0!=b.data.tag_id_tree.length?BaoTableList():($("#noloud span.kong").text("统计对象为空"),$("#tab_border").hide(),$("#noloud").show())}else returnLogIn(b.error_message)},error:function(a){$(".loading").hide(),layer.alert(result.data,{title:["错误信息"],skin:"lay-alert",move:!1})}})}function getHistory(a,b,c){var d=$("#selectType .txt").attr("rel"),e="";if(1!=d&&2!=d||(e="天"),3!=d&&4!=d&&5!=d||(e+="个",3==d?e+="3":4==d?e+="7":5==d&&(e+="30"),e+="天"),6!=d&&7!=d&&8!=d||(e="个月"),1==b){var d=$("#selectType .txt").attr("rel"),f="";i=a.length,$.each(a,function(a,b){var c=formatDate(String(b.start)),d=formatDate(String(b.end));f=$('<div class = "historyInputCom" id="timeDiv'+i+'"><span class="timetext">对比时间段</span><span class="times"><input type="text" data-format="yyyy-mm-dd" class="form-controls form-control datepicker" id="start'+i+'" onclick="checkTime(1,'+i+')"  onchange="checkTime(1,'+i+')" readonly="readonly" value="'+c+'"></span><lable class="spare">至</lable><span class="times"><input type="text" data-format="yyyy-mm-dd" class="form-controls form-control datepicker" id="end'+i+'"  onclick="checkTime(2,'+i+')" onchange="checkTime(2,'+i+')"  readonly="readonly" value="'+d+'"></span><span class="img"><img src="images/icon/delete.png"></span></div>'),f.appendTo($("#compare .addTime")),bindListener("compare"),ULTRA_SETTINGS.otherScripts(),i--})}else{var f="";i=a.length,$.each(a,function(a,b){f=$('<div class="historyInputCom1"  id="timeDiv'+i+'"><span class="timetext">对比时间段</span><span class="times">之前的第</span><section class="btn-group downselect"><button aria-expanded="false" data-toggle="dropdown" class="btn  btn-border dropdown-toggle" type="button" id="days'+i+'" style="width:95px;margin-left:0px" onclick="selectDrown('+i+","+d+')"><span class="txt" rel="'+Math.abs(b.day)+'">'+Math.abs(b.day)+'</span><span class="carets sarrow"></span><span class="sr-only"></span></button><ul role="menu" class="dropdown-menu  dropList dropList'+i+'"><li><a href="#" rel="1" class="selected">1</a></li><li><a href="#" rel="2">2</a></li><li><a href="#" rel="3">3</a></li><li><a href="#" rel="4">4</a></li><li><a href="#" rel="5">5</a></li><li><a href="#" rel="6">6</a></li><li><a href="#" rel="7">7</a></li><li><a href="#" rel="8">8</a></li><li class="9"><a href="#" rel="9">9</a></li></ul></section><lable class="spare" style="padding-left:0px;">'+e+'</lable><span class="times historyCom1Span" id="tians_'+i+'"></span><span class="spare">至</span><span class="times historyCom1Span" id="tiane_'+i+'"></span><span class="img"><img src="images/icon/delete.png"></span></div>'),f.appendTo($("#compare1 .addTime")),initAddreletiveAdd(d,i,Math.abs(b.day)),bindListener("compare1"),i--})}}function selectCharts(a){$(".getpic a").removeClass("active");var b=checkTree("tree"),c=b[1],d=b[0];if(0==d){$("#lineCharts").html("");$("#lineCharts").append('<span id="sTitle" class="sTitle">统计对象为空</span>')}if(d>0&&d<=16){if($(a).addClass("active"),1==isHistoryData){loadHighcharData("screening","screening","screening",judgeCompare())}0==isHistoryData&&bindCharts(d,c)}else 0!=d&&layer.msg("请选择不超过16条统计对象进行对比")}function selectDate(a){$(".getshi a").removeClass("active"),$(a).addClass("active");var b=checkTree("tree",1)[0];if(0==b){$("#lineCharts").html("");$("#lineCharts").append('<span id="sTitle" class="sTitle">统计对象为空</span>')}if(b>0&&b<=16){if(1==isHistoryData){loadHighcharData("screening","screening","screening",judgeCompare())}0==isHistoryData&&bindCharts(b)}else 0!=b&&layer.msg("请选择不超过16条统计对象进行对比");$("lineCharts").html("NTD026")}function bindCharts(treenodecount,ids){var chardatetype=$(".getshi a.active").attr("id"),charname=$(".getpic a.active").attr("id"),graph_type="1";"pie"==charname&&(graph_type="2");var _r="api/energy/graph/table",statistic_type=chardatetype,start_time=$("#selectTime").val(),end_time=$("#endTime").val(),tagGroups=[],tags=[];$.each($("#tree input[class*='skin-square-green']:checked"),function(a,b){3==$(this).attr("id").split("-").length?tagGroups.push($(this).attr("ids")):tags.push($(this).attr("ids"))});var colors=["#A4CD52","#E7706F","#9B77B3","#4CB3E3","#9B77B3","#477B36","#EABE43","#135083","#8B6527","#B3CE59","#E8767B","#9980AF","#5CB1E1","#A977AB","#427A46","#D7AA5E","#3B507B","#3B507B","#996725","#C0D060","#EA7D86","#9789AA","#67AEDE","#B576A2","#3C7856","#C2956F","#594F73","#A66922","#CDD065","#EC8392","#9491A3","#71ABDB","#C07698","#347667","#AF817C","#714F6A","#B46B1F","#D9D06D","#ED8A9F","#91989A","#7AA7D7","#CA758E","#2D7477","#9C6D84","#864E61","#C06C1C","#E4CF73","#EE91AB","#8D9E90","#83A4D4","#D57484","#237286","#895989","#9A4C59","#CC6E19","#EECE79","#F098B7","#89A584","#8BA0D1","#DE717A","#1D7095","#75468E","#AC494F","#D86F14","#F7CC7F","#FFA2CB","#85AB77","#919BCD","#E7706F","#E7706F","#1A6DA3","#62328F","#62328F","#BC4746","#E47113"];datas={r:_r,graph_type:graph_type,statistic_type:statistic_type,start_time:start_time,end_time:end_time,tagGroups:tagGroups,tags:tags},console.log("上传的数据:"+JSON.stringify(datas,null,2)),$.ajax({type:"post",url:enetgy_url+_r+"",dataType:"json",data:{data:JSON.stringify(datas)},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(result){if(console.log("请求的数据:"+JSON.stringify(result,null,2)),result.success){if("pie"==charname)if(result.success){var seriesdata="[";if(result.success){var j=0;for(var keypie in result.data)seriesdata+='{name:"'+keypie+'",y:'+result.data[keypie]+',color:"'+colors[j]+'"},',j++;seriesdata=seriesdata.substring(0,seriesdata.length-1),seriesdata+="]"}}else seriesdata="[无能耗数据]";else if(result.success){var returndata="[",areadata="[",i=0;for(var key in result.data){returndata+="{name:'"+key+"',marker:{enabled:true,radius:3},color:'"+colors[i]+"',data:[",areadata+="{name:'"+key+"',color:'"+colors[i]+"',data:[";var datename="";if(isEmptyObject(result.data[key]))returndata+="]",areadata+="]";else for(var keys in result.data[key]){switch(chardatetype){case"hour":datename=keys.substring(0,4)+"/"+keys.substring(4,6)+"/"+keys.substring(6,8)+" "+keys.substring(8,10)+":00:00";break;case"day":datename=keys.substring(0,4)+"/"+keys.substring(4,6)+"/"+keys.substring(6,8)+" 00:00:00";break;case"month":datename=keys.substring(0,4)+"/"+keys.substring(4,6)+"/01 00:00:00";break;case"year":datename=keys.substring(0,4)+"/01/01 00:00:00"}var datestr=new Date(datename);datestr=datestr.getTime()+288e5,returndata+="["+datestr+","+result.data[key][keys]+"],",areadata+="["+datestr+","+result.data[key][keys]+"],"}returndata=returndata.substring(0,returndata.length-1)+"]},",areadata=areadata.substring(0,areadata.length-1)+"]},",i++}returndata=returndata.substring(0,returndata.length-1)+"]",areadata=areadata.substring(0,areadata.length-1)+"]"}else returndata="[无能耗数据]",areadata="[无能耗数据]";console.log("returndata:"+JSON.stringify(returndata)),"column"==charname||"spline"==charname?$("#lineCharts").highcharts("StockChart",{chart:{backgroundColor:"#1C203F",alignTicks:!0,type:""+charname},tooltip:{xDateFormat:"%Y-%m-%d %H:%M:%S",shared:!0},rangeSelector:{allButtonsEnabled:!0,enabled:!1,buttonTheme:{width:60},selected:2},navigator:{enabled:!0,xAxis:{labels:{style:{color:"#fff"}},dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H点",day:"%Y年%m月%d日",week:"%e. %b",month:"%Y年%m月",year:"%Y年"}}},title:{text:""},legend:{symbolHeight:12,symbolWidth:18,symbolRadius:0,itemStyle:{color:"#ffffff"},layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0,enabled:!0},exporting:{enabled:!1},credits:{enabled:!1},xAxis:{labels:{style:{color:"#ffffff"}},lineColor:"#555769",type:"datetime",dateTimeLabelFormats:{second:"%Y-%m-%d<br/>%H:%M:%S",minute:"%Y-%m-%d<br/>%H:%M",hour:"%Y-%m-%d %H:00",day:"%Y-%m-%d",week:"%Y-%m-%d",month:"%Y-%m",year:"%Y-"}},yAxis:{labels:{style:{color:"#ffffff"}},gridLineColor:"#555769",opposite:!1,title:{style:{color:"#ffffff"},text:"耗电量(kWh)"}},series:"[无能耗数据]"==returndata?null:eval("("+returndata+")")}):"pie"==charname?$("#lineCharts").highcharts({chart:{backgroundColor:"#1C203F",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:""},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name} : <b>{point.percentage:.1f}% ({point.y})</b>"},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"#fff",fontWeight:"bold",textOutline:"none"}}}},series:[{type:"pie",name:"占比",data:"[无能耗数据]"==seriesdata?null:eval("("+seriesdata+")")}]}):"area"==charname&&$("#lineCharts").highcharts("StockChart",{chart:{backgroundColor:"#1C203F",type:"column"},tooltip:{xDateFormat:"%Y-%m-%d %H:%M:%S",shared:!0},rangeSelector:{allButtonsEnabled:!0,enabled:!1,buttonTheme:{width:60},selected:2},navigator:{enabled:!0,xAxis:{labels:{style:{color:"#fff"}},dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H点",day:"%Y年%m月%d日",week:"%e. %b",month:"%Y年%m月",year:"%Y年"}}},title:{text:""},legend:{symbolHeight:12,symbolWidth:18,symbolRadius:0,itemStyle:{color:"#ffffff"},layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0,enabled:!0},exporting:{enabled:!1},credits:{enabled:!1},xAxis:{labels:{style:{color:"#ffffff"}},lineColor:"#555769",type:"datetime",dateTimeLabelFormats:{second:"%Y-%m-%d<br/>%H:%M:%S",minute:"%Y-%m-%d<br/>%H:%M",hour:"%Y-%m-%d %H:00",day:"%Y-%m-%d",week:"%Y-%m-%d",month:"%Y-%m",year:"%Y-"}},yAxis:{labels:{style:{color:"#ffffff"}},gridLineColor:"#555769",opposite:!1,title:{style:{color:"#ffffff"},text:"耗电量(kWh)"}},plotOptions:{column:{stacking:"normal"}},series:"[无能耗数据]"==areadata?null:eval("("+areadata+")")})}else{$("#lineCharts").html("");var spanwarn='<span id="sTitle" class="sTitle">无能耗数据</span>';$("#lineCharts").append('<span id="sTitle" class="sTitle">无能耗数据</span>'),returnLogIn(result.error_message)}},error:function(a){$(".loading").hide(),$("#lineCharts").html(""),layer.msg("请求失败:"+a.error_message)}})}function isEmptyObject(a){var b;for(b in a)return!1;return!0}function table_content(a,b){var c="";if(c+="<tr>",c+="<th>名称</th>",1==a)for(var d=0;d<24;d++)c+="<th>"+d+"时</th>";else if(2==a){if(b){var e=b.split("-");b=getMothCount(e[0],e[1]);for(var d=1;d<b+1;d++)c+="<th>"+d+"号</th>"}}else if(3==a)for(var d=1;d<13;d++)c+="<th>"+d+"月</th>";c+="</tr>",$("#baoList thead").html(c)}function initData(a){if(2==a){""!=$("#bao_leftNames").html()||(leftList(2),rightTree("trees"),window.onresize=function(){initScrollerA("trees"),initScrollerA("bao_leftNames")},initScrollerA("trees"),initScrollerA("bao_leftNames"),$("#trees input.skin-square-green").on("ifUnchecked ifChecked",function(){checkTree("trees",1)}),$("#tab_border").css("opacity","0"))}}function BaoTableList(){var a=$("#selectTypes .txt").attr("rel"),b=checkTree("trees",1),c=b[0],d="",e="",f="";if(c<=0)return $("#noloud span.kong").text("未选择任何对象"),$("#noloud").show(),$("#tab_border").hide(),void $("#tongjis").hide();switch(a){case"1":e=$("#bao_day").val(),f="day";break;case"2":e=$("#bao_month").val(),f="month";break;case"3":e=$("#bao_year").val(),f="year"}var g=[],h=[];$.each($("#trees input[class*='skin-square-green']:checked"),function(a,b){3==$(this).attr("id").split("-").length?g.push($(this).attr("ids")):h.push($(this).attr("ids"))});var i={type:f,date:e,tagGroups:g,tags:h};$.ajax({type:"post",url:enetgy_url+"api/energy/report/table",dataType:"json",data:{data:JSON.stringify(i)},beforeSend:function(){$(".loading").show()},success:function(b){if($(".loading").hide(),b.success){var c=!0;for(var f in b.data)if(!isEmptyObject(b.data[f])){c=!1;break}if(c)$("#noloud span.kong").text("暂无数据"),$("#noloud").show(),$("#tab_border").hide();else{2==a?table_content(a,e):table_content(a);for(var f in b.data){d+="<tr><td>"+f+"</td>";for(var g in b.data[f])d+="<td>"+b.data[f][g]+"</td>";d+="</tr>"}$("#tab_border").css("opacity","1"),$("#noloud").hide(),$("#tab_border").show(),$("#baoList tbody").html(d)}}else $("#noloud span.kong").text("暂无数据"),$("#tab_border").hide(),$("#noloud").show(),returnLogIn(b.error_message)},complete:function(){$(".loading").hide()},error:function(a){$(".loading").hide(),layer.msg(a.error_message)}}),$("#tongjis").hide()}function changeTime(){$("#bao_day").datepicker().on("changeDate",function(a){BaoTableList()}),$("#bao_month").datepicker().on("changeDate",function(a){BaoTableList()}),$("#bao_year").datepicker().on("changeDate",function(a){BaoTableList()})}function RegeMatch(a){var b=new RegExp(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5\-_]/g);if(""!=a.val()&&null!=a)return!b.test(a.val())}function fileName_s(a,b){var c=$("#"+a).val(),d=0,e=new RegExp("[`~\\\\!@#$%^&*()_+<>?？:\"{},，。！./;'[\\]]");if(c){if(e.test(c))return $("#"+a).next().html("不能输入特殊字符").show(),!1;for(var f=0;f<c.length;f++)c.charCodeAt(f)>127||94==c.charCodeAt(f)?d+=2:d++;if(d>64)return layer.msg("输入超过规定长度"),!1;if(1==b){var g=!0;if($("#leftNames ul").find("li span a").each(function(){if($(this).html()==c)return g=!1,!1}),!g)return layer.msg("该名称已经存在"),!1}else{var g=!0;if($("#bao_leftNames ul").find("li span a").each(function(){if($(this).html()==c)return g=!1,!1}),!g)return $("#"+a).next().html("该名称已经存在").show(),!1}return $("#"+a).next().hide(),!0}}function tttt(a){var b="",c="tree",d={data:{id:1}};layer.msg("请求成功!");a.data.length;b+='<div class="panel panel-default"><div class="panel-heading"><h4 class="panel-title"><a href="#tree-'+d.data.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle" aria-expanded="true  pointGroups-name">'+d.data.name+"</a></h4></div>",b+='<div class="panel-collapse collapse in" id="tree-'+d.data.id+'" aria-expanded="false" ><div class="panel-body">',$.each(a.data,function(a,d){console.log("组+++++++++++");var e,f,g;if(f=!d.hide_tag,g=!!d.next_level,e=!1===g&&!1===f?"":"add",b+='<div class="panel panel-default"><div class="panel-heading fang" style="padding-left:0;padding-right:0px;" ><h4 class="panel-title">',b+=""===e?'<a  href="#tree-'+d.id+'" data-parent="#accordion"  class="one-step accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">':'<a  href="#tree-'+d.id+'" data-parent="#accordion" data-toggle="collapse" class="one-step accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">',b+='<input tabindex="5" type="checkbox" id="tree-'+d.id+"-"+a+'"  class="skin-square-green fu" ids="'+d.id+'" ><label  class="form-label pointGroups-label">'+d.name+"</label></a></h4></div></div>",b+='<div class="panel-collapse collapse " id="tree-'+d.id+'" aria-expanded="false" style="height: 0px;">',d.next_level&&(console.log("进入第二层"),$.each(d.next_level,function(a,d){var e,f,g;if(f=!d.hide_tag,g=!!d.next_level,e=!1===g&&!1===f?"":"add",b+='<div class="panel panel-default" ><div class="panel-heading fang" style="margin-left: 23px;padding-top:5px;padding-right:0;"><h4 class="panel-title ">',b+=""===e?'<a  href="#tree-'+d.id+'" data-parent="#accordion"  class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">':'<a  href="#tree-'+d.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">',b+='<input tabindex="5" type="checkbox" id="tree-'+d.id+"-"+a+'"  class="skin-square-green fu" ids="'+d.id+'" ><label  class="form-label pointGroups-label">'+d.name+"</label></a></h4></div></div>",b+='<div class="panel-collapse collapse " id="tree-'+d.id+'" aria-expanded="false" style="height: 0px;">',d.next_level&&(console.log("进入第三层"),$.each(d.next_level,function(a,d){var e,f,g;if(f=!d.hide_tag,g=!!d.next_level,e=!1===g&&!1===f?"":"add",b+='<div class="panel panel-default" style="padding-left:30px;"><div class="panel-heading fang" style="padding-left:45px;padding-top:5px;padding-right:0;"><h4 class="panel-title ">',b+=""===e?'<a  href="#tree-'+d.id+'" data-parent="#accordion"  class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">':'<a  href="#tree-'+d.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed '+e+' pointGroups-a" aria-expanded="false">',b+='<input tabindex="5" type="checkbox" id="tree-'+d.id+"-"+a+'"  class="skin-square-green fu" ids="'+d.id+'" ><label  class="form-label pointGroups-label">'+d.name+"</label></a></h4></div></div>",b+='<div class="panel-collapse collapse " id="tree-'+d.id+'" aria-expanded="false" style="height: 0px;padding-left:45px;">',d.hide_tag);else if(d.tag_id_tree){console.log("第三层子元素展示");var h=d.tag_id_tree;$.each(h,function(e,f){b+='<div class="panel-body tree-msg" style="padding-left:40px;padding-top:5px;padding-bottom:5px;"><a href="#tree-'+f.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed pointGroups-a-son" aria-expanded="false"><input tabindex="5" oprate="'+f.oprate+'" type="checkbox" id="'+c+"-"+d.id+"-"+a+"-"+e+'" class="skin-square-green" ids="'+f.tag_id+'" ><label class="form-label pointGroups-label-son">'+f.name+"</label></a></div>"})}b+="</div>"})),d.hide_tag);else if(d.tag_id_tree){console.log("第二层子元素展示");var h=d.tag_id_tree;$.each(h,function(e,f){b+='<div class="panel-body tree-msg" style="padding-left:53px;;padding-top:5px;padding-bottom:5px;"><a href="#tree-'+f.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed pointGroups-a-son" aria-expanded="false"><input tabindex="5" oprate="'+f.oprate+'" type="checkbox" id="'+c+"-"+d.id+"-"+a+"-"+e+'" class="skin-square-green" ids="'+f.tag_id+'" ><label class="form-label pointGroups-label-son">'+f.name+"</label></a></div>"})}b+="</div>"})),d.hide_tag);else if(d.tag_id_tree){console.log("第一层子元素展示");var h=d.tag_id_tree;$.each(h,function(e,f){b+='<div class="panel-body tree-msg" style=";margin-left: 25px;padding-top:5px;padding-bottom:5px;"><a href="#tree-'+f.id+'" data-parent="#accordion" data-toggle="collapse" class="accordion-toggle collapsed pointGroups-a-son" aria-expanded="false"><input tabindex="5" oprate="'+f.oprate+'" type="checkbox" id="'+c+"-"+d.id+"-"+a+"-"+e+'" class="skin-square-green" ids="'+f.tag_id+'" ><label class="form-label pointGroups-label-son">'+f.name+"</label></a></div>"})}b+="</div>"}),b+="</div></div></div>",console.log("查看:"+b),$("#tree").append(b),ULTRA_SETTINGS.iCheck(),$.isFunction($.fn.iCheck)&&$("#tree input.skin-square-green").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"})}function exportss(){var a;switch(Number($("#selectBao button .txt").attr("rel"))){case 1:a=$("#bao_day").val();break;case 2:a=$("#bao_month").val();break;case 3:a=$("#bao_year").val()}tableExport("baoList",a,"csv")}$("#foot").load("public.html");var enetgy_url="/index.php?r=",enetgy_urls="/index.php";$(document).ready(function(){rightTree("tree"),leftList(1),window.onresize=function(){initScrollerA("tree"),initScrollerA("leftNames")},initScrollerA("tree"),initScrollerA("leftNames"),$("#tree input.skin-square-green").on("ifUnchecked ifChecked",function(){checkTree("tree")})}),$(function(){publicHeadfun(),bindListener(),days();var a=$("#selectTime").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(c){if(c.date.valueOf()>b.date.valueOf()){var d=new Date(c.date);d.setDate(d.getDate()+1),b.setValue(d)}a.hide(),$("#endTime")[0].focus(),$("#compare .addTime").html(""),$("#compare1 .addTime").html("")}).data("datepicker"),b=$("#endTime").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(c){checkEndTime("selectTime","endTime",1)||($("#endTime").val(""),layer.msg("结束时间需晚于开始时间")),compareYear(a.date,10)<=c.date.toLocaleDateString()&&(layer.msg("超过统计时间限制"),$("#endTime").val(""));var d=$("#selectTime").val(),e=$("#endTime").val();if(""!=d&&""!=e){$(".getshi a").removeClass("active").addClass("hide");var f=checkEndTime(d,e,2);f+=1,1==f||0==f?$(".getshi a:eq(0)").removeClass("hide").addClass("active"):f>1&&f<=7?($(".getshi a:eq(0)").removeClass("hide").addClass("active"),$(".getshi a:eq(1)").removeClass("hide")):f>7&&f<=30?$(".getshi a:eq(1)").removeClass("hide").addClass("active"):f>30&&f<=180?($(".getshi a:eq(1)").removeClass("hide").addClass("active"),$(".getshi a:eq(2)").removeClass("hide")):f>180&&f<=365?$(".getshi a:eq(2)").removeClass("hide").addClass("active"):($(".getshi a:eq(2)").removeClass("hide").addClass("active"),$(".getshi a:eq(3)").removeClass("hide"))}b.hide(),SelectData(1),$("#compare .addTime").html(""),$("#compare1 .addTime").html("")}).data("datepicker");$(".addTime").delegate("change click","input",function(a){checkTime()}),initTime(),$("#slectFen ul li a").click(function(){var a=$(this).text(),b=$(this).attr("rel");$(".getshi a").removeClass("active").addClass("hide"),1==b||2==b?($("#selectTime").val($(this).attr("value")),$("#endTime").val($(this).attr("value")),$(".getshi a:eq(0)").removeClass("hide").addClass("active")):3==b||4==b||5==b?(3==b||4==b?($(".getshi a:eq(0)").removeClass("hide").addClass("active"),$(".getshi a:eq(1)").removeClass("hide")):5==b&&$(".getshi a:eq(1)").removeClass("hide").addClass("active"),$("#selectTime").val($(this).attr("value")),$("#endTime").val(compareDate(1,0))):6==b||7==b||8==b?($("#selectTime").val($(this).attr("value")),6==b?counts=1:7==b?counts=2:8==b&&(counts=3),$(".getshi a:eq(1)").removeClass("hide").addClass("active"),$(".getshi a:eq(2)").removeClass("hide"),$("#endTime").val(getCurrentMonthLastForSelect($(this).attr("value")))):9==b&&($("#selectTime").val(""),$("#endTime").val("")),$("#compare .addTime").html(""),$("#compare1 .addTime").html(""),$("#slectFen button .txt").html(a).attr("rel",b),SelectData(1)}),$("#fen_select ul li a,#bao_select ul li a").click(function(){var a=$(this).parents(".selcts"),b=$(this).text();$(a).find("button .txt").html(b);$(this).attr("rel")}),$(".addTime").delegate("change","input",function(){checkTime()}),$("#selectBao li a").click(function(){var a=$(this).text(),b=$(this).attr("rel");if($("#selectInput input").hide(),1==b){$("#bao_day").show();var c=(new Date).format("yyyy-MM-dd");$("#bao_day").val(c)}else if(2==b){$("#bao_month").show();var c=(new Date).format("yyyy-MM");$("#bao_month").val(c)}else{$("#bao_year").show();var c=(new Date).format("yyyy");$("#bao_year").val(c)}$("#selectBao button .txt").html(a).attr("rel",b),BaoTableList()}),$(document).bind("click",function(a){0==$(a.target).closest(".tongji").length&&($("#tongji").is(":hidden")||SelectData(1),$("#tongjis").is(":hidden")||SelectData(2),$(".tongji").hide())}),$(document).keyup(function(a){switch(a.keyCode){case 27:$("#tab_border header").hide();case 96:$("#tab_border header").hide()}})}),document.addEventListener("fullscreenchange",function(a){console.log("fullscreenchange",a)}),document.addEventListener("webkitfullscreenchange",function(a){console.log("fullscreenchange",a),console.log(document.webkitIsFullScreen),!document.webkitIsFullScreen&&$("#tab_border header").hide()});var i=0,creatediv=function(){var a="",b=$("#selectType .txt").attr("rel"),c=9==b?"compare":"compare1";if($("#"+c+" .addTime").find("div[id^='timeDiv']").length<=8){var d=$("#"+c+" .addTime div").attr("id");i=void 0!=d?Number(d.substring(7))+1:1,$("#"+c+" .addTime").find("#timediv");var e="";9==b?e=$('<div class = "historyInputCom"><span class="timetext">对比时间段</span><span class="times"><input  type="text" data-format="yyyy-mm-dd" class="form-controls form-control datepicker" id="start'+i+'" onclick="checkTime(1,'+i+')"  onchange="checkTimeforZidingyiHistory(1,'+i+')" readonly="readonly"></span><lable class="spare">至</lable><span class="times"><input type="text" data-format="yyyy-mm-dd" class="form-controls form-control datepicker" id="end'+i+'"  onclick="checkTime(2,'+i+')" onchange="checkTime(2,'+i+')"  readonly="readonly"></span><span class="img"><img src="images/icon/delete.png"></span></div>'):(1!=b&&2!=b||(a="天"),3!=b&&4!=b&&5!=b||(a+="个",3==b?a+="3":4==b?a+="7":5==b&&(a+="30"),a+="天"),6!=b&&7!=b&&8!=b||(a="个月"),e=$('<div class = "historyInputCom1"><span class="timetext">对比时间段</span><span class="times">之前的第</span><section class="btn-group downselect"><button aria-expanded="false" data-toggle="dropdown" class="btn  btn-border dropdown-toggle" type="button" id="days'+i+'" style="width:95px;margin-left:0px" onclick="selectDrown('+i+","+b+')"><span class="txt" rel="1">1</span><span class="carets sarrow"></span><span class="sr-only"></span></button><ul role="menu" class="dropdown-menu  dropList dropList'+i+'"><li><a href="#" rel="1" class="selected">1</a></li><li><a href="#" rel="2">2</a></li><li><a href="#" rel="3">3</a></li><li><a href="#" rel="4">4</a></li><li><a href="#" rel="5">5</a></li><li><a href="#" rel="6">6</a></li><li><a href="#" rel="7">7</a></li><li><a href="#" rel="8">8</a></li><li class="9"><a href="#" rel="9">9</a></li></ul></section><lable class="spare" style="padding-left:0px;">'+a+'</lable><span class="times historyCom1Span" id="tians_'+i+'"></span><span class="spare">至</span><span class="times historyCom1Span" id="tiane_'+i+'"></span><span class="img"><img src="images/icon/delete.png"></span></div>')),e.attr("id","timeDiv"+i),e.addClass("parentdiv"),1==i&&e.appendTo($("#"+c+" .addTime")),1!=i&&$("#"+c+" .addTime div[id=timeDiv"+(i-1)+"]").before(e),$("#"+c).parent().height($("#"+c).parent().height()+47)}else layer.msg("不能超过9个时间段"),i=0;bindListener(c),9==b?ULTRA_SETTINGS.otherScripts():initAddreletiveAdd(b,i),$(".addTime").show(),$(".addTime div").show},isHistoryData=!1,history_ids;Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b){var d=b[c];new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?d:("00"+d).substr((""+d).length)))}return a};