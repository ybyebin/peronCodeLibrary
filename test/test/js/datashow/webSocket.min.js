/*! test 2017-04-13 */

function checkWebSocket(a,b){if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void alert("你的浏览器不支持WebSocket,请更换浏览器!");ws=new WebSocket(a),ws.onopen=doOpen(b),ws.onerror=doError,ws.onclose=doClose,ws.onmessage=doMessage}function doOpen(a){console.log("连接成功~~~~~~~~~~~~~"),isselect=!0,setTimeout(function(){ws.send("$Heartbeat@"+JSON.stringify(webScoketjson)+"\n")},3e3),Interval=setInterval(function(){ws.send("$Heartbeat@"+JSON.stringify(webScoketjson)+"\n")},5e3)}function doClose(){console.log("连接关闭~~~~~~~~~~~~~"),clearInterval(Interval),isselect=!1}function doError(a){console.log("通信发生错误~"),console.log("通信发生错误~"+JSON.stringify(a,null,2))}function doMessage(a){if(console.log("服务器发送的数据:"+JSON.stringify(a,null,2)),"$Message@"===a.data.substring(0,9)){var b=a.data.substring(9),c=JSON.parse(b);if(console.log("JSON格式数据:"+JSON.stringify(c,null,2)),c.ViewId==view_id){var d=[];(new draw2d.io.json.Writer).marshal(imageCanvas,function(a){webScoketTagID=Number(c.tagid),componentId="";for(var b=0;b<a.length;b++)if(Number(a[b].userData.Tag.tag_id)==Number(c.tagid)){var e=a[b].id;d.push(e)}}),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);for(var e=0;e<d.length;e++)if(""!==d[e]){var f=imageCanvas.getFigure(d[e]);if(f.userData.valueType)switch(f.userData.valueType){case"textValueComponent":f.setText("hahahaha"),f.setText(dataDic[ids].value),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value);break;case"valueComponent":"LabelComponent"===f.userData.types?(f.setText(dataDic[ids].value),f.repaint()):(f.label.setText(dataDic[ids].value),f.label.repaint()),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value)}switch(Number(c.status)){case 0:switch(c.isalarm){case"False":if("boolean"===f.userData.Tag.tag_type)switch(c.value){case"False":switch(f.userData.types){case"imageComponent":f.stopTimer(),f.userData.BlinkingType="onFalse",1==f.userData.onFalse.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onFalse.LineWidth)),f.setDashArray(f.userData.onFalse.LineStyle),f.setColor(f.userData.onFalse.LineColor),f.image.setPath(f.userData.onFalse.picture),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"buttonComponent":f.stopTimer(),f.userData.BlinkingType="onFalse",1==f.userData.onFalse.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onFalse.LineWidth)),f.setDashArray(f.userData.onFalse.LineStyle),f.setColor(f.userData.onFalse.LineColor),f.setBackgroundColor(f.userData.onFalse.FillColor),""==f.userData.onFalse.Text?f.setText("关闭"):f.setText(f.userData.onFalse.Text),f.setFontColor(f.userData.onFalse.TextColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"basicComponent":f.stopTimer(),f.userData.BlinkingType="onFalse",1==f.userData.onFalse.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onFalse.LineWidth)),f.setDashArray(f.userData.onFalse.LineStyle),f.setColor(f.userData.onFalse.LineColor),f.setBackgroundColor(f.userData.onFalse.FillColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"LineComponent":f.stopTimer(),f.userData.BlinkingType="onFalse",1==f.userData.onFalse.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onFalse.LineWidth)),f.setDashArray(f.userData.onFalse.LineStyle),f.setColor(f.userData.onFalse.LineColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value)}break;case"True":switch(f.userData.types){case"imageComponent":console.log("测试灯开"),f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.image.setPath(f.userData.onTrue.picture),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"buttonComponent":f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.setBackgroundColor(f.userData.onTrue.FillColor),""==f.userData.onTrue.Text?f.setText("打开"):f.setText(f.userData.onTrue.Text),f.setFontColor(f.userData.onTrue.TextColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"basicComponent":console.log("矩形"),f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.setBackgroundColor(f.userData.onTrue.FillColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"LineComponent":f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value)}}else switch(f.userData.types){case"imageComponent":f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.image.setPath(f.userData.onTrue.picture),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value);break;case"buttonComponent":f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.setBackgroundColor(f.userData.onTrue.FillColor),""==f.userData.onTrue.Text?f.setText(c.value):f.setText(f.userData.onTrue.Text),f.setFontColor(f.userData.onTrue.TextColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value);break;case"basicComponent":f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.setBackgroundColor(f.userData.onTrue.FillColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value);break;case"LineComponent":f.stopTimer(),f.userData.BlinkingType="onTrue",1==f.userData.onTrue.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onTrue.LineWidth)),f.setDashArray(f.userData.onTrue.LineStyle),f.setColor(f.userData.onTrue.LineColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value)}break;case"True":if(console.log("进入True"),"boolean"==Number(f.userData.Tag.tag_type))switch(f.userData.types){case"imageComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.image.setPath(f.userData.onAlarm.picture),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"buttonComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.setBackgroundColor(f.userData.onAlarm.FillColor),""==f.userData.onAlarm.Text?f.setText("报警"):f.setText(f.userData.onAlarm.Text),f.setFontColor(f.userData.onAlarm.TextColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"basicComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.setBackgroundColor(f.userData.onAlarm.FillColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"LineComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value)}else switch(f.userData.types){case"imageComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.image.setPath(f.userData.onAlarm.picture),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value);break;case"buttonComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.setBackgroundColor(f.userData.onAlarm.FillColor),""==f.userData.onAlarm.Text?f.setText(c.value):f.setText(f.userData.onAlarm.Text),f.setFontColor(f.userData.onAlarm.TextColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value);break;case"basicComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.setBackgroundColor(f.userData.onAlarm.FillColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value);break;case"LineComponent":f.stopTimer(),f.userData.BlinkingType="onAlarm",1==f.userData.onAlarm.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onAlarm.LineWidth)),f.setDashArray(f.userData.onAlarm.LineStyle),f.setColor(f.userData.onAlarm.LineColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value),changeTagValueForHighChar(c.value)}}break;case 1:case 2:switch(f.userData.types){case"imageComponent":f.stopTimer(),f.userData.BlinkingType="onDisconnected",1==f.userData.onDisconnected.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onDisconnected.LineWidth)),f.setDashArray(f.userData.onDisconnected.LineStyle),f.setColor(f.userData.onDisconnected.LineColor),f.image.setPath(f.userData.onDisconnected.picture),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"buttonComponent":f.stopTimer(),f.userData.BlinkingType="onDisconnected",1==f.userData.onDisconnected.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onDisconnected.LineWidth)),f.setDashArray(f.userData.onDisconnected.LineStyle),f.setColor(f.userData.onDisconnected.LineColor),f.setBackgroundColor(f.userData.onDisconnected.FillColor),""==f.userData.onDisconnected.Text?f.setText(c.value):f.setText(f.userData.onDisconnected.Text),f.setFontColor(f.userData.onDisconnected.TextColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"basicComponent":console.log("矩形"),f.stopTimer(),f.userData.BlinkingType="onDisconnected",1==f.userData.onDisconnected.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onDisconnected.LineWidth)),f.setDashArray(f.userData.onDisconnected.LineStyle),f.setColor(f.userData.onDisconnected.LineColor),f.setBackgroundColor(f.userData.onDisconnected.FillColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value);break;case"LineComponent":f.stopTimer(),f.userData.BlinkingType="onDisconnected",1==f.userData.onDisconnected.Blinking&&f.startTimer(1e3),f.setStroke(Number(f.userData.onDisconnected.LineWidth)),f.setDashArray(f.userData.onDisconnected.LineStyle),f.setColor(f.userData.onDisconnected.LineColor),f.repaint(),websocketChangetable(c.tagid,c.status,c.isalarm,c.value)}}}}}}function doSend(a){null!=ws&&ws.send(JSON.stringify(a))}function webSocketClose(){null!=ws&&ws.close()}function websocketChangetable(a,b,c,d){$("#qu table tbody tr").find(".havetagid").each(function(e,f){if(console.log("每个TagID为:"+$(f).text()),Number($(f).text())==Number(a)){var g=$(f).parent().find(".havetagtype").text();switch(console.log("status:"+b),console.log("alarm:"+c),console.log("传回的数据:"+g),console.log("value:"+d),Number(b)){case 0:switch(c){case"False":if(console.log("测试灯的关闭"),"boolean"==g)switch(console.log("测试灯的关闭========"),d){case"False":$(f).parent().find(".tagState").html("正常"),$(f).parent().find(".tagsValue").html("关");break;case"True":$(f).parent().find(".tagState").html("正常"),$(f).parent().find(".tagsValue").html("开")}else $(f).parent().find(".tagState").html(""),$(f).parent().find(".tagsValue").html(d);break;case"True":if("boolean"==g)switch($(f).parent().find(".tagState").html('<span class="warn"></span><span class="size_red">报警</span>'),d){case"False":$(f).parent().find(".tagsValue").html("关");break;case"True":$(f).parent().find(".tagsValue").html("开")}else $(f).parent().find(".tagState").html('<span class="warn"></span><span class="size_red">报警</span>'),$(f).parent().find(".tagsValue").html(d)}break;case 1:case 2:$(f).parent().find(".tagState").html('<span class="catch"></span><span class="size_yellow">通信异常</span>'),$(f).parent().find(".tagsValue").html("--")}}}),TagRealTimevalue.tag_id==Number(a)&&(TagRealTimevalue.tag_value=d);for(var e in componentIsReadonly)if(Number(componentIsReadonly[e].tag_id)==Number(a))if("boolean"==componentIsReadonly[e].tag_type)switch(d){case"False":componentIsReadonly[e].value=0;break;case"True":componentIsReadonly[e].value=1}else componentIsReadonly[e].value=d}function changeTagValueForHighChar(a){webScoketTagID==tagIdForHighChar&&(isNaN(a)||(tagValueForHighChar=Number(a)))}var ws,Interval,isselect=!1,view_id="",webScoketjson={viewid:view_id},componentId;$(function(){setInterval(function(){0==isselect&&checkWebSocket(wsSocket,view_id)},5e3)});