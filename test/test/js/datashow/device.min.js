/*! test 2017-04-13 */

function loadAllDeviceData(){$.ajax({url:apiurl+"r=api/entity/subsys/tree",type:"post",dataType:"json",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){if($(".loading").hide(),a.success){if(null==a.data)return;if(AllGroupData=a.data,showAllDeviceData(a.data),null==sessionStorage.getItem("device_viewid"))0!==a.data[0].view.length&&(console.log("第一组有画面"),$("#wraplist li:first-child a").click(),console.log("查看:"+$("#demo-li0 li:first-child a").data("viewid")),$("#demo-li0 li:first-child a").click());else{var b=Number(sessionStorage.getItem("device_viewid"));$("#wraplist li:nth-child("+b+") a").click(),$("#demo-li"+(b-1)+" li:first-child a").click(),sessionStorage.removeItem("device_viewid")}}else layer.msg(a.error_message),returnLogIn(a.error_message),console.log("请求子系统失败原因:"+JSON.stringify(a,null,2))},error:function(a){$(".loading").hide(),layer.msg("请求失败啦!"+a.error_message),console.log("请求子系统失败原因:"+JSON.stringify(a,null,2))}})}function showAllDeviceData(a){$("#main-menu-wrapper .wraplist");if(0!==a.length){0==a[0].view.length&&!1;for(var b in a)switch(a[b].groupName){case"空调机组":addSlide(a,b,"kongtiao");break;case"视频监控":addSlide(a,b,"vedio");break;case"照明":addSlide(a,b,"zhaoming");break;case"停车场":addSlide(a,b,"tingche");break;case"风机末端":addSlide(a,b,"fengji");break;case"视频监控系统":addSlide(a,b,"vedio");break;case"入侵报警系统":addSlide(a,b,"ruqin");break;case"环境监测系统":addSlide(a,b,"huanjing");break;case"风机盘管":addSlide(a,b,"fengji");break;case"电梯系统":addSlide(a,b,"dianti");break;case"照明控制系统":addSlide(a,b,"zhaoming");break;case"给排水系统":addSlide(a,b,"jishui");break;default:addSlide(a,b,"custom")}}}function addSlide(a,b,c){var d=$('<ul id="demo-li'+b+'" class="sub-views" ></ul>');0==a[b].view.length&&d.append('<li><p class="p-no-subviews">尚未添加监控画面</p></li>');for(var e in a[b].view)d.append('<li><a data-viewid="'+a[b].view[e].viewId+'">'+a[b].view[e].viewName+"</a></li>");var f='<li class="device-li"><a class="list-a-click" data-target="#demo-li'+b+'" data-status="close"><i class="'+c+'"></i><span>'+a[b].groupName+"</span></a></li>";$("#wraplist").append(f),$("#main-menu-wrapper").append(d)}function showCanvas(a,b){$.ajax({url:apiurl+"r=api/entity/view/get",type:"post",dataType:"json",data:{data:JSON.stringify({view_id:a})},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(c){if($(".loading").hide(),console.log(c.data),c.success){imageCanvas.clear();var d=[],e=[];null===c.data.view_data||(d=JSON.parse(c.data.view_data).canvas,e=JSON.parse(c.data.view_data).subCanvas),allComponent={};for(var f in d)"draw2d.Connection"!==d[f].type&&(allComponent[d[f].id]=d[f].userData.Tag.tag_id);$("#SecCanvasFullBtn").html("");for(var g in e){allComponent[e[g].id]=e[g].tag_id;var h='<p><button class="btn boolean-true '+e[g].id+'" data-id="'+e[g].id+'"  data-tag-id="'+e[g].tag_id+'" data-tag-name="'+e[g].tag_name+'" data-tag-type="'+e[g].tag_type+'" data-bingding-status="'+e[g].bingding_status+'" data-readonly="'+e[g].readonly+'"  data-value=""  >'+e[g].name+"</button></p>";$("#SecCanvasFullBtn").append(h)}$("#myBgimage").attr("src","images/text/logo-text.png"),$("#canvas").css("background-color","#fff"),""!==c.data.background_color&&$("#canvas").css("background-color",c.data.background_color),""!==c.data.background_img_url&&$("#myBgimage").attr("src",c.data.background_img_url);(new draw2d.io.json.Reader).unmarshal(b,d);(new draw2d.io.json.Writer).marshal(b,function(a){for(var c in a){var d=getCanvasNode(b,a[c].id);if(""==d.userData.havepoint&&(d.getOutputPort(0).setVisible(!1),d.getInputPort(0).setVisible(!1)),d.userData.ShowCaption){switch(a[c].userData.ShowCaption){case!0:d.label.setVisible(!0);break;case!1:d.label.setVisible(!1)}d.label.setText(a[c].userData.Caption),d.label.repaint()}switch(1==d.userData.Blinking&&d.startTimer(1e3),d.image&&(d.image.setHeight(d.getHeight()),d.image.setWidth(d.getWidth())),d.userData.picture&&(d.image.setPath(d.userData.picture),d.image.setHeight(d.getHeight()),d.image.setWidth(d.getWidth()),d.setAlpha(.001)),d.alpha){case 0:d.setAlpha(0),d.image&&d.image.setAlpha(0),d.label&&d.label.setAlpha(0)}"conduitCompontent"===d.userData.types&&d.resetPorts()}}),getComponentlist(a)}else layer.msg("请求画面失败:"+c.error_message),console.log("请求画面失败:"+JSON.stringify(c,null,2))},error:function(a){$(".loading").hide(),layer.msg("请求画面失败:"+a.error_message),console.log("请求画面失败:"+JSON.stringify(a,null,2))}})}function changeGlobalBtnState(a){if(componentIsReadonly[a]&&0==Number(componentIsReadonly[a].readonly)&&0==componentIsReadonly[a].com_readonly)switch(componentIsReadonly[a].tag_type){case"boolean":layerType=layer.open({title:["指定数据标签值","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["1018px","275px"],content:$("#action1"),shift:2,move:!1,btn:["确定","取消"],success:function(){switch(Number(componentIsReadonly[a].value)){case 0:console.log("进入关"),$("#close").iCheck("check"),$("#open").iCheck("uncheck");break;case 1:console.log("进入开"),$("#close").iCheck("uncheck"),$("#open").iCheck("check")}},yes:function(b){$("#action1").find("input").each(function(b,c){var d=$(c).attr("id");if(1==$("#"+d).prop("checked"))switch(console.log("ID 为:"+d),d){case"open":var e={tag_id:componentIsReadonly[a].tag_id,value:1},f={data:JSON.stringify(e)};changeTagValue("global_btn",f,componentIsReadonly[a].tag_id,componentIsReadonly[a].id);break;case"close":var g={tag_id:componentIsReadonly[a].tag_id,value:0},f={data:JSON.stringify(g)};changeTagValue("global_btn",f,componentIsReadonly[a].tag_id,componentIsReadonly[a].id)}}),layer.close(layerType)},btn2:function(a){layer.close(layerType)}})}}function getComponentlist(a){console.log("画面的ID:"+a),$.ajax({url:apiurl+"r=api/view/list/init",type:"post",dataType:"json",data:{data:JSON.stringify({view_id:a})},beforeSend:function(){$(".loading").show()},complete:function(){},success:function(a){if($(".loading").hide(),a.success){console.log("画面控件的数据数据==================:"+JSON.stringify(a,null,2)),componentIsReadonly={};for(var b in a.data){var c=a.data[b];componentIsReadonly[a.data[b].id]=c}addComponentMessage(componentIsReadonly),reloadCanvas(componentIsReadonly)}else layer.msg("错误:"+a.error_message),console.log("画面控件的数据数据错误原因----------"+JSON.stringify(a,null,2))},error:function(a){$(".loading").hide(),layer.msg("失败:"+a.error_message),console.log("画面控件的数据数据错误原因=================="+JSON.stringify(a,null,2))}})}function reloadCanvas(a){for(var b in a)if(isNaN(a[b].id)){var c=getCanvasNode(imageCanvas,a[b].id);if(c.userData.valueType&&0===Number(a[b].status))switch(c.userData.valueType){case"textValueComponent":c.setText(String(a[b].value+c.userData.unit)),c.repaint();break;case"valueComponent":"LabelComponent"===c.userData.types?(c.setText(a[b].value),c.repaint()):(c.label.setText(a[b].value),c.label.repaint())}switch(Number(a[b].status)){case 0:switch(a[b].alarm){case!1:if("boolean"==c.userData.Tag.tag_type)switch(a[b].value){case"0":switch(c.userData.types){case"imageComponent":console.log("测试灯关"),c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.image.setPath(c.userData.onFalse.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.setBackgroundColor(c.userData.onFalse.FillColor),""==c.userData.onFalse.Text?c.setText("关闭"):c.setText(c.userData.onFalse.Text),c.setFontColor(c.userData.onFalse.TextColor),c.repaint();break;case"basicComponent":c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.setBackgroundColor(c.userData.onFalse.FillColor),c.userData.onFalse.alpha&&c.setAlpha(Number(c.userData.onFalse.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.repaint()}break;case"1":switch(c.userData.types){case"imageComponent":console.log("测试灯开"),c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.image.setPath(c.userData.onTrue.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.setBackgroundColor(c.userData.onTrue.FillColor),""==c.userData.onTrue.Text?c.setText("打开"):c.setText(c.userData.onTrue.Text),c.setFontColor(c.userData.onTrue.TextColor),c.repaint();break;case"basicComponent":console.log("矩形"),c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.setBackgroundColor(c.userData.onTrue.FillColor),c.userData.onTrue.alpha&&c.setAlpha(Number(c.userData.onTrue.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.repaint()}}else switch(c.userData.types){case"imageComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.image.setPath(c.userData.onTrue.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.setBackgroundColor(c.userData.onTrue.FillColor),""==c.userData.onTrue.Text?c.setText(String(a[b].value+c.userData.onTrue.unit)):c.setText(c.userData.onTrue.Text),c.setFontColor(c.userData.onTrue.TextColor),c.repaint();break;case"basicComponent":console.log("矩形"),c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.setBackgroundColor(c.userData.onTrue.FillColor),c.userData.onTrue.alpha&&c.setAlpha(Number(c.userData.onTrue.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.repaint()}break;case!0:if(console.log("进入True"),"boolean"==c.userData.Tag.tag_type)switch(c.userData.types){case"imageComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.image.setPath(c.userData.onAlarm.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.setBackgroundColor(c.userData.onAlarm.FillColor),""==c.userData.onAlarm.Text?c.setText("报警"):c.setText(c.userData.onAlarm.Text),c.setFontColor(c.userData.onAlarm.TextColor),c.repaint();break;case"basicComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.setBackgroundColor(c.userData.onAlarm.FillColor),c.userData.onAlarm.alpha&&c.setAlpha(Number(c.userData.onAlarm.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.repaint()}else switch(c.userData.types){case"imageComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.image.setPath(c.userData.onAlarm.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.setBackgroundColor(c.userData.onAlarm.FillColor),""==c.userData.onAlarm.Text?c.setText(String(a[b].value+c.userData.onAlarm.unit)):c.setText(c.userData.onAlarm.Text),c.setFontColor(c.userData.onAlarm.TextColor),c.repaint();break;case"basicComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.setBackgroundColor(c.userData.onAlarm.FillColor),c.userData.onAlarm.alpha&&c.setAlpha(Number(c.userData.onAlarm.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onAlarm",1==c.userData.onAlarm.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onAlarm.LineWidth)),c.setDashArray(c.userData.onAlarm.LineStyle),c.setColor(c.userData.onAlarm.LineColor),c.repaint()}}break;case 1:switch(c.userData.types){case"imageComponent":c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.image.setPath(c.userData.onDisconnected.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.setBackgroundColor(c.userData.onDisconnected.FillColor),""==c.userData.onDisconnected.Text||c.setText(c.userData.onDisconnected.Text),c.setFontColor(c.userData.onDisconnected.TextColor),c.repaint();break;case"basicComponent":console.log("矩形"),c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.setBackgroundColor(c.userData.onDisconnected.FillColor),c.userData.onDisconnected.alpha&&c.setAlpha(Number(c.userData.onDisconnected.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.repaint()}break;case 2:switch(c.userData.types){case"imageComponent":c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.image.setPath(c.userData.onDisconnected.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.setBackgroundColor(c.userData.onDisconnected.FillColor),""==c.userData.onDisconnected.Text||c.setText(c.userData.onDisconnected.Text),c.setFontColor(c.userData.onDisconnected.TextColor),c.repaint();break;case"basicComponent":c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.setBackgroundColor(c.userData.onDisconnected.FillColor),c.userData.onDisconnected.alpha&&c.setAlpha(Number(c.userData.onDisconnected.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onDisconnected",1==c.userData.onDisconnected.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onDisconnected.LineWidth)),c.setDashArray(c.userData.onDisconnected.LineStyle),c.setColor(c.userData.onDisconnected.LineColor),c.repaint()}}}else switch(console.log("全局按钮id："+a[b].id),console.log("全局按钮class：."+a[b].id),console.log("全局按钮value："+a[b].value),Number(a[b].value)){case 0:$("."+a[b].id).data("value","0").removeClass("boolean-false boolean-true").addClass("boolean-true"),console.log("查看类名："+$("."+a[b].id).data("value"));break;case 1:$("."+a[b].id).data("value","1").removeClass("boolean-false boolean-true").addClass("boolean-false"),console.log("查看类名："+$("."+a[b].id).data("value"))}}function addComponentMessage(a){$("#table-stripeds tbody").html("");var b,c,d=$("#table-stripeds tbody").html(),e="<td></td>",f="<td></td>";for(var g in a){switch(a[g].status){case 0:switch(a[g].alarm){case!1:if("boolean"==a[g].tag_type)switch(Number(a[g].value)){case 0:e='<td class = "tagState">正常</td>',f='<td class = "tagsValue">关</td>';break;case 1:e='<td class = "tagState">正常</td>',f='<td class = "tagsValue" >开</td>'}else e='<td class = "tagState"></td>',f='<td class = "tagsValue" >'+a[g].value+"</td>";break;case!0:if("boolean"==a[g].tag_type)switch(e='<td class = "tagState"><span class="warn"></span><span class="size_red">报警</span></td>',Number(a[g].value)){case 0:f='<td class = "tagsValue">关</td>';break;case 1:f='<td class = "tagsValue" >开</td>'}else e='<td class = "tagState"><span class="warn"></span><span class="size_red">报警</span></td>',f='<td class = "tagsValue">'+a[g].value+"</td>"}break;case 1:case 2:e='<td class = "tagState"><span class="catch"></span><span class="size_yellow">通信异常</span></td>',f='<td class = "tagsValue">--</td>'}switch(Number(a[g].trends)){case 0:b="<td >--</td>";break;case 1:b='<td ><a data-id = "'+a[g].tag_id+'" data-name="'+a[g].name+'" class = "watch" href="#">查看</a></td>'}switch(Number(a[g].readonly)){case 0:switch(a[g].com_readonly){case!1:c='<td><a class = "doIt" href="#" data-id = "'+a[g].id+'"  data-type="'+a[g].tag_type+'"  data-readonly="'+a[g].readonly+'">操作</a></td>';break;case!0:c="<td >--</td>"}break;case 1:c="<td >--</td>"}d+='<tr id = "'+a[g].id+'"><td class = "componentName" title="'+a[g].name+'">'+a[g].name+"</td>"+e+f+b+c+'<td style="display:none " class = "havetagid">'+a[g].tag_id+'</td><td style="display:none " class = "havetagtype">'+a[g].tag_type+"</td></tr>"}$("#qu table tbody").html(d)}function detail(a){layer.open({title:[a,"font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,area:["1200px","600px"],content:$("#detail"),shift:2})}function createStockChart(a,b,c){var d={tag_id:a,start_time:b,end_time:c},e={data:JSON.stringify(d)};console.log("获取历史趋势图上传的数据:"+JSON.stringify(e,null,2)),$.ajax({type:"POST",url:apiurl+"r=api/view/trends/init",dataType:"json",data:{data:JSON.stringify({tag_id:a,start_time:b,end_time:c})},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){if($(".loading").hide(),a.success){console.log("获得的历史数据:"+JSON.stringify(a,null,2));var b=a.data,c=[];b.reverse();for(var d=0;d<b.length;d++){var e=b[d].time;e=e.substring(0,19),e=e.replace(/-/g,"/");var f=new Date(e).getTime();b[d].time=f;var g=[];g.push(b[d].time),g.push(Number(b[d].value)),c.push(g)}console.log("历史数据:"+JSON.stringify(c,null,2)),$("#quChart").highcharts("StockChart",{chart:{backgroundColor:"#2B2E4B",alignTicks:!1,type:"spline"},tooltip:{xDateFormat:"%Y-%m-%d %H:%M:%S",shared:!0},rangeSelector:{allButtonsEnabled:!0,enabled:!1,buttonTheme:{width:60},selected:2},title:{text:"历史趋势",style:{color:"#fff",fontWeight:"normal",fontFamily:"微软雅黑",fontSize:"16px"}},navigator:{enabled:!0,xAxis:{lineColor:"#555769",dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H点",day:"%Y年%m月%d日",week:"%e. %b",month:"%Y年%m月",year:"%Y年"}}},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0,enabled:!1},xAxis:{type:"datetime",dateTimeLabelFormats:{second:"%Y-%m-%d<br/>%H:%M:%S",minute:"%Y-%m-%d<br/>%H:%M",hour:"%Y-%m-%d<br/>%H:00",day:"%Y-%m-%d",week:"%Y-%m-%d",month:"%Y-%m",year:"%Y"}},yAxis:{gridLineColor:"#555769"},credits:{enabled:!1},series:[{type:"spline",name:"值为",data:c}]})}else layer.msg("错误原因:"+a.error_message),console.log("错误原因:"+JSON.stringify(a,null,2))},error:function(a){$(".loading").hide(),layer.msg(a.error_message),console.log("失败原因:"+JSON.stringify(a,null,2))}})}function getTagRealTimevalue(a){console.log("上传的数据:"+JSON.stringify({tag_id:a},null,2)),$.ajax({url:apiurl+"r=api/view/trends/constant",type:"post",dataType:"json",data:{data:JSON.stringify({tag_id:a})},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){if(a.success){var b=(a.data.length,a.data);b.reverse();for(var c=[],d=0;d<b.length;d++){var e={x:b[d].time,y:Number(b[d].value)};c.push(e);var f=c[d].x;f=f.substring(0,19),f=f.replace(/-/g,"/");var g=new Date(f).getTime();c[d].x=g}tagValueForHighChar=c[c.length-1].y,clearInterval(tagValueSetInterval),Highcharts.setOptions({global:{useUTC:!1}}),$("#quChart1").highcharts({chart:{backgroundColor:"#2B2E4B",type:"spline",animation:Highcharts.svg,marginRight:10,events:{load:function(){var a=this.series[0];tagValueSetInterval=setInterval(function(){var b=(new Date).getTime(),c=tagValueForHighChar;a.addPoint([b,c],!0,!0)},5e3)}}},title:{text:"实时趋势",style:{color:"#fff",fontWeight:"normal",fontFamily:"微软雅黑",fontSize:"16px"}},xAxis:{lineColor:"#555769",type:"datetime",tickPixelInterval:null,labels:{formatter:function(){return Highcharts.dateFormat("%H:%M:%S",this.value)}}},yAxis:{title:{text:"Value"},gridLineColor:"#555769",plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x)+"<br/>"+Highcharts.numberFormat(this.y,2)}},legend:{enabled:!1},exporting:{enabled:!1},credits:{enabled:!1},series:[{color:"#f5a623",name:"Random data",data:c}]})}else layer.msg("实时数据:"+a.error_message),console.log("实时数据："+JSON.stringify(a,null,2))},error:function(a){layer.msg("实时数据："+a.error_message),console.log("实时数据："+JSON.stringify(a,null,2))}})}function changeComponentState(a){var b=1;if(componentIsReadonly[a]&&(console.log("readonly:"+componentIsReadonly[a].readonly),console.log("com_readonly:"+componentIsReadonly[a].com_readonly),0===Number(componentIsReadonly[a].readonly)&&0==componentIsReadonly[a].com_readonly&&(b=0)),console.log("isReadOnly:"+b),console.log("componentIsReadonly[componentID].tag_type"+componentIsReadonly[a].tag_type),0==b)switch(componentIsReadonly[a].tag_type){case"boolean":layerType=layer.open({title:["指定数据标签值","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["1018px","275px"],content:$("#action1"),shift:2,move:!1,btn:["确定","取消"],success:function(){switch(Number(componentIsReadonly[a].value)){case 0:console.log("进入关"),$("#close").iCheck("check"),$("#open").iCheck("uncheck");break;case 1:console.log("进入开"),$("#close").iCheck("uncheck"),$("#open").iCheck("check")}},yes:function(b){var c=$('#action1 input[name="status"]:checked').attr("id");switch(console.log("ID 为:"+c),c){case"open":var d={tag_id:componentIsReadonly[a].tag_id,value:1},e={data:JSON.stringify(d)};changeTagValue("canvas_com",e,componentIsReadonly[a].tag_id,componentIsReadonly[a].id);break;case"close":var f={tag_id:componentIsReadonly[a].tag_id,value:0},e={data:JSON.stringify(f)};changeTagValue("canvas_com",e,componentIsReadonly[a].tag_id,componentIsReadonly[a].id)}layer.close(layerType)},btn2:function(a){layer.close(layerType)}});break;case"integer":console.log("进入integer"),$("#action").find("input").val(componentIsReadonly[a].value),layerForother("canvas_com",componentIsReadonly[a].tag_id,componentIsReadonly[a].id,"integer");break;case"float":$("#action").find("input").val(componentIsReadonly[a].value),layerForother("canvas_com",componentIsReadonly[a].tag_id,componentIsReadonly[a].id,"realnumber");break;case"string":$("#action_str").find("input").val(componentIsReadonly[a].value),layerType=layer.open({title:["指定数据标签值","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["1018px","275px"],content:$("#action_str"),shift:2,move:!1,btn:["确定","取消"],yes:function(b){$("#action_str").find("input").val(),console.log($("#action_str").find("input").val());var c={tag_id:componentIsReadonly[a].tag_id,value:$("#action_str").find("input").val()};changeTagValue("canvas_com",{data:JSON.stringify(c)},componentIsReadonly[a].tag_id,componentIsReadonly[a].id),$("#action_str").find("input").val(""),layer.close(layerType)},btn2:function(a){layer.close(layerType)}})}}function layerForother(a,b,c,d){layer.open({title:["指定数据标签值","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["1018px","275px"],content:$("#action"),shift:2,move:!1,btn:["确定","取消"],yes:function(e){switch(console.log("tag_type:"+d),d){case"integer":if(console.log("========="),checkInputNumber($("#dataValue").val())){console.log("=====adfgdg====");var f={tag_id:b,value:Number($("#dataValue").val())},g={data:JSON.stringify(f)};switch(a){case"canvas_com":changeTagValue("canvas_com",g,b,c);break;case"global_btn":changeTagValue("global_btn",g,b,c)}$("#action").find("input").val(""),layer.close(e)}else layer.msg("请输入正确的整数");break;case"realnumber":if(isNaN($("#action").find("input").val()))layer.msg("请输入正确的实数");else{var f={tag_id:b,value:Number($("#action").find("input").val())},g={data:JSON.stringify(f)};switch(a){case"canvas_com":changeTagValue("canvas_com",g,b,c);break;case"global_btn":changeTagValue("global_btn",g,b,c)}$("#action").find("input").val(""),layer.close(e)}}console.log($("#action").find("input").val())},btn2:function(a){layer.close(a)}})}function checkInputNumber(a){return!isNaN(a)&&!/^[+-]?[1-9]?[0-9]*\.[0-9]*$/.test(a)}function changeTagValue(a,b,c,d){console.log("上传的数据:",JSON.stringify(b)),$.ajax({url:apiurl+"r=api/entity/tag/value",type:"post",dataType:"json",data:b,beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(b){if($(".loading").hide(),b.success){console.log("返回的数据为:"+JSON.stringify(b,null,2));var c=b.data;switch(a){case"canvas_com":findComponentByComponentid(c,d);break;case"global_btn":switch(console.log("查看tag的类型:"+$("#"+d).find(".havetagtype").text()),console.log("按钮类名:"+d),Number(c)){case 0:$("#"+d).find(".tagsValue").text("关"),$("."+d).data("value","0").removeClass("boolean-false boolean-true").addClass("boolean-true");break;case 1:$("#"+d).find(".tagsValue").text("开"),$("."+d).data("value","1").removeClass("boolean-false boolean-true").addClass("boolean-false")}}componentIsReadonly[d].value=b.data,layer.msg("修改成功")}else layer.msg("修改失败:"+b.error_message),console.log("修改失败==========!"+JSON.stringify(b,null,2))},error:function(a){$(".loading").hide(),console.log("修改失败!"+JSON.stringify(a,null,2)),layer.msg("修改失败:"+a.error_message)}})}function findComponentByComponentid(a,b){var c=getCanvasNode(imageCanvas,b);if(console.log("该控件的类型:"+c.userData.Tag.tag_type),console.log("要更改的值:"+a),"boolean"==c.userData.Tag.tag_type)switch(layer.msg("开关型"),Number(a)){case 0:switch(c.userData.types){case"imageComponent":c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.image.setPath(c.userData.onFalse.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.setBackgroundColor(c.userData.onFalse.FillColor),c.setText(c.userData.onFalse.Text),c.setFontColor(c.userData.onFalse.TextColor),c.repaint();break;case"basicComponent":c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.setBackgroundColor(c.userData.onFalse.FillColor),c.userData.onFalse.alpha&&c.setAlpha(Number(c.userData.onFalse.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onFalse",1==c.userData.onFalse.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onFalse.LineWidth)),c.setDashArray(c.userData.onFalse.LineStyle),c.setColor(c.userData.onFalse.LineColor),c.repaint()}break;case 1:switch(c.userData.types){case"imageComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.image.setPath(c.userData.onTrue.picture),c.repaint();break;case"buttonComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.setBackgroundColor(c.userData.onTrue.FillColor),c.setText(c.userData.onTrue.Text),c.setFontColor(c.userData.onTrue.TextColor),c.repaint();break;case"basicComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.setBackgroundColor(c.userData.onTrue.FillColor),c.userData.onTrue.alpha&&c.setAlpha(Number(c.userData.onTrue.alpha)),c.repaint();break;case"LineComponent":c.stopTimer(),c.userData.BlinkingType="onTrue",1==c.userData.onTrue.Blinking&&c.startTimer(1e3),c.setStroke(Number(c.userData.onTrue.LineWidth)),c.setDashArray(c.userData.onTrue.LineStyle),c.setColor(c.userData.onTrue.LineColor),c.repaint()}}else if(c.userData.valueType)switch(console.log("非开关型"),
c.userData.valueType){case"textValueComponent":c.setText(a),c.repaint();break;case"valueComponent":"LabelComponent"===c.userData.types?(c.setText(a),c.repaint()):(c.label.setText(a),c.label.repaint())}if(console.log("查看tag的类型:"+$("#"+b).find(".havetagtype").text()),1==Number($("#"+b).find(".havetagtype").text()))switch(Number(a)){case 0:$("#"+b).find(".tagsValue").text("关");break;case 1:$("#"+b).find(".tagsValue").text("开")}else $("#"+b).find(".tagsValue").text(a)}function getCanvasNode(a,b){var c=a.getFigure(b),d=a.getLine(b);return null===c&&null===d?"underfined":null!==c?c:null!==d?d:void 0}function showTooltips(a){var b=$("#tooltips");if(""!==a.userData.Hint){b.show().html(a.userData.Hint);var c=a.getAbsoluteX()+a.getWidth()/2-b.width()/2+8,d=a.getAbsoluteY()+a.getHeight()+10;b.css({top:d+"px",left:c+"px"})}}function vlc(a,b){$("#vlc_bg").css({display:"block",height:$(document).height()});var c=$(".vlc_box");$("#vlc").find(".rtt").val(b),c.css({left:($("body").width()-c.width())/2-20+"px",top:($(window).height()-c.height())/2+$(window).scrollTop()+"px",display:"block"}),$(".vlc_box h2").find("span.title").text(a),$(".vlc_box").on("click",".vlc_close",function(){$("#vlc_bg,.vlc_box").css("display","none")})}function showOrHideGlobalbtn(){Number($(window).width());"950px"==$("#SecCanvas").css("left")?$("#SecCanvasFullBtn").hasClass("in")&&$("#SecCanvas div.title").click():$("#SecCanvasFullBtn").hasClass("in")||$("#SecCanvas div.title").click()}function startmove(a,b,c){var d=document.getElementById("main-menu-wrapper");clearInterval(timer),timer=setInterval(function(){d.offsetLeft==b?clearInterval(timer):(0===a?$(".handle").addClass("open"):$(".handle").removeClass("open"),d.style.left=d.offsetLeft+c+"px")},10)}!function(a){a(window).load(function(){a("#div-wraplist").mCustomScrollbar({autoHideScrollbar:!0}),a(".scrollFullBtn").mCustomScrollbar(),a(".qu-scroll").mCustomScrollbar()})}(jQuery),$("#foot").load("public.html"),$(function(){publicHeadfun(),days(),$("#selectTime").val($(".threeday").attr("value")),$("#endTime").val(compareDate(1,0)),loadAllDeviceData();var a=$("#selectTime").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(c){if(c.date.valueOf()>b.date.valueOf()){var d=new Date(c.date);d.setDate(d.getDate()+1),b.setValue(d)}a.hide(),$("#endTime")[0].focus(),$("#slectFen button .txt").html("自定义")}).data("datepicker"),b=$("#endTime").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(c){$("#slectFen button .txt").html("自定义");var d=!0;checkEndTime("selectTime","endTime",1)||($("#endTime").val(""),d=!1,layer.msg("结束时间需晚于开始时间")),compareYear(a.date,10)<=c.date.toLocaleDateString()&&(layer.msg("超过统计时间限制"),d=!1,$("#endTime").val("")),b.hide(),d&&(starts_time=$("#selectTime").val(),ends_time=$("#endTime").val(),createStockChart(tagsidforlist,starts_time,ends_time),layer.msg("选择的时间:"+starts_time+ends_time))}).data("datepicker");$("#every").click(function(){$("#quChart").is(":visible")?($("#quChart").hide(),$("#quChart1").show(),$("#every").html("历史趋势"),$(".choosetime").css("visibility","hidden")):($("#quChart").show(),$("#quChart1").hide(),$("#every").html("实时趋势"),$(".choosetime").css("visibility","visible"))})}),$(function(){}),$("#wraplist").on("click","li a",function(){console.log($(this).data("status")),"close"==$(this).data("status")&&($(".list-a-click").removeClass("active"),$(this).addClass("active"),$(".list-a-click").data("status","close"),$(this).data("status","open"),$(".sub-views").hide(100),$($(this).data("target")).show(100))}),$("#main-menu-wrapper").on("click","ul.sub-views li a",function(a){$("#main-menu-wrapper ul.sub-views li a").removeClass("active"),$(this).addClass("active");var b=$(this).data("viewid");$("#EquipmentMonitoring a").tab("show"),view_id=String(b),restart&&(mqtt.disconnect(),restart=!1),console.log("查看view_id："+view_id),MQTTconnect(),setTimeout(function(){showCanvas(Number(b),imageCanvas)},100)});var allComponent={};$("#SecCanvasFullBtn").on("click","button",function(){if(console.log("按钮"),console.log("查看按钮tagID:"+$(this).data("tag-id")),console.log("查看按钮value:"+$(this).data("value")),""!==$(this).data("tag-id")){if(console.log("123"),0===Number($(this).data("value"))){var a={tag_id:componentIsReadonly[$(this).data("id")].tag_id,value:1},b={data:JSON.stringify(a)};changeTagValue("global_btn",b,componentIsReadonly[$(this).data("id")].tag_id,componentIsReadonly[$(this).data("id")].id)}else if(1===Number($(this).data("value"))){var c={tag_id:componentIsReadonly[$(this).data("id")].tag_id,value:0},b={data:JSON.stringify(c)};changeTagValue("global_btn",b,componentIsReadonly[$(this).data("id")].tag_id,componentIsReadonly[$(this).data("id")].id)}}else layer.msg("未绑定任何数据标签")});var componentIsReadonly={},componentTagValue=[],starts_time="",ends_time="";$("#qu table tbody").on("click","tr td a.watch",function(){tagsidforlist=$(this).data("id"),detail($(this).data("name")),$("#quChart").show(),$("#quChart1").hide(),$("#every").html("实时趋势"),$(".choosetime").css("visibility","visible"),TagRealTimevalue.tag_id=tagsidforlist;var a=new Date;starts_time=new Date(+a-1728e5).format("yyyy-MM-dd"),ends_time=a.format("yyyy-MM-dd"),$("#selectTime").val(starts_time),$("#endTime").val(ends_time),$("#slectFen button .txt").html("最近三天"),createStockChart($(this).data("id"),starts_time,ends_time),getTagRealTimevalue($(this).data("id")),tagIdForHighChar=Number($(this).data("id"))}),$("#qu table tbody").on("click","tr td a.doIt",function(){changeComponentState($(this).data("id"))});var tagsidforlist,tagValueForHighChar,tagIdForHighChar,tagValueSetInterval;setInterval(function(){tagValue=Math.random()},100);var TagRealTimevalue={tag_id:"",tag_value:""},layerType,imageCanvas;$(window).load(function(){draw2d.Configuration.factory.createConnection=function(a,b,c,d){return new HoverConnection(a,b)},draw2d.Configuration.factory.createResizeHandle=function(a,b){var c=new draw2d.ResizeHandle(a,b);return c.attr({width:10,height:10,radius:0,color:"#35C99D",stroke:1,bgColor:"#35C99D"}),c};var a=new draw2d.Canvas("canvas");imageCanvas=a;var b=a.paper.createFilter();b.createShadow(0,0,3,.3,"#000000"),b.element.setAttribute("x","-35%"),b.element.setAttribute("y","-35%"),a.on("figure:add",function(a,c){c.figure instanceof draw2d.Connection||c.figure.shape.filter(b)}),a.installEditPolicy(new draw2d.policy.canvas.SnapToGeometryEditPolicy({lineColor:"#35c99d"})),a.installEditPolicy(new draw2d.policy.canvas.SnapToInBetweenEditPolicy({lineColor:"#35c99d"})),a.installEditPolicy(new draw2d.policy.canvas.SnapToCenterEditPolicy({lineColor:"#35c99d"}))});var HoverConnection=draw2d.Connection.extend({init:function(a,b){var c=this;this._super({router:new draw2d.layout.connection.InteractiveManhattanConnectionRouter,radius:5,stroke:1.35,color:"#68C9FF"}),this.on("dragEnter",function(a,b){console.log("drag enter"),c.attr({outlineColor:"#68C9FF",outlineStroke:2,color:"#68C9FF"})}),this.on("dragLeave",function(a,b){console.log("drag leave"),c.attr({outlineColor:"#68C9FF",outlineStroke:0,color:"#68C9FF"})})},onDragEnter:function(a){return this}});$("#slectFen ul li a").click(function(){var a=$(this).text(),b=$(this).attr("rel");1==b||2==b?($("#selectTime").val($(this).attr("value")),$("#endTime").val($(this).attr("value"))):3!=b&&4!=b&&5!=b||($("#selectTime").val($(this).attr("value")),$("#endTime").val(compareDate(1,0))),$("#slectFen button .txt").html(a).attr("rel",b),starts_time=$("#selectTime").val(),ends_time=$("#endTime").val(),createStockChart(tagsidforlist,starts_time,ends_time)}),$(function(){showOrHideGlobalbtn()}),$(window).resize(function(){var a=Number($(window).width());a<1835&&($("#main-menu-wrapper").css("left","-380px"),$(".handle").removeClass("open")),a>1835&&($("#main-menu-wrapper").css("left","0px"),$(".handle").addClass("open")),showOrHideGlobalbtn()}),$(".handle").on("click",function(){var a=(document.getElementById("main-menu-wrapper"),$("#main-menu-wrapper"));console.log(a.offset().left),0==a.offset().left?startmove(1,-380,-20):startmove(0,0,20)});var timer=null;$("#EquipmentMonitoring a").on("click",function(){setTimeout(function(){(new draw2d.io.json.Writer).marshal(imageCanvas,function(a){for(var b in a){var c=getCanvasNode(imageCanvas,a[b].id);if(c.userData.valueType)switch(c.userData.valueType){case"textValueComponent":c.setText(String(c.getText()));break;case"valueComponent":"LabelComponent"===c.userData.types?c.setText(String(c.getText())):c.label.setText(String(c.label.getText()))}}})},300)});