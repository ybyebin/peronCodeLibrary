/*! test 2017-04-13 */

function MQTTconnect(){mqtt=new Paho.MQTT.Client("192.168.2.2",61614,String(parseInt(100*Math.random(),10)));var a={useSSL:!1,cleanSession:!1,onSuccess:function(){subscribeView()},onFailure:function(a){console.log("connect Failure"),setTimeout(MQTTconnect,reconnectTimeout)}};mqtt.onConnectionLost=onConnectionLost,mqtt.onMessageArrived=onMessageArrived,mqtt.connect(a)}function subscribeView(){console.log("连接成功"),console.log("view_id"+view_id),restart=!0,mqtt.subscribe("Bayax/Push/"+view_id)}function onConnectionLost(a){console.log("connect Lost:"+JSON.stringify(a,null,2)),setTimeout(MQTTconnect,reconnectTimeout)}function onMessageArrived(a){onlyForOnMessageArrived(a)}function onlyForOnMessageArrived(a){var b=JSON.parse(a.payloadString);console.log("查看MQTT返回的数据:"+JSON.stringify(b,null,2));for(var c in allComponent)if(Number(allComponent[c])===b.tagId)if("underfined"===getCanvasNode(imageCanvas,c)){if(console.log("==================全局按钮================"+c),0===b.status)switch(b.value){case"true":$("#"+c).find(".tagsValue").text("开"),$("."+c).data("value","1").removeClass("boolean-false boolean-true").addClass("boolean-true");break;case"false":$("#"+c).find(".tagsValue").text("关"),$("."+c).data("value","0").removeClass("boolean-false boolean-true").addClass("boolean-false")}}else{console.log("画布控件+messageValue:"+b.value);var d=getCanvasNode(imageCanvas,c);if(d.userData.valueType&&0===b.status)switch(d.userData.valueType){case"textValueComponent":d.setText(String(b.value+d.userData.unit)),d.repaint();break;case"valueComponent":"LabelComponent"===d.userData.types?(d.setText(String(b.value)),d.repaint()):(d.label.setText(String(b.value)),d.label.repaint())}switch(b.status){case 0:switch(b.isAlarm){case!0:d.userData.Tag.tag_type,nodeOnAlarm(d,b.value);break;case!1:if("boolean"===d.userData.Tag.tag_type)switch(String(b.value)){case"true":nodeOnTrue(d,"打开");break;case"false":nodeOnFalse(d,"关闭")}else nodeOnTrue(d,b.value)}break;case 1:case 2:nodeOnDisconnected(d,b.value)}}websocketChangetable(b),changeTagValueForHighChar(b)}function nodeOnTrue(a,b){switch("LabelComponent"===a.userData.types||(a.stopTimer(),a.userData.BlinkingType="onTrue",1==a.userData.onTrue.Blinking&&a.startTimer(1e3),a.setStroke(Number(a.userData.onTrue.LineWidth)),a.setDashArray(a.userData.onTrue.LineStyle),a.setColor(a.userData.onTrue.LineColor)),a.userData.types){case"imageComponent":a.image.setPath(a.userData.onTrue.picture);break;case"buttonComponent":a.setBackgroundColor(a.userData.onTrue.FillColor),""==a.userData.onTrue.Text?a.userData.onTrue.unit?a.setText(String(b+a.userData.onTrue.unit)):a.setText(String(b)):a.setText(a.userData.onTrue.Text),a.setFontColor(a.userData.onTrue.TextColor);break;case"basicComponent":a.setBackgroundColor(a.userData.onTrue.FillColor),a.setAlpha(Number(a.userData.onTrue.alpha));break;case"conduitCompontent":a.setBackgroundColor(a.userData.onTrue.FillColor)}a.repaint()}function nodeOnFalse(a,b){switch("LabelComponent"===a.userData.types||(a.stopTimer(),a.userData.BlinkingType="onFalse",1==a.userData.onFalse.Blinking&&a.startTimer(1e3),a.setStroke(Number(a.userData.onFalse.LineWidth)),a.setDashArray(a.userData.onFalse.LineStyle),a.setColor(a.userData.onFalse.LineColor)),a.userData.types){case"imageComponent":a.image.setPath(a.userData.onFalse.picture);break;case"buttonComponent":a.setBackgroundColor(a.userData.onFalse.FillColor),""==a.userData.onFalse.Text?a.userData.onFalse.unit?a.setText(String(b+a.userData.onFalse.unit)):a.setText(String(b)):a.setText(a.userData.onFalse.Text),a.setFontColor(a.userData.onFalse.TextColor);break;case"basicComponent":a.setBackgroundColor(a.userData.onFalse.FillColor),a.setAlpha(Number(a.userData.onFalse.alpha));break;case"conduitCompontent":a.setBackgroundColor(a.userData.onTrue.FillColor)}a.repaint()}function nodeOnAlarm(a,b){switch("LabelComponent"===a.userData.types||(a.stopTimer(),a.userData.BlinkingType="onAlarm",1==a.userData.onAlarm.Blinking&&a.startTimer(1e3),a.setStroke(Number(a.userData.onAlarm.LineWidth)),a.setDashArray(a.userData.onAlarm.LineStyle),a.setColor(a.userData.onAlarm.LineColor)),a.userData.types){case"imageComponent":a.image.setPath(a.userData.onAlarm.picture);break;case"buttonComponent":a.setBackgroundColor(a.userData.onAlarm.FillColor),""==a.userData.onAlarm.Text?a.userData.onAlarm.unit?a.setText(String(b+a.userData.onAlarm.unit)):a.setText(String(b)):a.setText(a.userData.onAlarm.Text),a.setFontColor(a.userData.onAlarm.TextColor);break;case"basicComponent":a.setBackgroundColor(a.userData.onAlarm.FillColor),a.setAlpha(Number(a.userData.onAlarm.alpha));break;case"conduitCompontent":a.setBackgroundColor(a.userData.onAlarm.FillColor)}a.repaint()}function nodeOnDisconnected(a,b){switch("LabelComponent"===a.userData.types||(a.stopTimer(),a.userData.BlinkingType="onDisconnected",1==a.userData.onDisconnected.Blinking&&a.startTimer(1e3),a.setStroke(Number(a.userData.onDisconnected.LineWidth)),a.setDashArray(a.userData.onDisconnected.LineStyle),a.setColor(a.userData.onDisconnected.LineColor)),a.userData.types){case"imageComponent":a.image.setPath(a.userData.onDisconnected.picture);break;case"buttonComponent":a.setBackgroundColor(a.userData.onDisconnected.FillColor),""==a.userData.onDisconnected.Text||a.setText(a.userData.onDisconnected.Text),a.setFontColor(a.userData.onDisconnected.TextColor);break;case"basicComponent":a.setBackgroundColor(a.userData.onDisconnected.FillColor),a.setAlpha(Number(a.userData.onDisconnected.alpha));break;case"conduitCompontent":a.setBackgroundColor(a.userData.onDisconnected.FillColor)}a.repaint()}function websocketChangetable(a){$("#qu table tbody tr").find(".havetagid").each(function(b,c){if(Number($(c).text())==a.tagId){var d=$(c).parent().find(".havetagtype").text();switch(a.status){case 0:switch(a.isAlarm){case!1:if("boolean"==d)switch(console.log("测试灯的关闭========"),String(a.value)){case"false":$(c).parent().find(".tagState").html("正常"),$(c).parent().find(".tagsValue").html("关");break;case"true":$(c).parent().find(".tagState").html("正常"),$(c).parent().find(".tagsValue").html("开")}else $(c).parent().find(".tagState").html(""),$(c).parent().find(".tagsValue").html(a.value);break;case!0:if("boolean"==d)switch($(c).parent().find(".tagState").html('<span class="warn"></span><span class="size_red">报警</span>'),String(a.value)){case"false":$(c).parent().find(".tagsValue").html("关");break;case"true":$(c).parent().find(".tagsValue").html("开")}else $(c).parent().find(".tagState").html('<span class="warn"></span><span class="size_red">报警</span>'),$(c).parent().find(".tagsValue").html(a.value)}break;case 1:case 2:$(c).parent().find(".tagState").html('<span class="catch"></span><span class="size_yellow">通信异常</span>'),$(c).parent().find(".tagsValue").html("--")}}});for(var b in componentIsReadonly)if(Number(componentIsReadonly[b].tag_id)==Number(a.tagId))if("boolean"==componentIsReadonly[b].tag_type)switch(String(a.value)){case"false":componentIsReadonly[b].value=0;break;case"true":componentIsReadonly[b].value=1}else 0===a.status&&(componentIsReadonly[b].value=a.value)}function changeTagValueForHighChar(a){a.tagId==tagIdForHighChar&&(isNaN(a.value)||(tagValueForHighChar=Number(a.value)))}var view_id="",mqtt,reconnectTimeout=2e3,clientID="123",restart=!1,mqtt;$(function(){setInterval(function(){if(Number(view_id)>0&&mqtt){var a=new Paho.MQTT.Message(view_id);a.destinationName="Bayax/View/"+clientID,a.qos=0,mqtt.send(a),console.log("页面id："+view_id)}},3e3)});