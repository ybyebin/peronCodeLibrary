/*! test 2017-04-13 */

function commExcLoadData(a){var b={page:a,page_item_count:13,start_time:$("#startTime").val(),end_time:$("#endTime").val()};console.log("上传的数据"+JSON.stringify(b,null,2)),$.ajax({url:apiurl+"r=api/system/log/list",type:"post",dataType:"json",data:{data:JSON.stringify({page:a,page_item_count:13,start_time:$("#startTime").val(),end_time:$("#endTime").val()})},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(b){if($(".loading").hide(),b.success){console.log("报警数据:"+JSON.stringify(b,null,2));var c=b.data.data;null==c&&(c=[]);for(var d in c)switch(c[d].status){case"False":c[d].status="异常";break;case"True":c[d].status="恢复"}$("#commExclog-tbody tr td").html(""),$("#commExclog-tbody tr").each(function(a,b){if(a<c.length){var d="<td>"+c[a].name+"</td><td>"+c[a].ip+"</td><td >"+c[a].status+"</td><td >"+c[a].time+"</td>";$(b).html(d),console.log("index:"+a)}}),0===b.data.pageCount?(layer.msg("无数据"),$(".tcdPageCode").html("")):$(".tcdPageCode").createPage({pageCount:b.data.pageCount,current:a,backFn:function(a){console.log("这是第"+a+"页"),commExcLoadData(a)}})}else layer.msg(b.error_message),returnLogIn(b.error_message),console.log("错误原因"+JSON.stringify(b,null,2))},error:function(a){$(".loading").hide(),layer.msg(a.error_message),console.log("错误原因"+JSON.stringify(a,null,2))}})}function exportUserOperationLog(){var a=$("#startTime").val(),b=$("#endTime").val();console.log("时间区间:"+a+"--"+b),""!==a&&""!==b?a>b?layer.msg("开始时间大于结束时间"):compareYear(new Date(a),10)<=b?layer.msg("超过统计时间限制"):$.ajax({url:apiurl+"r=api/system/log/exe",type:"post",dataType:"json",data:{data:JSON.stringify({start_time:a,end_time:b})},success:function(a){a.success?window.location.href=a.data:(layer.msg(a.error_message),returnLogIn(a.error_message))},error:function(a){layer.msg(a.error_message),console.log("报警日志错误原因"+JSON.stringify(a,null,2))}}):layer.msg("时间区间不能为空")}$("#foot").load("public.html"),$(function(){publicHeadfun(),days(),$("#slectFen ul li a").click(function(){var a=!0;$("span.txt").text($(this).text());var b=$(this).attr("rel");1==b||2==b?($("#startTime").val($(this).attr("value")),$("#endTime").val($(this).attr("value"))):3==b||4==b||5==b?($("#startTime").val($(this).attr("value")),$("#endTime").val(compareDate(1,0))):6==b||7==b||8==b?($("#startTime").val($(this).attr("value")),6==b?counts=1:7==b?counts=2:8==b&&(counts=3),$("#endTime").val(getCurrentMonthLastForSelect($(this).attr("value")))):9==b&&(a=!1,$("#startTime").val(""),$("#endTime").val("")),a&&commExcLoadData(1)}),$("#slectFen ul li:nth-child(4) a").click()}),$("#startTime").datepicker({format:"yyyy-mm-dd ",autoclose:!0,todayBtn:!1,pickerPosition:"bottom-right",minView:2}).on("changeDate",function(a){$("#slectFen button .txt").html("自定义").attr("rel",9),$("#endTime")[0].focus()}),$("#endTime").datepicker({format:"yyyy-mm-dd ",autoclose:!0,todayBtn:!1,pickerPosition:"bottom-right",minView:2}).on("changeDate",function(a){$("#slectFen button .txt").html("自定义").attr("rel",9),timebeginisTrue=!0,checkEndTime("startTime","endTime",1)||($("#endTime").val(""),layer.msg("结束时间需晚于开始时间"),timebeginisTrue=!1),compareYear(new Date($("#startTime").val()),10)<=a.date.toLocaleDateString()&&(layer.msg("超过统计时间限制"),$("#endTime").val(""),timebeginisTrue=!1),timebeginisTrue&&commExcLoadData(1)});