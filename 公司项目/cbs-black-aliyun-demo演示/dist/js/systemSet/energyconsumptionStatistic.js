function energyConsumptionDisplayLoadData(a){$.ajax({url:apiurl+"energyconfig",type:"GET",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){$(".loading").hide(),e.success?null!==e.data.items?"display"===a?energyDisplayleftAddli(e.data.items):energyEditleftAddli(e.data.items):(layer.msg("未配置能耗统计"),$("#collapse-left ul").html(""),$("#edit_right_div_tab tr td").html(""),$("#hide_tag").iCheck("uncheck")):layer.msg(e.error_message)},error:function(a){publicAjaxError(a)}})}function energyDisplayleftAddli(a){if(0!==a.length){$(".collapse-left").html("");for(var e="<ul>",t=0;t<a.length;t++){e+='<li data-id="'+a[t].id+'" data-name="'+a[t].name+'">'+a[t].name+"</li>"}e+="</ul>",$(".collapse-left").html(e),$(".collapse-left ul").find("li")[0].click()}}function energyConsumptionDisplayRequestTableList(a,e){$.ajax({url:apiurl+"energytag/"+a,type:"GET",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){if($(".loading").hide(),a.success){$(".right-head-p").text(e),$("#display-table tbody").html("");var t=[];null!==a.data.items&&(t=a.data.items);for(var i in t)"1"==t[i].oprate?t[i].oprate="加":t[i].oprate="减";if(t.length<13)for(var l={name:"",oprate:"",node_name:"",point_id:""},r=13-t.length,n=0;n<r;n++)t.push(l);var o;for(var i in t)o+="<tr><td>"+t[i].name+"</td><td>"+t[i].oprate+"</td><td>"+t[i].node_name+"</td><td>"+t[i].point_id+"</td></tr>";$("#display-table tbody").append(o)}else layer.msg(a.error_message)},error:function(a){publicAjaxError(a)}})}function energyEditleftAddli(a){$(".collapse-left-edit ul").html("");var e="";if(0!==a.length){for(var t in a){e+='<li class="groups'+a[t].id+'" data-id="'+a[t].id+'" data-hidetag="'+a[t].hide_tag+'" data-sel="sel_no"><div class="li-display"><label class="col-sm-7 control-label">'+a[t].name+'</label><label class="col-sm-4 control-label"><a href="#" class="a-rename">重命名</a><a href="#" class="a-delete" data-id="'+a[t].id+'">删除</a></label></div><div class="li-rename" style="display:none"><label class="col-sm-7 control-label"><input type="text" maxlength="20" class="form-control" style="margin-top: 5px;"></label><label class="col-sm-4 control-label"><a href="#" class="a-rename-sure" data-id="'+a[t].id+'">确定</a><a href="#" class="a-rename-cancle">取消</a></label></div></li>'}$("#collapse-left ul").html(e);var i=sessionStorage.getItem("TagGroup");""!==i&&$(".groups"+i).click()}}function energyConsumptionEditRequestTableList(a,e){$.ajax({url:apiurl+"energytag/"+a,type:"GET",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){if($(".loading").hide(),a.success){1===Number(e)?$("#hide_tag").iCheck("check"):$("#hide_tag").iCheck("uncheck");var t=$("#edit_right_div_tab tbody");t.html("");var i=[];if(null!==a.data.items&&(i=a.data.items),leftTreeLiDatalabelGroup=i,i.length<12)for(var l={name:"",oprate:"x",node_name:"",point_id:""},r=12-i.length,n=0;n<r;n++)i.push(l);for(var o in i)if("x"==i[o].oprate){var d='<tr><td class="tag_name"></td><td></td><td></td></tr>';t.append(d)}else{var d='<tr id="'+i[o].tag_id+'"><td class="tag_name">'+i[o].name+'</td><td><select style="width: 70px;" class="form-control oprate'+o+'"><option value="1">加</option><option value = "0">减</option></select></td><td><a href="#" data-id="'+i[o].tag_id+'">删除</a></td></tr>';t.append(d),$(".oprate"+o).val(i[o].oprate)}}else layer.msg(a.error_message)},error:function(a){publicAjaxError(a)}})}function Contentsearch(a){var e=["name="+$("#content-search-input").val(),"page="+a,"page_item_count=8"];$.ajax({url:apiurl+"energytag?"+e.join("&"),type:"GET",success:function(e){if(e.success)if(0===e.data.items.length||null===e.data.items)$(".search_no_datalabel").show(),$("#search_datalabel_tab").hide(),$(".tcdPageCode").hide();else{$(".search_no_datalabel").hide(),$("#search_datalabel_tab").show(),$(".tcdPageCode").show(),$(".tcdPageCode").createPage({pageCount:e.data.pageCount,current:a,backFn:function(a){Contentsearch(a)}});var t=e.data.items,i={};for(var l in t)i[String(t[l].tag_id)]=t[l].tag_id,t[l].tag_type="能耗数据";$("#search_datalabel_tab tbody tr td").text(""),$("#search_datalabel_tab tbody tr").each(function(a,e){if(a<t.length){var i="<td>"+t[a].name+"</td><td>"+t[a].tag_type+"</td><td>"+t[a].point_id+'</td><td><input data-id="'+t[a].tag_id+'" data-name="'+t[a].name+'" type="checkbox" class="search_cksschec  search_ckss'+t[a].tag_id+'"></td>';$(e).html(i)}}),icheckInitialize1(),$(".search_cksschec").on("ifChanged",function(a){if($(this).is(":checked")){var e=$(this),t=!0;if($("#search_datalabel_tabright tbody").find("tr").each(function(a,i){if($(i).data("id")==e.data("id"))return t=!1,!1}),t){var i='<tr data-id="'+$(this).data("id")+'"><td class="td_tagname">'+$(this).data("name")+'</td><td class="td_operat"><select style="width:70px;" class="form-control"><option value="1">加</option><option value="0">减</option></select></td><td><a class="layer_a_delete" href="#"  data-id="'+$(this).data("id")+'">删除</a></td></tr>';$("#search_datalabel_tabright tbody").append(i)}}else{var e=$(this);$("#search_datalabel_tabright tbody").find("tr").each(function(a,t){if($(t).data("id")==e.data("id"))return $(t).remove(),!1})}});var r=[];$("#search_datalabel_tabright tbody").find("tr").each(function(a,e){var t={tag_id:String($(e).data("id"))};r.push(t)});for(var l in r)i[r[l].tag_id]&&$(".search_ckss"+r[l].tag_id).iCheck("check")}else layer.msg(e.error_message)},error:function(a){publicAjaxError(a)}})}function saveOrCreatgroup(a,e,t){$.ajax({url:a,type:e,dataType:"json",data:t,beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){a.success?(addgroup?layer.msg("数据更新成功"):(layer.msg("创建成功"),addgroup=!0),energyConsumptionDisplayLoadData("edit")):layer.msg(a.error_message)},error:function(a){publicAjaxError(a)}})}function RegeMatch(a){var e=new RegExp(/[^\a-\z\A-\Z0-9\u4E00-\u9FA5\-_]/g);if(""!=a.val()&&null!=a)return!e.test(a.val())}function icheckInitialize(){$(".ckss").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"})}function icheckInitialize1(){$(".search_cksschec").iCheck("destroy"),$(".search_cksschec").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",increaseArea:"20%"})}function switchInterface(){$("input.ckss").iCheck("destroy"),icheckInitialize()}function projectEnergyconsumption(){$.ajax({url:apiurl+"project",type:"get",success:function(a){a.success?($("#logo").attr("src",a.data.logo_path),$(".left-div-head span").text(a.data.name)):layer.msg(a.error_message)},error:function(a){layer.msg(a.error_message),returnLogIn(a)}})}$("#collapse-lefts").on("click","ul li",function(){$("#collapse-lefts ul li").removeClass("active"),$(this).addClass("active"),energyConsumptionDisplayRequestTableList($(this).data("id"),$(this).data("name")),setTimeout(function(){$(".div-have-tables").mCustomScrollbar("scrollTo","top")},300)}),$("#statistical-btn-edit").on("click",function(){window.location.href="energyconsumptionStatisticEdit.html"});var rename=!0,addgroup=!0,leftTreeLiDatalabelGroup,layerCheckedDatalabelGroup;$("#statistical-btn-cancle").on("click",function(){window.location.href="energyconsumptionStatisticDis.html"}),$(".collapse-left-edit").on("click","ul li",function(){1==rename&&1==addgroup&&($(".collapse-left-edit ul li").removeClass("active"),$(this).addClass("active"),$(".collapse-left-edit ul li").data("sel","sel_no"),$(this).data("sel","sel"),energyConsumptionEditRequestTableList($(this).data("id"),$(this).data("hidetag")),$("#edit-btn-savedatalabel").data("id",$(this).data("id")),sessionStorage.setItem("TagGroup",$(this).data("id")))}),$(".collapse-left-edit").on("click","a.a-rename",function(a){if(a&&a.stopPropagation&&a.stopPropagation(),!0===rename&&!0===addgroup){rename=!1,$(this).parent().parent().hide();$(this).parent().parent().parent().find("div.li-rename").show()}}),$(".collapse-left-edit").on("click","a.a-delete",function(a){a&&a.stopPropagation&&a.stopPropagation();var e=$(this).data("id");layer.open({title:["删除能耗组","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["600px","200px"],content:$("#edit_delete_tree_li"),shift:2,move:!1,btn:["确定","放弃"],success:function(a,e){},yes:function(a){$.ajax({url:apiurl+"energyconfig/"+e,type:"DELETE",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){$(".loading").hide(),e.success?($("#edit_right_div_tab tbody tr td").each(function(a,e){$(e).html("")}),sessionStorage.removeItem("TagGroup"),energyConsumptionDisplayLoadData("edit"),layer.msg("删除成功"),layer.close(a)):layer.msg(e.error_message)},error:function(a){publicAjaxError(a)}})},btn2:function(a){layer.close(a)}})}),$(".collapse-left-edit").on("click","a.a-rename-cancle",function(a){a&&a.stopPropagation&&a.stopPropagation(),rename=!0,$(this).parent().parent().hide();var e=$(this).parent().parent().parent();e.find("div.li-display").show(),"sel"==e.data("sel")&&e.addClass("active")}),$(".collapse-left-edit").on("click","a.a-rename-sure",function(a){a&&a.stopPropagation&&a.stopPropagation();var e=$(this),t=$(this).parent().parent().find("input");""!=t.val()?RegeMatch(t)?$.ajax({url:apiurl+"energyconfig/0",type:"PUT",dataType:"json",data:{id:$(this).data("id"),name:t.val()},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){if($(".loading").hide(),a.success){var i=e.parent().parent();i.hide(),i.parent().find("div.li-display").show(),i.parent().find("div.li-display label:first-child").text(t.val()),layer.msg("更改成功"),rename=!0}else layer.msg(a.error_message)},error:function(a){publicAjaxError(a)}}):layer.msg("指定的组名称格式错误"):layer.msg("名称不能为空")}),$("#a-add-groups").on("click",function(){if(1==addgroup&&1==rename){sessionStorage.removeItem("TagGroup"),$(".collapse-left-edit ul li").removeClass("active"),$(".collapse-left-div").mCustomScrollbar("scrollTo","top"),addgroup=!1;$(".collapse-left-edit ul").prepend('<li id="add_group_li"><div><label class="col-sm-7 control-label"><input type="text"  maxlength="20"  class="form-control add_groupname_input" style="margin-top: 5px;"></label><label class="col-sm-4 control-label"><a href="#" class="a-add-sure">确定</a><a href="#" class="a-add-cancel">取消</a></label></div></li>'),$("#edit_right_div_tab tbody tr td").each(function(a,e){$(e).html("")})}}),$(".collapse-left-edit").on("click","a.a-add-sure",function(a){a&&a.stopPropagation&&a.stopPropagation();var e=$(this).parent().parent().find("input");""!=e.val()?RegeMatch(e)?layer.open({title:["搜索数据标签","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["1080px","625px"],content:$("#search-datalabel"),shift:2,move:!1,btn:["确定","放弃"],success:function(a,e){$(".search_no_datalabel").show(),$("#search_datalabel_tab").hide(),$(".tcdPageCode").hide(),$("#content-search-input").val(""),$("#search_datalabel_tab tbody tr td").html(""),$("#search_datalabel_tabright tbody").html("")},yes:function(a){if(layerCheckedDatalabelGroup=[],$("#search_datalabel_tabright tbody").find("tr").each(function(a,e){var t={tag_id:$(e).data("id"),name:$(e).find("td.td_tagname").text(),oprate:$(e).find("td.td_operat select").val()};layerCheckedDatalabelGroup.push(t)}),$("#edit_right_div_tab tbody").html(""),layerCheckedDatalabelGroup.length<12)for(var e={name:"",oprate:"x",node_name:"",point_id:""},t=12-layerCheckedDatalabelGroup.length,i=0;i<t;i++)layerCheckedDatalabelGroup.push(e);for(var l in layerCheckedDatalabelGroup)if("x"==layerCheckedDatalabelGroup[l].oprate){var r='<tr><td class="tag_name"></td><td></td><td></td></tr>';$("#edit_right_div_tab tbody").append(r)}else{var r='<tr id="'+layerCheckedDatalabelGroup[l].tag_id+'"><td class="tag_name">'+layerCheckedDatalabelGroup[l].name+'</td><td><select style="width:70px;" class="form-control oprate'+l+'"><option value="1">加</option><option value="0">减</option></select></td><td><a  href="#" data-id="'+layerCheckedDatalabelGroup[l].tag_id+'">删除</a></td></tr>';$("#edit_right_div_tab tbody").append(r),$(".oprate"+l).val(layerCheckedDatalabelGroup[l].oprate)}layer.close(a)},btn2:function(a){layer.close(a)}}):layer.msg("指定的组名称格式错误"):layer.msg("名称不能为空")}),$(".collapse-left-edit").on("click","a.a-add-cancel",function(a){a&&a.stopPropagation&&a.stopPropagation(),$(this).parent().parent().parent("#add_group_li").remove(),addgroup=!0}),$("#edit-btn-adddatalabel").on("click",function(){layer.open({title:["搜索数据标签","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["1080px","645px"],content:$("#search-datalabel"),shift:2,move:!1,btn:["确定","放弃"],success:function(a,e){$(".search_no_datalabel").show(),$("#search_datalabel_tab").hide(),$(".tcdPageCode").hide(),$("#search_datalabel_tab tbody tr td").html(""),$("#search_datalabel_tabright tbody").html("");var t=[];$("#edit_right_div_tab tbody").find("tr").each(function(a,e){if(""!=$(e).find("td.tag_name").text()){var i={tag_id:$(e).attr("id"),oprate:$(e).find("select").val(),name:$(e).find("td.tag_name").text()};t.push(i)}});for(var i in t){var l='<tr data-id="'+t[i].tag_id+'"><td class="td_tagname">'+t[i].name+'</td><td class="td_operat"><select style="width:70px;" class="form-control layer_select'+i+'"><option value="1">加</option><option value="0">减</option></select></td><td><a class="layer_a_delete" data-id="'+t[i].tag_id+'" href="#">删除</a></td></tr>';$("#search_datalabel_tabright tbody").append(l),$("#search_datalabel_tabright tbody").find(".layer_select"+i).val(t[i].oprate)}},yes:function(a){if(layerCheckedDatalabelGroup=[],$("#search_datalabel_tabright tbody").find("tr").each(function(a,e){var t={tag_id:$(e).data("id"),name:$(e).find("td.td_tagname").text(),oprate:$(e).find("td.td_operat select").val()};layerCheckedDatalabelGroup.push(t)}),$("#edit_right_div_tab tbody").html(""),layerCheckedDatalabelGroup.length<12)for(var e={name:"",oprate:"x",node_name:"",point_id:""},t=12-layerCheckedDatalabelGroup.length,i=0;i<t;i++)layerCheckedDatalabelGroup.push(e);for(var l in layerCheckedDatalabelGroup)if("x"==layerCheckedDatalabelGroup[l].oprate){var r='<tr><td class="tag_name"></td><td></td><td></td></tr>';$("#edit_right_div_tab tbody").append(r)}else{var r='<tr id="'+layerCheckedDatalabelGroup[l].tag_id+'"><td class="tag_name">'+layerCheckedDatalabelGroup[l].name+'</td><td><select style="width:70px;" class="form-control oprate'+l+'"><option value="1">加</option><option value="0">减</option></select></td><td><a  href="#" data-id="'+layerCheckedDatalabelGroup[l].tag_id+'">删除</a></td></tr>';$("#edit_right_div_tab tbody").append(r),$(".oprate"+l).val(layerCheckedDatalabelGroup[l].oprate)}layer.close(a)},btn2:function(a){layer.close(a)}})}),$("#edit_right_div_tab tbody").on("click","a",function(){$(this).parent().parent().remove()});var test=!0;$("#content-search-input").on("input",function(){""===$("#content-search-input").val()||Contentsearch(1)}),$("#search_datalabel_right").on("click","#search_datalabel_tabright a.layer_a_delete",function(){var a=$(this).data("id");$("#search_datalabel_tab tbody").find("input.search_cksschec").each(function(e,t){if($(t).data("id")==a)return $(t).iCheck("uncheck"),!1}),$(this).parent().parent().remove()}),$("#edit-btn-savedatalabel").on("click",function(){var a,e,t=apiurl+"energyconfig/1",i=apiurl+"energyconfig",l=[];$("#edit_right_div_tab tbody").find("tr").each(function(a,e){if(""!=$(e).find("td.tag_name").text()){var t={tag_id:Number($(e).attr("id")),oprate:$(e).find("select").val()};l.push(t)}});var r;r=$("#hide_tag").is(":checked")?1:0,addgroup?(e={id:$("#edit-btn-savedatalabel").data("id"),hide_tag:r,tag_list:l},a=t,saveOrCreatgroup(a,"PUT",e)):""!=$(".add_groupname_input").val()?(e={name:$(".add_groupname_input").val(),hide_tag:r,tag_list:l},a=i,saveOrCreatgroup(a,"post",e)):layer.msg("新建组名不能为空")}),$("#clearImage").on("click",function(){$("#content-search-input").val(""),$("#search_datalabel_tab tbody tr td").html(""),$(".tcdPageCode").hide()});