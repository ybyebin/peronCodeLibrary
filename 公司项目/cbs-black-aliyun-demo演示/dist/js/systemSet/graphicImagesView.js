function systemImageLoadImageData(e){$.ajax({url:apiurl+"view",type:"get",dataType:"json",data:{view_group_id:e},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){$(".loading").hide(),e.success?($(".subsystem-head .group-name").text(sessionStorage.getItem("viewGroupeName")),systemImageAddRow(e.data.items)):layer.msg(e.error_message)},error:function(e){$(".loading").hide(),layer.msg(e.error_message),returnLogIn(e)}})}function systemImageAddRow(e){null==e&&(e=[{id:""}]);var a=e.length;if(a<13)for(var t=13-a,s={id:""},i=0;i<t;i++)e.push(s);var n=$("#sub-graphicImages-tab tbody");n.html("");for(var o in e){var r;r=""===e[o].id?"<tr><td></td><td></td></tr>":'<tr id="'+e[o].id+'"><td  id="images'+e[o].id+'">'+e[o].name+'</td><td><a data-id="'+e[o].id+'" data-name="#images'+e[o].id+'" class ="image-rename">重命名</a><a data-id="'+e[o].id+'" data-name="#images'+e[o].id+'" class="image-delete">删除</a><a data-id="'+e[o].id+'" class="edit-image">编辑画面</a></td></tr>',n.append(r)}}var view_groupId=sessionStorage.getItem("viewGroupeId");$(function(){projectInfo(),systemImageLoadImageData(view_groupId),icheckInte()}),$(".go-subsys").on("click",function(){window.location.href="graphicImages.html"}),$("#sub-graphicImages-tab tbody").on("click","a.image-rename",function(e){e&&e.stopPropagation&&e.stopPropagation();var a=$(this);layer.open({title:["画面重命名","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["900px","220px"],content:$("#change-subsys-name"),shift:2,move:!1,btn:["保存","取消"],success:function(e){$(".subsys-warn").text(""),$(".subsys-input").val("")},yes:function(e){""===$(".subsys-warn").text()?""===$(".subsys-input").val()?layer.msg("名称不能为空"):$.ajax({url:apiurl+"view/0",type:"PUT",dataType:"json",data:{id:a.data("id"),name:$(".subsys-input").val(),external_link:""},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(t){if($(".loading").hide(),t.success){layer.msg("更改成功");var s=$(".subsys-input");$(a.data("name")).text(s.val()),layer.close(e),s.val("")}else layer.msg(t.error_message)},error:function(e){$(".loading").hide(),layer.msg(e.error_message),returnLogIn(e)}}):layer.msg("请检查输入是否准确")},btn2:function(e){layer.close(e)}})}),$("#sub-graphicImages-tab tbody").on("click","a.image-delete",function(e){e&&e.stopPropagation&&e.stopPropagation(),$this=$(this),layer.open({title:["确认删除","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["900px","220px"],content:$("#delete-subsys"),shift:2,move:!1,btn:["确认","取消"],success:function(e){$("#delete-subsys span strong").text($this.parent().parent().find($this.data("name")).text())},yes:function(e){layer.close(e),$.ajax({url:apiurl+"view/"+$this.data("id"),type:"DELETE",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){$(".loading").hide(),e.success?(systemImageLoadImageData(view_groupId),layer.msg("删除成功")):(layer.msg(e.error_message),returnLogIn(e.error_message))},error:function(e){$(".loading").hide(),layer.msg(e.error_message)}})},btn2:function(e){layer.close(e)}})}),$("#sub-graphicImages-tab tbody").on("click","a.edit-image",function(e){"undefined"!=typeof Storage&&(sessionStorage.setItem("view_id",$(this).data("id")),window.location.href="editCanvas.html")}),$(".graphic-main-btn").on("click",function(){layer.open({title:["新建画面","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["900px","270px"],content:$("#creat-subsystem-image"),shift:2,move:!1,btn:["保存","取消"],success:function(e){$(".scadaimages-name").val(""),$(".image-warn").text(""),$(".href-other").val(""),$(".href-other").attr("disabled","disabled"),$(".ckss").iCheck("uncheck")},yes:function(e){if(""===$(".image-warn").text())if(""===$(".scadaimages-name").val())layer.msg("名称不能为空");else{var a;a=$(".ckss").is(":checked")?{project_id:1,view_group_id:view_groupId,name:$(".scadaimages-name").val(),external_link:$(".href-other").val()}:{project_id:1,view_group_id:view_groupId,name:$(".scadaimages-name").val()},$.ajax({url:apiurl+"view",type:"post",dataType:"json",data:a,beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){$(".loading").hide(),a.success?(layer.close(e),$(".ckss").is(":checked")?(layer.close(e),systemImageLoadImageData(view_groupId)):"undefined"!=typeof Storage&&(sessionStorage.setItem("view_id",a.data.id),sessionStorage.setItem("view_name",$(".scadaimages-name").val()),window.location.href="canvas.html")):layer.msg(a.error_message)},error:function(e){$(".loading").hide(),layer.msg(e.error_message),returnLogIn(e)}})}else layer.msg("请检查输入是否准确")},btn2:function(e){layer.close(e)}})}),$(".ckss").on("ifChanged",function(){$(".ckss").is(":checked")?$(".href-other").removeAttr("disabled"):$(".href-other").attr("disabled","disabled")}),$(".scadaimages-name").on("input",function(){if($(".image-warn").text(""),RegeMatchTwo($(this),$(".image-warn")),""==$(".scadaimages-name").val()&&""==$(".image-warn").text()&&$(".image-warn").text("不能为空"),""==$(".image-warn").text()){chEnWordCount($(".scadaimages-name").val())>20&&$(".image-warn").show().text("字符超出限制")}}),$(".subsys-input").on("input",function(){if($(".subsys-warn").text(""),RegeMatchTwo($(this),$(".subsys-warn")),""==$(".subsys-input").val()&&""==$(".subsys-warn").text()&&$(".subsys-warn").text("不能为空"),""==$(".subsys-warn").text()){chEnWordCount($(".subsys-input").val())>20&&$(".subsys-warn").show().text("字符超出限制")}});