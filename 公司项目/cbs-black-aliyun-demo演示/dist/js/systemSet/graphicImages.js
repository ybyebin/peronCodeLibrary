function graphicImageGetData(){$.ajax({url:apiurl+"subsystem",type:"get",dataType:"json",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(s){$(".loading").hide(),s.success?subsysListAddRow(s.data.items):layer.msg(s.error_message)},error:function(s){publicAjaxError(s)}})}function subsysListAddRow(s){null==s&&(s=[{id:""}]);var t=s.length;if(t<13)for(var e=13-t,a={id:""},n=0;n<e;n++)s.push(a);$("#graphicImages-tab tbody").html("");for(var i in s){var o;o=""===s[i].id?'<tr id=""><td></td><td></td><td></td></tr>':'<tr id="'+s[i].id+'"  data-name="'+s[i].name+'"><td  id="subsys'+s[i].id+'">'+s[i].name+'</td><td class="view-cont">'+s[i].view_count+'</td><td><a data-id="'+s[i].id+'" data-name="#subsys'+s[i].id+'" class ="subsys-rename">重命名</a><a data-id="'+s[i].id+'"  data-name="#subsys'+s[i].id+'" class="subsys-delete">删除</a></td></tr>',$("#graphicImages-tab tbody").append(o)}}function creatSubsys(s){$.ajax({url:apiurl+"subsystem",type:"post",dataType:"json",data:{project_id:$("#logo").data("proid"),name:s},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(s){$(".loading").hide(),s.success?(graphicImageGetData(),layer.msg("新建成功")):layer.msg(s.error_message)},error:function(s){publicAjaxError(s)}})}$(function(){projectInfo(),graphicImageGetData(),icheckInte()}),$("#graphicImages-tab tbody").on("click","tr",function(){""===$(this).prop("id")||(sessionStorage.setItem("viewGroupeId",$(this).prop("id")),sessionStorage.setItem("viewGroupeName",$(this).data("name")),window.location.href="graphicImagesView.html")}),$("#graphicImages-tab tbody").on("click","a.subsys-rename",function(s){s&&s.stopPropagation&&s.stopPropagation();var t=$(this);layer.open({title:["系统重命名","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["900px","220px"],content:$("#change-subsys-name"),shift:2,move:!1,btn:["保存","取消"],success:function(s){$(".subsys-warn").text(""),$(".subsys-input").val("")},yes:function(s){""===$(".subsys-warn").text()?""===$(".subsys-input").val()?layer.msg("名称不能为空"):$.ajax({url:apiurl+"subsystem",type:"put",dataType:"json",data:{project_id:$("#logo").data("proid"),id:t.data("id"),name:$(".subsys-input").val()},beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){$(".loading").hide(),e.success?($(t.data("name")).text($(".subsys-input").val()),layer.close(s),layer.msg("更改成功"),$(".subsys-input").val("")):layer.msg(e.error_message)},error:function(s){publicAjaxError(s)}}):layer.msg("请检查输入是否准确")},btn2:function(s){layer.close(s)}})}),$(".subsys-input").on("input",function(){if($(".subsys-warn").text(""),RegeMatchTwo($(this),$(".subsys-warn")),""==$(".subsys-input").val()&&""==$(".subsys-warn").text()&&$(".subsys-warn").text("不能为空"),""==$(".subsys-warn").text()){chEnWordCount($(".subsys-input").val())>20&&$(".subsys-warn").show().text("字符超出限制")}}),$("#graphicImages-tab tbody").on("click","a.subsys-delete",function(s){s&&s.stopPropagation&&s.stopPropagation(),$this=$(this),Number($this.parent().parent().find("td.view-cont").text())>0?layer.msg("系统画面不为零 不能删除"):layer.open({title:["确认删除","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["900px","220px"],content:$("#delete-subsys"),shift:2,move:!1,btn:["确认","取消"],success:function(s){$("#delete-subsys span strong").text($this.parent().parent().find($this.data("name")).text())},yes:function(s){$.ajax({url:apiurl+"subsystem/"+$this.data("id"),type:"DELETE",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(t){$(".loading").hide(),t.success?(layer.close(s),graphicImageGetData($this.data("page")),layer.msg("删除成功")):layer.msg(t.error_message)},error:function(s){publicAjaxError(s)}})},btn2:function(s){layer.close(s)}})}),$(".div-creatsys ul li:not(:last-child) a").on("click",function(){creatSubsys($(this).text())}),$(".div-creatsys ul li:last-child").on("click",function(){layer.open({title:["新建子系统","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["900px","220px"],content:$("#change-subsys-name"),shift:2,move:!1,btn:["保存","取消"],success:function(s){$(".subsys-warn").text(""),$(".subsys-input").val("")},yes:function(s){""===$(".subsys-warn").text()?""===$(".subsys-input").val()?layer.msg("名称不能为空"):(layer.msg("更改成功"),creatSubsys($(".subsys-input").val()),layer.close(s)):layer.msg("请检查输入是否准确")},btn2:function(s){layer.close(s)}})});