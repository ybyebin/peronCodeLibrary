$(function(){ProjectFun.init(),ProjectFun.getProjectMessage()});var $pro={pro_name_input:$(".obj-name-input"),obj_name_text:$(".obj-name-text"),logo_img:$("#logo-img"),logo_main_img:$("#logo-main-img"),pro_main_management:$("#project-main-management"),pro_edit_management:$("#project-edit-management"),pro_btn_save:$("#project-btn-save"),obj_btn_upLogo:$("#obj-btn-upLogo"),warn_span:$(".warn_span"),instructions:$(".instructions"),language_text:$(".language-text"),select_language:$(".select-language"),loading:$(".loading")},ProjectFun={init:function(){$(".obj-name-input").on("input",function(){if($pro.instructions.show(),$pro.warn_span.hide().text(""),RegeMatch($(this),$pro.warn_span,$pro.instructions),""==$pro.pro_name_input.val()&&""==$pro.warn_span.text()&&($pro.instructions.hide(),$pro.warn_span.show().text("不能为空")),""==$pro.warn_span.text()){chEnWordCount($pro.pro_name_input.val())>20&&($pro.instructions.hide(),$pro.warn_span.show().text("字符超出限制"))}}),$(".obj-name-input").blur(function(){if(""==$pro.warn_span.text())if(""==$pro.pro_name_input.val())$pro.instructions.hide(),$pro.warn_span.show().text("不能为空");else{var o=chEnWordCount($pro.pro_name_input.val());o>20&&($pro.instructions.hide(),$pro.warn_span.show().text("字符超出限制"))}})},edit:function(){$pro.pro_name_input.val($pro.obj_name_text.text()),$pro.logo_img.attr("src",$pro.logo_main_img.attr("src")).data("url",$pro.logo_main_img.attr("src")),$pro.pro_main_management.hide(),$pro.pro_edit_management.show()},save:function(){""!=$pro.pro_name_input.val()&&""==$pro.warn_span.text()?$.ajax({url:apiurl+"project",type:"put",dataType:"json",data:{id:Number($pro.pro_btn_save.data("id")),name:$pro.pro_name_input.val(),logo_path:$pro.logo_img.data("url"),locale:$pro.select_language.val()},beforeSend:function(){$pro.loading.show()},complete:function(){$pro.loading.hide()},success:function(o){$pro.loading.hide(),o.success?(layer.msg("修改成功"),ProjectFun.getProjectMessage(),$pro.pro_main_management.show(),$pro.pro_edit_management.hide()):layer.msg(o.error_message)},error:function(o){publicAjaxError(o)}}):layer.msg("请确认名称输入准确")},cancle:function(){$pro.pro_main_management.show(),$pro.pro_edit_management.hide()},upLogo:function(){$("#imageFileField-logo").val("").click()},getProjectMessage:function(){$.ajax({url:apiurl+"project",type:"get",dataType:"json",beforeSend:function(){$pro.loading.show()},complete:function(){$pro.loading.hide()},success:function(o){if($pro.loading.hide(),o.success){var e=o.data;switch($pro.obj_name_text.text(e.name),$pro.pro_name_input.val(e.name),$pro.logo_main_img.attr("src",e.logo_path),$pro.logo_img.attr("src",e.logo_path).data("url",e.logo_path),$("#logo").attr("src",e.logo_path),Number(e.locale)){case 1:$pro.language_text.text("中文"),$pro.select_language.val("1");break;case 2:$pro.language_text.text("英文"),$pro.select_language.val("2");break;case 3:$pro.language_text.text("日文"),$pro.select_language.val("3")}$.data($("#project-btn-save")[0],"id",e.id)}else layer.msg(o.error_message)},error:function(o){publicAjaxError(o)}})},showPreview:function(o){var e=o.files[0];if(null!=e){if(!/image\/\w+/.test(e.type))return alert("请确保文件为图像类型"),!1;if(window.FileReader){var a=new FileReader;a.readAsDataURL(e),a.onload=function(o){$.ajax({url:apiurl+"fileupload",type:"post",dataType:"json",data:{data:o.target.result},beforeSend:function(){$pro.loading.show()},complete:function(){$pro.loading.hide()},success:function(e){$pro.loading.hide(),e.success?$pro.logo_img.data("url",e.data).attr("src",o.target.result):layer.msg(e.error_message)},error:function(o){publicAjaxError(o)}})}}}}};