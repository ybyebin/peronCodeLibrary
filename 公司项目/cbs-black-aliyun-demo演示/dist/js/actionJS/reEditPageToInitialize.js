function displayJSON(e){(new draw2d.io.json.Writer).marshal(e,function(e){})}function getGroupNameAndViewName(e,a){var t=$(".loading");$.ajax({url:"/api/view/"+e,type:"GET",beforeSend:function(){t.show()},complete:function(){t.hide()},success:function(e){if(t.hide(),e.success)if(null!==e.data){$(".go-subsys span").text(sessionStorage.getItem("viewGroupeName")),$(".group-name").text(e.data.name);var n=e.data.background_img_url;if(null===n||""===n||($("#myBgimage").css("background-image","url("+n+")"),$("#myBgimage").data("url",n)),null!==e.data.background_color&&$("#canvas").css("background-color",e.data.background_color),null!==e.data.view_data){var i=JSON.parse(e.data.view_data).canvas,o=JSON.parse(e.data.view_data).subCanvas;for(var r in o){$(".no-glo-btn").hide();var s='<p><button id="'+o[r].id+'" data-tag-id="'+o[r].tag_id+'" data-tag-name="'+o[r].tag_name+'" data-tag-type="'+o[r].tag_type+'" data-bingding-status="'+o[r].bingding_status+'" data-readonly="'+o[r].readonly+'" data-name="'+o[r].name+'">'+o[r].name+'</button><img src="images/delete.png"></p>';$(".have-btn #mCSB_2_container").append(s)}var d=new draw2d.io.json.Reader;d.unmarshal(a,i),$("#comp-offsetx").val(""),$("#comp-offsety").val("");var l=new draw2d.io.json.Writer;l.marshal(a,function(e){for(var a in e){var t=getCanvasNode(e[a].id);if(t.userData.ShowCaption){switch(e[a].userData.ShowCaption){case!0:t.label.setVisible(!0);break;case!1:t.label.setVisible(!1)}t.label.setText(e[a].userData.Caption),t.label.repaint()}switch(1==t.userData.Blinking&&t.startTimer(1e3),"conduitCompontent"===t.userData.types&&t.resetPorts(),t.image&&(t.image.setHeight(t.getHeight()),t.image.setWidth(t.getWidth())),t.userData.picture&&(t.image.setPath(t.userData.picture),t.image.setHeight(t.getHeight()),t.image.setWidth(t.getWidth())),t.alpha){case 0:t.setAlpha(0),t.image&&t.image.setAlpha(0),t.label&&t.label.setAlpha(0)}t.repaint()}})}}else layer.msg("获取数据失败");else layer.msg(e.error_message)},error:function(e){publicAjaxError(e)}})}function getCanvasNode(e){var a=imageCanvas.getFigure(e),t=imageCanvas.getLine(e);return null!==a?a:null!==t?t:void 0}var pageOne="页面1",imageCanvas;$(window).load(function(){draw2d.Configuration.factory.createConnection=function(e,a,t,n){return new HoverConnection(e,a)},draw2d.Configuration.factory.createResizeHandle=function(e,a){var t=new draw2d.ResizeHandle(e,a);return t.attr({width:10,height:10,radius:0,color:"#35C99D",stroke:1,bgColor:"#35C99D"}),t};var e=new example.Application,a=e.view,t=a.paper.createFilter();t.createShadow(0,0,3,.3,"#000000"),t.element.setAttribute("x","-35%"),t.element.setAttribute("y","-35%"),a.on("figure:add",function(e,a){a.figure instanceof draw2d.Connection||a.figure.shape.filter(t)}),a.installEditPolicy(new draw2d.policy.canvas.SnapToGeometryEditPolicy({lineColor:"#35c99d"})),a.installEditPolicy(new draw2d.policy.canvas.SnapToInBetweenEditPolicy({lineColor:"#35c99d"})),a.installEditPolicy(new draw2d.policy.canvas.SnapToCenterEditPolicy({lineColor:"#35c99d"})),a.installEditPolicy(new draw2d.policy.canvas.CoronaDecorationPolicy),imageCanvas=a,a.getCommandStack().addEventListener(function(e){e.isPostChangeEvent()&&displayJSON(a)}),getGroupNameAndViewName(sessionStorage.getItem("view_id"),a)});var HoverConnection=draw2d.Connection.extend({init:function(e,a){var t=this;this._super({router:new draw2d.layout.connection.InteractiveManhattanConnectionRouter,radius:5,stroke:1.35,color:"#68C9FF"}),this.on("dragEnter",function(e,a){t.attr({outlineColor:"#68C9FF",outlineStroke:2,color:"#68C9FF"})}),this.on("dragLeave",function(e,a){t.attr({outlineColor:"#68C9FF",outlineStroke:0,color:"#68C9FF"})})},onDragEnter:function(e){return this}});