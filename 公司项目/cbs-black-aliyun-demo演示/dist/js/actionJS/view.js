var example={};example.Application=Class.extend({NAME:"example.Application",init:function(){this.view=new example.View("canvas"),this.toolbar=new example.Toolbar("toolbar",this.view)}}),example.View=draw2d.Canvas.extend({init:function(e){this._super(e),this.setScrollArea("#"+e),this.currentDropConnection=null},onDrag:function(e,a,t){},onDrop:function(droppedDomNode,x,y,shiftKey,ctrlKey){var type=$(droppedDomNode).data("shape"),figure=eval("new "+type+"();");switch(type){case"rectangleComponent":figure.getUserData().name=figure.getUserData().name+rectangle,rectangle+=1;break;case"RoundedRectangleComponent":figure.getUserData().name=figure.getUserData().name+RoundedRectangle,RoundedRectangle+=1;break;case"EllipseComponent":figure.getUserData().name=figure.getUserData().name+Ellipse,Ellipse+=1;break;case"polygonComponent":figure.getUserData().name=figure.getUserData().name+polygon,polygon+=1;break;case"LineComponent":figure.getUserData().name=figure.getUserData().name+linenum,linenum+=1;break;case"conduitCompontent":figure.getUserData().name=figure.getUserData().name+conduitnum,linenum+=1;break;case"forRightComponent":figure.getUserData().name=figure.getUserData().name+forRight,forRight+=1;break;case"forLeftComponent":figure.getUserData().name=figure.getUserData().name+forLeft,forLeft+=1;break;case"forUpComponent":figure.getUserData().name=figure.getUserData().name+forUp,forUp+=1;break;case"forDownComponent":figure.getUserData().name=figure.getUserData().name+forDown,forDown+=1;break;case"BothArrowHComponent":figure.getUserData().name=figure.getUserData().name+BothArrowH,BothArrowH+=1;break;case"BothArrowVComponent":figure.getUserData().name=figure.getUserData().name+BothArrowV,BothArrowV+=1;break;case"LabelComponent":figure.getUserData().name=figure.getUserData().name+labelnum,figure.getUserData().Caption=figure.getUserData().Caption+labelnum,figure.label.setText(figure.getUserData().Caption),labelnum+=1;break;case"buttonComponent":figure.getUserData().name=figure.getUserData().name+buttons,figure.getUserData().Caption=figure.getUserData().Caption+buttons,figure.label.setText(figure.getUserData().Caption),buttons+=1;break;case"textComponent":figure.getUserData().name=figure.getUserData().name+textnum,figure.getUserData().Caption=figure.getUserData().Caption+textnum,figure.label.setText(figure.getUserData().Caption),textnum+=1;break;case"imageComponent":figure.getUserData().name=figure.getUserData().name+imagenum,figure.getUserData().Caption=figure.getUserData().Caption+imagenum,figure.label.setText(figure.getUserData().Caption),imagenum+=1;break;case"switchComponent":figure.getUserData().name=figure.getUserData().name+switchs,figure.getUserData().Caption=figure.getUserData().Caption+switchs,figure.label.setText(figure.getUserData().Caption),switchs+=1;break;case"pipingComponent":figure.getUserData().name=figure.getUserData().name+piping,figure.getUserData().Caption=figure.getUserData().Caption+piping,figure.label.setText(figure.getUserData().Caption),piping+=1;break;case"WarninglampComponent":figure.getUserData().name=figure.getUserData().name+Warninglamp,figure.getUserData().Caption=figure.getUserData().Caption+Warninglamp,figure.label.setText(figure.getUserData().Caption),Warninglamp+=1;break;case"blowerfanComponent":figure.getUserData().name=figure.getUserData().name+blowerfan,figure.getUserData().Caption=figure.getUserData().Caption+blowerfan,figure.label.setText(figure.getUserData().Caption),blowerfan+=1;break;case"exhaustfanComponent":figure.getUserData().name=figure.getUserData().name+exhaustfan,figure.getUserData().Caption=figure.getUserData().Caption+exhaustfan,figure.label.setText(figure.getUserData().Caption),exhaustfan+=1;break;case"bengComponent":figure.getUserData().name=figure.getUserData().name+beng,figure.getUserData().Caption=figure.getUserData().Caption+beng,figure.label.setText(figure.getUserData().Caption),beng+=1;break;case"ElectricTwoWayValveComponent":figure.getUserData().name=figure.getUserData().name+ElectricTwoWayValve,figure.getUserData().Caption=figure.getUserData().Caption+ElectricTwoWayValve,figure.label.setText(figure.getUserData().Caption),ElectricTwoWayValve+=1;break;case"SolenoidValveComponent":figure.getUserData().name=figure.getUserData().name+SolenoidValve,figure.getUserData().Caption=figure.getUserData().Caption+SolenoidValve,figure.label.setText(figure.getUserData().Caption),SolenoidValve+=1;break;case"ElectricButterflyValvesComponent":figure.getUserData().name=figure.getUserData().name+ElectricButterflyValves,figure.getUserData().Caption=figure.getUserData().Caption+ElectricButterflyValves,figure.label.setText(figure.getUserData().Caption),ElectricButterflyValves+=1;break;case"AirFiltrationComponent":figure.getUserData().name=figure.getUserData().name+AirFiltration,figure.getUserData().Caption=figure.getUserData().Caption+AirFiltration,figure.label.setText(figure.getUserData().Caption),AirFiltration+=1;break;case"AirHeatingComponent":figure.getUserData().name=figure.getUserData().name+AirHeating,figure.getUserData().Caption=figure.getUserData().Caption+AirHeating,figure.label.setText(figure.getUserData().Caption),AirHeating+=1;break;case"AirCoolerComponent":figure.getUserData().name=figure.getUserData().name+AirCooler,figure.getUserData().Caption=figure.getUserData().Caption+AirCooler,figure.label.setText(figure.getUserData().Caption),AirCooler+=1;break;case"HumidifierComponent":figure.getUserData().name=figure.getUserData().name+Humidifier,figure.getUserData().Caption=figure.getUserData().Caption+Humidifier,figure.label.setText(figure.getUserData().Caption),Humidifier+=1;break;case"controlPanelComponent":figure.getUserData().name=figure.getUserData().name+controlPanel,figure.getUserData().Caption=figure.getUserData().Caption+controlPanel,figure.label.setText(figure.getUserData().Caption),controlPanel+=1;break;case"FluorescentLampComponent":figure.getUserData().name=figure.getUserData().name+FluorescentLamp,figure.getUserData().Caption=figure.getUserData().Caption+FluorescentLamp,figure.label.setText(figure.getUserData().Caption),FluorescentLamp+=1;break;case"LEDComponent":figure.getUserData().name=figure.getUserData().name+LED,figure.getUserData().Caption=figure.getUserData().Caption+LED,figure.label.setText(figure.getUserData().Caption),LED+=1;break;case"IncandescentComponent":figure.getUserData().name=figure.getUserData().name+Incandescent,figure.getUserData().Caption=figure.getUserData().Caption+Incandescent,figure.label.setText(figure.getUserData().Caption),Incandescent+=1;break;case"MetalHalideComponent":figure.getUserData().name=figure.getUserData().name+MetalHalide,figure.getUserData().Caption=figure.getUserData().Caption+MetalHalide,figure.label.setText(figure.getUserData().Caption),MetalHalide+=1;break;case"temperatureComponent":figure.getUserData().name=figure.getUserData().name+temperature,figure.getUserData().Caption=figure.getUserData().Caption+temperature,figure.label.setText(figure.getUserData().Caption),temperature+=1;break;case"humidityComponent":figure.getUserData().name=figure.getUserData().name+humidity,figure.getUserData().Caption=figure.getUserData().Caption+humidity,figure.label.setText(figure.getUserData().Caption),humidity+=1;break;case"pressureComponent":figure.getUserData().name=figure.getUserData().name+pressure,figure.getUserData().Caption=figure.getUserData().Caption+pressure,figure.label.setText(figure.getUserData().Caption),pressure+=1;break;case"differentialPressureComponent":figure.getUserData().name=figure.getUserData().name+differentialPressure,figure.getUserData().Caption=figure.getUserData().Caption+differentialPressure,figure.label.setText(figure.getUserData().Caption),differentialPressure+=1;break;case"liquidComponent":figure.getUserData().name=figure.getUserData().name+liquid,figure.getUserData().Caption=figure.getUserData().Caption+liquid,figure.label.setText(figure.getUserData().Caption),liquid+=1;break;case"electricComponent":figure.getUserData().name=figure.getUserData().name+electric,figure.getUserData().Caption=figure.getUserData().Caption+electric,figure.label.setText(figure.getUserData().Caption),electric+=1;break;case"VoltageComponent":figure.getUserData().name=figure.getUserData().name+Voltage,figure.getUserData().Caption=figure.getUserData().Caption+Voltage,figure.label.setText(figure.getUserData().Caption),Voltage+=1;break;case"frequencyComponent":figure.getUserData().name=figure.getUserData().name+frequency,figure.getUserData().Caption=figure.getUserData().Caption+frequency,figure.label.setText(figure.getUserData().Caption),frequency+=1;break;case"activePowerComponent":figure.getUserData().name=figure.getUserData().name+activePower,figure.getUserData().Caption=figure.getUserData().Caption+activePower,figure.label.setText(figure.getUserData().Caption),activePower+=1;break;case"ElectricityConsumptionComponent":figure.getUserData().name=figure.getUserData().name+ElectricityConsumption,figure.getUserData().Caption=figure.getUserData().Caption+ElectricityConsumption,figure.label.setText(figure.getUserData().Caption),ElectricityConsumption+=1;break;case"levelComponent":figure.getUserData().name=figure.getUserData().name+level,figure.getUserData().Caption=figure.getUserData().Caption+level,figure.label.setText(figure.getUserData().Caption),level+=1;break;case"GasComponent":figure.getUserData().name=figure.getUserData().name+Gas,figure.getUserData().Caption=figure.getUserData().Caption+Gas,figure.label.setText(figure.getUserData().Caption),Gas+=1;break;case"BroadcastComponent":figure.getUserData().name=figure.getUserData().name+Broadcast,figure.getUserData().Caption=figure.getUserData().Caption+Broadcast,figure.label.setText(figure.getUserData().Caption),Broadcast+=1;break;case"monitoringComponent":figure.getUserData().name=figure.getUserData().name+monitoring,figure.getUserData().Caption=figure.getUserData().Caption+monitoring,figure.label.setText(figure.getUserData().Caption),monitoring+=1;break;case"qiujiComponent":figure.getUserData().name=figure.getUserData().name+qiuji,figure.getUserData().Caption=figure.getUserData().Caption+qiuji,figure.label.setText(figure.getUserData().Caption),qiuji+=1;break;case"highqiujiComponent":figure.getUserData().name=figure.getUserData().name+highqiuji,figure.getUserData().Caption=figure.getUserData().Caption+highqiuji,figure.label.setText(figure.getUserData().Caption),highqiuji+=1;break;case"EntranceGuardComponent":figure.getUserData().name=figure.getUserData().name+EntranceGuard,figure.getUserData().Caption=figure.getUserData().Caption+EntranceGuard,figure.label.setText(figure.getUserData().Caption),EntranceGuard+=1;break;case"detectorComponent":figure.getUserData().name=figure.getUserData().name+detector,figure.getUserData().Caption=figure.getUserData().Caption+detector,figure.label.setText(figure.getUserData().Caption),detector+=1}if("LineComponent"==type){var thisx=x;figure.setStartPoint(x,y),figure.setEndPoint(x-70,y+70);var command=new draw2d.command.CommandAdd(this,figure,x,y);this.getCommandStack().execute(command)}else{var command=new draw2d.command.CommandAdd(this,figure,x,y);this.getCommandStack().execute(command)}}}),example.Toolbar=Class.extend({init:function(e,a){this.html=$("#"+e),this.view=a,a.getCommandStack().addEventListener(this),a.on("select",$.proxy(this.onSelectionChanged,this)),this.saveButton=$('<label class = "toolbar-save"><img class=" baocun-img " src="images/img/baocun.png"><br>保存</label>'),this.html.append(this.saveButton),this.saveButton.button().click($.proxy(function(){var e=[];(new draw2d.io.json.Writer).marshal(this.view,function(a){if(0==a.length)layer.msg("未绑定任何控件");else{$(".have-btn button").each(function(a,t){var r={id:Number($(t).attr("id")),name:$(t).data("name"),tag_id:Number($(t).data("tag-id")),tag_type:Number($(t).data("tag-type")),tag_name:$(t).data("tag-name"),bingding_status:Number($(t).data("bingding-status")),readonly:$(t).data("readonly")};e.push(r)});var t={canvas:a,subCanvas:e},r={view_data:JSON.stringify(t),id:sessionStorage.getItem("view_id"),background_img_url:$("#myBgimage").data("url"),background_color:rgb2hex($("#canvas").css("background-color"))};$.ajax({url:"/api/view/1",type:"PUT",dataType:"json",data:r,beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){$(".loading").hide(),1==e.success?layer.msg("数据保存成功"):layer.msg("数据保存失败原因:"+e.error_message)},error:function(e){$(".loading").hide(),returnLogIn(e),layer.msg("数据保存失败原因:"+e.error_message)}})}})},this)).button("option","disabled",!1),this.deleteButton=$('<label class = "toolbar-delete"><img class=" delete-img " src="images/img/delete.png"><br>删除</label>'),this.html.append(this.deleteButton),this.deleteButton.button().click($.proxy(function(){var e=this.view.getCurrentSelection();if(null!==e){var a=new draw2d.command.CommandDelete(e);this.view.getCommandStack().execute(a)}},this)).button("option","disabled",!0),this.clearButtons=$('<label class = "toolbar-wangge"><img class=" wangge-img " src="images/img/clear.png"><br>全部清除</label>'),this.html.append(this.clearButtons),this.clearButtons.button().click($.proxy(function(){var e=this;layer.open({title:["清除画面","font-size:18px;color:#fff;background:#3E4687;height:50px;font-weight:bold;line-height:50px;padding-left:30px;border:none;"],type:1,skin:"layui-primary",area:["900px","200px"],content:$("#deleteAllcomAndcanvas"),shift:2,move:!1,btn:["确定","放弃"],yes:function(a){e.view.clear(),$("#myBgimage").attr("src","images/logo-text.png"),$("#canvas").css("background-color",""),$("#canvas-img").val(""),$("#myBgimage").data("url",""),$(".canvas-fill-color ul li").removeClass("colorWhiteBorder colorBlackBorder"),layer.close(a)},btn2:function(e){layer.close(e)}})},this)).button("option","disabled",!1),this.undoButton=$('<label class = "toolbar-undo"><img class=" chexiao-img " src="images/img/chexiao.png"><br>撤销</label>'),this.html.append(this.undoButton),this.undoButton.button().click($.proxy(function(){this.view.getCommandStack().undo()},this)).button("option","disabled",!0),this.redoButton=$('<label class = "toolbar-redo"><img class=" fanhui-img " src="images/img/fanhui.png"><br>恢复</label>'),this.html.append(this.redoButton),this.redoButton.button().click($.proxy(function(){this.view.getCommandStack().redo()},this)).button("option","disabled",!0)},onSelectionChanged:function(e,a){this.deleteButton.button("option","disabled",null===a)},stackChanged:function(e){this.undoButton.button("option","disabled",!e.getStack().canUndo()),this.redoButton.button("option","disabled",!e.getStack().canRedo())}});