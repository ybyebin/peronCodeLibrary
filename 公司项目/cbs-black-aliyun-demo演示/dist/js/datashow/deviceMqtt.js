function MQTTconnect(){mqtt=new Paho.MQTT.Client("192.168.2.2",61614,String(parseInt(100*Math.random(),10)));var e={useSSL:!1,cleanSession:!1,onSuccess:function(){subscribeView()},onFailure:function(e){setTimeout(MQTTconnect,reconnectTimeout)}};mqtt.onConnectionLost=onConnectionLost,mqtt.onMessageArrived=onMessageArrived,mqtt.connect(e)}function subscribeView(){restart=!0,mqtt.subscribe("Bayax/Push/"+view_id)}function unsubscribeView(){mqtt.unsubscribe("Bayax/Push/"+view_id)}function onConnectionLost(e){restart||setTimeout(MQTTconnect,reconnectTimeout)}function onMessageArrived(e){onlyForOnMessageArrived(e)}function onlyForOnMessageArrived(e){var a=JSON.parse(e.payloadString),t=!0;for(var n in componentIsReadonly)if(componentIsReadonly[n].tag_id==a.tagId&&componentIsReadonly[n].status===a.status&&componentIsReadonly[n].alarm===a.isAlarm&&componentIsReadonly[n].value===a.value){t=!1;break}if(t){for(var s in allComponent)if(Number(allComponent[s])===a.tagId)if("notCanvasNode"===getCanvasNode(imageCanvas,s)){if(0===a.status)switch(a.value){case!0:$("#"+s).find(".tagsValue").text(a.value),$("."+s).data("value","1").removeClass("boolean-false boolean-true").addClass("boolean-true");break;case!1:$("#"+s).find(".tagsValue").text(a.value),$("."+s).data("value","0").removeClass("boolean-false boolean-true").addClass("boolean-false")}}else{var o=getCanvasNode(imageCanvas,s);if("notCanvasNode"===o)return!1;if(null===o)return!1;if(o.userData.valueType)if(0===a.status)switch(o.userData.valueType){case"textValueComponent":o.setText(String(a.value+o.userData.unit)),o.repaint();break;case"valueComponent":"LabelComponent"===o.userData.types?(o.setText(String(a.value)),o.repaint()):(o.label.setText(String(a.value)),o.label.repaint())}else switch(o.userData.valueType){case"textValueComponent":o.setText("通信异常"),o.repaint();break;case"valueComponent":"LabelComponent"===o.userData.types?(o.setText("通信异常"),o.repaint()):(o.label.setText("通信异常"),o.label.repaint())}switch(a.status){case 0:switch(a.isAlarm){case!0:o.userData.Tag.tag_type,nodeOnAlarm(o,a.value);break;case!1:if(1===o.userData.Tag.tag_type)switch(String(a.value)){case"true":nodeOnTrue(o,a.value);break;case"false":nodeOnFalse(o,a.value)}else nodeOnTrue(o,a.value)}break;case 1:case 2:default:nodeOnDisconnected(o,a.value)}}websocketChangetable(a),changeTagValueForHighChar(a)}}function nodeOnTrue(e,a){switch("LabelComponent"===e.userData.types||(e.stopTimer(),e.userData.BlinkingType="onTrue",1==e.userData.onTrue.Blinking&&e.startTimer(1e3),e.setStroke(Number(e.userData.onTrue.LineWidth)),e.setDashArray(e.userData.onTrue.LineStyle),e.setColor(e.userData.onTrue.LineColor)),e.userData.types){case"imageComponent":e.image.setPath(e.userData.onTrue.picture);break;case"buttonComponent":e.setBackgroundColor(e.userData.onTrue.FillColor),""==e.userData.onTrue.Text?e.userData.onTrue.unit?e.setText(String(a+e.userData.onTrue.unit)):e.setText(String(a)):e.setText(e.userData.onTrue.Text),e.setFontColor(e.userData.onTrue.TextColor);break;case"basicComponent":e.setBackgroundColor(e.userData.onTrue.FillColor),e.setAlpha(Number(e.userData.onTrue.alpha));break;case"conduitCompontent":e.setBackgroundColor(e.userData.onTrue.FillColor)}e.repaint()}function nodeOnFalse(e,a){switch("LabelComponent"===e.userData.types||(e.stopTimer(),e.userData.BlinkingType="onFalse",1==e.userData.onFalse.Blinking&&e.startTimer(1e3),e.setStroke(Number(e.userData.onFalse.LineWidth)),e.setDashArray(e.userData.onFalse.LineStyle),e.setColor(e.userData.onFalse.LineColor)),e.userData.types){case"imageComponent":e.image.setPath(e.userData.onFalse.picture);break;case"buttonComponent":e.setBackgroundColor(e.userData.onFalse.FillColor),""==e.userData.onFalse.Text?e.userData.onFalse.unit?e.setText(String(a+e.userData.onFalse.unit)):e.setText(String(a)):e.setText(e.userData.onFalse.Text),e.setFontColor(e.userData.onFalse.TextColor);break;case"basicComponent":e.setBackgroundColor(e.userData.onFalse.FillColor),e.setAlpha(Number(e.userData.onFalse.alpha));break;case"conduitCompontent":e.setBackgroundColor(e.userData.onTrue.FillColor)}e.repaint()}function nodeOnAlarm(e,a){switch("LabelComponent"===e.userData.types||(e.stopTimer(),e.userData.BlinkingType="onAlarm",1==e.userData.onAlarm.Blinking&&e.startTimer(1e3),e.setStroke(Number(e.userData.onAlarm.LineWidth)),e.setDashArray(e.userData.onAlarm.LineStyle),e.setColor(e.userData.onAlarm.LineColor)),e.userData.types){case"imageComponent":e.image.setPath(e.userData.onAlarm.picture);break;case"buttonComponent":e.setBackgroundColor(e.userData.onAlarm.FillColor),""==e.userData.onAlarm.Text?e.userData.onAlarm.unit?e.setText(String(a+e.userData.onAlarm.unit)):e.setText(String(a)):e.setText(e.userData.onAlarm.Text),e.setFontColor(e.userData.onAlarm.TextColor);break;case"basicComponent":e.setBackgroundColor(e.userData.onAlarm.FillColor),e.setAlpha(Number(e.userData.onAlarm.alpha));break;case"conduitCompontent":e.setBackgroundColor(e.userData.onAlarm.FillColor)}e.repaint()}function nodeOnDisconnected(e,a){switch("LabelComponent"===e.userData.types||(e.stopTimer(),e.userData.BlinkingType="onDisconnected",1==e.userData.onDisconnected.Blinking&&e.startTimer(1e3),e.setStroke(Number(e.userData.onDisconnected.LineWidth)),e.setDashArray(e.userData.onDisconnected.LineStyle),e.setColor(e.userData.onDisconnected.LineColor)),e.userData.types){case"imageComponent":e.image.setPath(e.userData.onDisconnected.picture);break;case"buttonComponent":e.setBackgroundColor(e.userData.onDisconnected.FillColor),""==e.userData.onDisconnected.Text||e.setText(e.userData.onDisconnected.Text),e.setFontColor(e.userData.onDisconnected.TextColor);break;case"basicComponent":e.setBackgroundColor(e.userData.onDisconnected.FillColor),e.setAlpha(Number(e.userData.onDisconnected.alpha));break;case"conduitCompontent":e.setBackgroundColor(e.userData.onDisconnected.FillColor)}e.repaint()}function websocketChangetable(e){$("#qu table tbody tr").find(".havetagid").each(function(a,t){if(Number($(t).text())==e.tagId){var n=Number($(t).parent().find(".havetagtype").text());switch(e.status){case 0:switch(e.isAlarm){case!1:1===n?($(t).parent().find(".tagState").html("正常").data("status","0"),$(t).parent().find(".tagsValue").text(e.value)):($(t).parent().find(".tagState").html("").data("status","0"),$(t).parent().find(".tagsValue").text(e.value));break;case!0:$(t).parent().find(".tagState").html('<span class="warn"></span><span class="size_red">报警</span>').data("status","0"),$(t).parent().find(".tagsValue").text(e.value)}break;case 1:$(t).parent().find(".tagState").html('<span class="catch"></span><span class="size_yellow">通信异常</span>').data("status","1"),$(t).parent().find(".tagsValue").html("--");break;case 2:$(t).parent().find(".tagState").html('<span class="catch"></span><span class="size_yellow">通信异常</span>').data("status","2"),$(t).parent().find(".tagsValue").html("--");break;default:$(t).parent().find(".tagState").html('<span class="catch"></span><span class="size_yellow">通信异常</span>').data("status",e.status),$(t).parent().find(".tagsValue").html("--")}}});for(var a in componentIsReadonly)Number(componentIsReadonly[a].tag_id)==Number(e.tagId)&&(componentIsReadonly[a].status=e.status,componentIsReadonly[a].alarm=e.isAlarm,componentIsReadonly[a].value=e.value)}function changeTagValueForHighChar(e){e.tagId==tagIdForHighChar&&(isNaN(e.value)||(tagValueForHighChar=Number(e.value)))}var view_id="",mqtt,reconnectTimeout=5e3,clientID="123",restart=!1;$(function(){setInterval(function(){if(Number(view_id)>0&&mqtt){var e=new Paho.MQTT.Message(view_id);e.destinationName="Bayax/View/"+clientID,e.qos=0,mqtt.send(e)}},15e3)});