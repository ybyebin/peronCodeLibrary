function warnLoadData(a){var e=["page="+a,"page_item_count=14"].join("&");$.ajax({url:apiurl+"alarmvalue/0?"+e,type:"GET",beforeSend:function(){$(".loading").show()},success:function(e){$(".loading").hide(),e.success?(warnAddtable(e.data.items),0===e.data.pageCount?(layer.msg("无数据"),$(".tcdPageCode-warn").html("")):$(".tcdPageCode-warn").createPage({pageCount:e.data.pageCount,current:a,backFn:function(a){warnLoadData(a)}}),Initialization=!1):layer.msg(e.error_message)},error:function(a){$(".loading").hide(),layer.msg(a.error_message),returnLogIn(a)}})}function warnAddtable(a){null==a&&(a=[]);for(var e in a){switch(a[e].alarm_level){case 0:a[e].alarm_level="无";break;case 1:a[e].alarm_level="低";break;case 2:a[e].alarm_level="中";break;case 3:a[e].alarm_level="高"}switch(null===a[e].description&&(a[e].description="无"),a[e].alarm_value){case"True":a[e].actual_value="True";break;case"False":a[e].actual_value="False"}}$("#tbodys tr td").html(""),$("#tbodys tr").each(function(e,t){if(e<a.length){var r="<td>"+a[e].alarm_level+"</td><td>"+a[e].alarm_time+'</td><td title="'+a[e].description+'">'+a[e].description+"</td><td >"+a[e].tag_name+"</td><td >"+a[e].alarm_value+"</td><td >"+a[e].actual_value+'</td><td><button data-id = "'+a[e].id+'" data-status="'+a[e].alarm_status+'" class="btn-sure">确认</button></td>';$(t).html(r)}})}function warnLogLoadData(a){$.ajax({url:apiurl+"alarmlog?"+["page="+a,"page_item_count=12","from_time="+$("#startTime").val(),"end_time="+$("#endTime").val()+" 23:59:59"].join("&"),type:"GET",dataType:"json",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){if($(".loading").hide(),e.success){var t=e.data.pageCount;warnLogAddtable(e.data.items),0===t?(layer.msg("无数据"),$(".tcdPageCode-log").html("")):$(".tcdPageCode-log").createPage({pageCount:t,current:a,backFn:function(a){warnLogLoadData(a)}})}else layer.msg(e.error_message)},error:function(a){$(".loading").hide(),layer.msg(a.error_message),returnLogIn(a)}})}function warnLogAddtable(a){null==a&&(a=[]);for(var e in a){switch(a[e].alarm_level){case 0:a[e].alarm_level="无";break;case 1:a[e].alarm_level="低";break;case 2:a[e].alarm_level="中";break;case 3:a[e].alarm_level="高"}switch(a[e].alarm_status){case 1:a[e].alarm_status="未确认且未恢复";break;case 2:a[e].alarm_status="未确认但已恢复";break;case 3:a[e].alarm_status="已确认但未恢复";break;case 4:a[e].alarm_status="已确认且已恢复"}switch(a[e].actual_value){case"True":a[e].alarm_value="True";break;case"False":a[e].alarm_value="False"}null===a[e].confirm_time&&(a[e].confirm_time="无"),null===a[e].description&&(a[e].description="无")}$("#logtbody tr td").html(""),$("#logtbody tr").each(function(e,t){if(e<a.length){var r="<td>"+a[e].alarm_level+"</td><td>"+a[e].alarm_time+'</td><td title="'+a[e].description+'">'+a[e].description+"</td><td >"+a[e].tag_name+"</td><td >"+a[e].alarm_value+"</td><td >"+a[e].actual_value+"</td><td>"+a[e].alarm_status+"</td><td>"+a[e].confirm_time+"</td>";$(t).html(r)}})}function exportWarnLog(){var a=$("#startTime").val(),e=$("#endTime").val();""!==a&&""!==e?a>e?layer.msg("开始时间大于结束时间"):compareYear(new Date(a),10)<=e?layer.msg("超过统计时间限制"):$.ajax({url:apiurl+"alarmlog?"+["from_time="+$("#startTime").val(),"end_time="+$("#endTime").val()+" 23:59:59",'report_name="报警日志"'].join("&"),type:"PUT",success:function(a){a.success?window.location.href="../"+a.data:layer.msg(a.error_message)},error:function(a){layer.msg(a.error_message),returnLogIn(a)}}):layer.msg("时间区间不能为空")}$("#foot").load("public.html");var Initialization=!0;$(function(){publicHeadfun(),days(),$("#slectFen ul li a").click(function(){var a=!0;$("span.txt").text($(this).text());var e=$(this).attr("rel");1==e||2==e?($("#startTime").val($(this).attr("value")),$("#endTime").val($(this).attr("value"))):3==e||4==e||5==e?($("#startTime").val($(this).attr("value")),$("#endTime").val(compareDate(1,0))):6==e||7==e||8==e?($("#startTime").val($(this).attr("value")),6==e?counts=1:7==e?counts=2:8==e&&(counts=3),$("#endTime").val(getCurrentMonthLastForSelect($(this).attr("value")))):9==e&&(a=!1,$("#startTime").val(""),$("#endTime").val("")),a&&warnLogLoadData(1)}),warnLoadData(1)}),$("#startTime").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:!1,pickerPosition:"bottom-right",minView:2}).on("changeDate",function(a){$("#slectFen button .txt").html("自定义").attr("rel",9),$("#endTime")[0].focus()}),$("#endTime").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayBtn:!1,pickerPosition:"bottom-right",minView:2}).on("changeDate",function(a){$("#slectFen button .txt").html("自定义").attr("rel",9),timebeginisTrue=!0,checkEndTime("startTime","endTime",1)||($("#endTime").val(""),layer.msg("结束时间需晚于开始时间"),timebeginisTrue=!1),compareYear(new Date($("#startTime").val()),10)<=a.date.toLocaleDateString()&&(layer.msg("超过统计时间限制"),$("#endTime").val(""),timebeginisTrue=!1),timebeginisTrue&&warnLogLoadData(1)}),$("#tbodys").on("click","button",function(){var a=$(this),e="",t=!0;switch(Number($(this).data("status"))){case 1:e=3;break;case 2:e=4;break;default:layer.msg("报警状态错误"),t=!1}t&&$.ajax({url:apiurl+"alarmvalue?"+["id="+$(this).data("id"),"status="+e].join("&"),type:"PUT",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(e){if($(".loading").hide(),e.success)switch(e.data){case!1:break;case!0:a.parent().html("已确认")}else layer.msg(e.error_message)},error:function(a){$(".loading").hide(),layer.msg(a.error_message),returnLogIn(a)}})}),$("#ri_a").on("click",function(){1===Number($(this).data("click"))&&($("#slectFen ul li:nth-child(4) a").click(),$(this).data("click","0"))});