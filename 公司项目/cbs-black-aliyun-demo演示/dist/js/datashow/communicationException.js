function getCommunicationError(t){$.ajax({url:apiurl+"nodelog/0",type:"GET",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(a){$(".loading").hide(),a.success?t?comErrorjqaddRow($("#commexc-tbody"),a.data.items):comErrorjqaddRowRefresh($("#commexc-tbody"),a.data.items):layer.msg(a.error_message)},error:function(t){publicAjaxError(t)}})}function comErrorjqaddRow(t,a){null==a?(a=[{commec:"commec"}],layer.msg("无通讯状态信息")):0==a.length&&layer.msg("无通讯状态信息");var e=a.length;for(var c in a)switch(Number(a[c].status)){case 1:a[c].status="正常";break;case 2:a[c].status="异常"}if(Number(e)<14)for(var s=14-e,o={commec:"commec"},c=0;c<s;c++)a.push(o);t.html("");var r="";for(var m in a)if(a[m].commec)r+='<tr"><td></td><td></td><td></td><td></td><td></td></tr>';else{var d="";d="异常"===a[m].status?'</td><td class="commec-status"><span style="color:red">'+a[m].status+"</span>":'</td><td class="commec-status">'+a[m].status,r+='<tr id="tr'+a[m].id+'"><td>'+a[m].name+"</td><td >"+a[m].ip+d+'</td><td class="commec-time">'+a[m].create_time+'</td></td><td><a style="color:#428bca;cursor: pointer;" data-id="'+a[m].id+'" class="check-soncmmmec">查看子设备</a></td></tr>'}t.append(r)}function comErrorjqaddRowRefresh(t,a){if(null==a)return layer.msg("无通讯状态信息"),!1;if(0==a.length)return layer.msg("无通讯状态信息"),!1;a.length;for(var e in a){switch(Number(a[e].status)){case 1:a[e].status="正常",$("#tr"+a[e].id).find("td.commec-status").each(function(t,c){$(c).html(a[e].status)});break;case 2:a[e].status="异常";var c='<span style="color:red">'+a[e].status+"</span>";$("#tr"+a[e].id).find("td.commec-status").each(function(t,a){$(a).html(c)})}$("#tr"+a[e].id).find("td.commec-time").each(function(t,c){$(c).html(a[e].create_time)})}}function commexcSonGetData(t){$.ajax({url:apiurl+"taglog/1?node_id="+Number(t),type:"GET",beforeSend:function(){$(".loading").show()},complete:function(){$(".loading").hide()},success:function(t){if($(".loading").hide(),t.success){var a=t.data;null==a?(a=[{commectag:"commectag"}],layer.msg("无通讯状态信息")):0==a.length&&layer.msg("无通讯状态信息");var e=a.length;for(var c in a)switch(a[c].status){case 1:a[c].status="异常";break;case 0:a[c].status="正常";break;case!0:a[c].status="异常";break;case!1:a[c].status="正常";break;default:a[c].status="--"}if(Number(e)<14)for(var s=14-e,o={commectag:"commectag"},c=0;c<s;c++)a.push(o);var r=$("#commexc-tbody-second");r.html("");var m="";for(var d in a)if(a[d].commectag)m+='<tr"><td></td><td></td><td></td></tr>';else{var n="";n="异常"===a[d].status?'</td><td class="commec-status"><span style="color:red">'+a[d].status+"</span>":'</td><td class="commec-status">'+a[d].status,m+='<tr id="tr'+a[d].id+'"><td>'+a[d].name+n+'</td><td class="commec-time">'+a[d].create_time+"</td></tr>"}r.append(m)}else layer.msg(t.error_message)},error:function(t){publicAjaxError(t)}})}$("#foot").load("public.html"),function(t){t(window).load(function(){t(".commexc-div").mCustomScrollbar()})}(jQuery),$(function(){publicHeadfun(),getCommunicationError(!0),setInterval(function(){var t=$("#commexc-btn");switch(t.data("status")){case"show":commexcSonGetData(t.data("id"));break;case"hide":getCommunicationError(!1)}},1e4)}),$("#commexc-tbody").on("click","a.check-soncmmmec",function(){$(".commexc-father").hide(),$(".commexc-son").show();var t=$("#commexc-btn"),a=$(this).data("id");$.data(t[0],"id",a),$.data(t[0],"status","show"),commexcSonGetData(a)}),$("#commexc-btn").click(function(){$(".commexc-father").show(),$(".commexc-son").hide();var t=$("#commexc-btn");$.data(t[0],"id",""),$.data(t[0],"status","hide")});