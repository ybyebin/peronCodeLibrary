function checkWebSocket(e,a){if(window.WebSocket=window.WebSocket||window.MozWebSocket,!window.WebSocket)return void alert("你的浏览器不支持WebSocket,请更换浏览器!");ws=new WebSocket(e),ws.onopen=doOpen(a),ws.onerror=doError,ws.onclose=doClose,ws.onmessage=doMessage}function doOpen(e){isselect=!0,setTimeout(function(){ws.send("$Heartbeat@"+JSON.stringify(webScoketjson)+"\n")},3e3),Interval=setInterval(function(){ws.send("$Heartbeat@"+JSON.stringify(webScoketjson)+"\n")},5e3)}function doClose(){clearInterval(Interval),isselect=!1}function doError(e){}function doMessage(e){if("$Message@"===e.data.substring(0,9)){var a=e.data.substring(9),t=JSON.parse(a);if(t.ViewId==view_id){var r=[];(new draw2d.io.json.Writer).marshal(imageCanvas,function(e){webScoketTagID=Number(t.tagid),componentId="";for(var a=0;a<e.length;a++)if(Number(e[a].userData.Tag.tag_id)==Number(t.tagid)){var s=e[a].id;r.push(s)}}),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);for(var s=0;s<r.length;s++)if(""!==r[s]){var n=imageCanvas.getFigure(r[s]);if(n.userData.valueType)switch(n.userData.valueType){case"textValueComponent":n.setText("hahahaha"),n.setText(dataDic[ids].value),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value);break;case"valueComponent":"LabelComponent"===n.userData.types?(n.setText(dataDic[ids].value),n.repaint()):(n.label.setText(dataDic[ids].value),n.label.repaint()),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value)}switch(Number(t.status)){case 0:switch(t.isalarm){case"False":if("boolean"===n.userData.Tag.tag_type)switch(t.value){case"False":switch(n.userData.types){case"imageComponent":n.stopTimer(),n.userData.BlinkingType="onFalse",1==n.userData.onFalse.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onFalse.LineWidth)),n.setDashArray(n.userData.onFalse.LineStyle),n.setColor(n.userData.onFalse.LineColor),n.image.setPath(n.userData.onFalse.picture),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"buttonComponent":n.stopTimer(),n.userData.BlinkingType="onFalse",1==n.userData.onFalse.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onFalse.LineWidth)),n.setDashArray(n.userData.onFalse.LineStyle),n.setColor(n.userData.onFalse.LineColor),n.setBackgroundColor(n.userData.onFalse.FillColor),""==n.userData.onFalse.Text?n.setText("关闭"):n.setText(n.userData.onFalse.Text),n.setFontColor(n.userData.onFalse.TextColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"basicComponent":n.stopTimer(),n.userData.BlinkingType="onFalse",1==n.userData.onFalse.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onFalse.LineWidth)),n.setDashArray(n.userData.onFalse.LineStyle),n.setColor(n.userData.onFalse.LineColor),n.setBackgroundColor(n.userData.onFalse.FillColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"LineComponent":n.stopTimer(),n.userData.BlinkingType="onFalse",1==n.userData.onFalse.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onFalse.LineWidth)),n.setDashArray(n.userData.onFalse.LineStyle),n.setColor(n.userData.onFalse.LineColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value)}break;case"True":switch(n.userData.types){case"imageComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.image.setPath(n.userData.onTrue.picture),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"buttonComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.setBackgroundColor(n.userData.onTrue.FillColor),""==n.userData.onTrue.Text?n.setText("打开"):n.setText(n.userData.onTrue.Text),n.setFontColor(n.userData.onTrue.TextColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"basicComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.setBackgroundColor(n.userData.onTrue.FillColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"LineComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value)}}else switch(n.userData.types){case"imageComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.image.setPath(n.userData.onTrue.picture),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value);break;case"buttonComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.setBackgroundColor(n.userData.onTrue.FillColor),""==n.userData.onTrue.Text?n.setText(t.value):n.setText(n.userData.onTrue.Text),n.setFontColor(n.userData.onTrue.TextColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value);break;case"basicComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.setBackgroundColor(n.userData.onTrue.FillColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value);break;case"LineComponent":n.stopTimer(),n.userData.BlinkingType="onTrue",1==n.userData.onTrue.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onTrue.LineWidth)),n.setDashArray(n.userData.onTrue.LineStyle),n.setColor(n.userData.onTrue.LineColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value)}break;case"True":if("boolean"==Number(n.userData.Tag.tag_type))switch(n.userData.types){case"imageComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.image.setPath(n.userData.onAlarm.picture),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"buttonComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.setBackgroundColor(n.userData.onAlarm.FillColor),""==n.userData.onAlarm.Text?n.setText("报警"):n.setText(n.userData.onAlarm.Text),n.setFontColor(n.userData.onAlarm.TextColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"basicComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.setBackgroundColor(n.userData.onAlarm.FillColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"LineComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value)}else switch(n.userData.types){case"imageComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.image.setPath(n.userData.onAlarm.picture),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value);break;case"buttonComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.setBackgroundColor(n.userData.onAlarm.FillColor),""==n.userData.onAlarm.Text?n.setText(t.value):n.setText(n.userData.onAlarm.Text),n.setFontColor(n.userData.onAlarm.TextColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value);break;case"basicComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.setBackgroundColor(n.userData.onAlarm.FillColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value);break;case"LineComponent":n.stopTimer(),n.userData.BlinkingType="onAlarm",1==n.userData.onAlarm.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onAlarm.LineWidth)),n.setDashArray(n.userData.onAlarm.LineStyle),n.setColor(n.userData.onAlarm.LineColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value),changeTagValueForHighChar(t.value)}}break;case 1:case 2:switch(n.userData.types){case"imageComponent":n.stopTimer(),n.userData.BlinkingType="onDisconnected",1==n.userData.onDisconnected.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onDisconnected.LineWidth)),n.setDashArray(n.userData.onDisconnected.LineStyle),n.setColor(n.userData.onDisconnected.LineColor),n.image.setPath(n.userData.onDisconnected.picture),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"buttonComponent":n.stopTimer(),n.userData.BlinkingType="onDisconnected",1==n.userData.onDisconnected.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onDisconnected.LineWidth)),n.setDashArray(n.userData.onDisconnected.LineStyle),n.setColor(n.userData.onDisconnected.LineColor),n.setBackgroundColor(n.userData.onDisconnected.FillColor),""==n.userData.onDisconnected.Text?n.setText(t.value):n.setText(n.userData.onDisconnected.Text),n.setFontColor(n.userData.onDisconnected.TextColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"basicComponent":n.stopTimer(),n.userData.BlinkingType="onDisconnected",1==n.userData.onDisconnected.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onDisconnected.LineWidth)),n.setDashArray(n.userData.onDisconnected.LineStyle),n.setColor(n.userData.onDisconnected.LineColor),n.setBackgroundColor(n.userData.onDisconnected.FillColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value);break;case"LineComponent":n.stopTimer(),n.userData.BlinkingType="onDisconnected",1==n.userData.onDisconnected.Blinking&&n.startTimer(1e3),n.setStroke(Number(n.userData.onDisconnected.LineWidth)),n.setDashArray(n.userData.onDisconnected.LineStyle),n.setColor(n.userData.onDisconnected.LineColor),n.repaint(),websocketChangetable(t.tagid,t.status,t.isalarm,t.value)}}}}}}function doSend(e){null!=ws&&ws.send(JSON.stringify(e))}function webSocketClose(){null!=ws&&ws.close()}function websocketChangetable(e,a,t,r){$("#qu table tbody tr").find(".havetagid").each(function(s,n){if(Number($(n).text())==Number(e)){var o=$(n).parent().find(".havetagtype").text();switch(Number(a)){case 0:switch(t){case"False":if("boolean"==o)switch(r){case"False":$(n).parent().find(".tagState").html("正常"),$(n).parent().find(".tagsValue").html("关");break;case"True":$(n).parent().find(".tagState").html("正常"),$(n).parent().find(".tagsValue").html("开")}else $(n).parent().find(".tagState").html(""),$(n).parent().find(".tagsValue").html(r);break;case"True":if("boolean"==o)switch($(n).parent().find(".tagState").html('<span class="warn"></span><span class="size_red">报警</span>'),r){case"False":$(n).parent().find(".tagsValue").html("关");break;case"True":$(n).parent().find(".tagsValue").html("开")}else $(n).parent().find(".tagState").html('<span class="warn"></span><span class="size_red">报警</span>'),$(n).parent().find(".tagsValue").html(r)}break;case 1:case 2:$(n).parent().find(".tagState").html('<span class="catch"></span><span class="size_yellow">通信异常</span>'),$(n).parent().find(".tagsValue").html("--")}}}),TagRealTimevalue.tag_id==Number(e)&&(TagRealTimevalue.tag_value=r);for(var s in componentIsReadonly)if(Number(componentIsReadonly[s].tag_id)==Number(e))if("boolean"==componentIsReadonly[s].tag_type)switch(r){case"False":componentIsReadonly[s].value=0;break;case"True":componentIsReadonly[s].value=1}else componentIsReadonly[s].value=r}function changeTagValueForHighChar(e){webScoketTagID==tagIdForHighChar&&(isNaN(e)||(tagValueForHighChar=Number(e)))}var ws,Interval,isselect=!1,view_id="",webScoketjson={viewid:view_id},componentId;$(function(){setInterval(function(){0==isselect&&checkWebSocket(wsSocket,view_id)},5e3)});